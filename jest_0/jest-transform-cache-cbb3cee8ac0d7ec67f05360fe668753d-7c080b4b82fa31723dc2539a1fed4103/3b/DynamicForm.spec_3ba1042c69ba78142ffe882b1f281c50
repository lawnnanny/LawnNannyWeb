5937a8f56a05638e130a1b0f25cea8c1
'use strict';

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _semanticUiReact = require('semantic-ui-react');

var _enzyme = require('enzyme');

var _chance = require('chance');

var _DynamicForm = require('../../../src/components/helpers/DynamicForm');

var _DynamicForm2 = _interopRequireDefault(_DynamicForm);

var _InlineError = require('../../../src/components/helpers/InlineError');

var _InlineError2 = _interopRequireDefault(_InlineError);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var chance = new _chance.Chance();
var numberOfFields = chance.integer() % 11 + 1;

var randomType = function randomType(useRowCombination) {
  switch (chance.integer() % 5) {
    case 0:
      return 'textArea';
    case 1:
      return 'radio';
    case 2:
      return 'checkbox';
    case 3:
      return 'input';
    case 4:
      if (useRowCombination) {
        return 'rowCombination';
      }
      return 'input';
    default:
      return 'textArea';
  }
};

var failTest = function failTest(wrapper, field, count) {
  if (chance.integer() % 2) {
    var state = { errors: {} };
    state.errors[field.id] = 'Nothing is Selected';
    wrapper.setState(state);
    wrapper.update();
    expect(wrapper.childAt(1).childAt(0).childAt(count).find(_InlineError2.default).props().text).toEqual('Nothing is Selected');
  }
};

var createRandomOptions = function createRandomOptions() {
  var options = [];
  var numberOfOptions = chance.integer() % 11 + 1;
  for (var counter = 0; counter < numberOfOptions; counter += 1) {
    options[counter] = chance.word();
  }
  return options;
};

var generateTestFormJson = function generateTestFormJson() {
  var name = chance.word();
  var jsonForm = {};
  var fields = [];
  for (var counter = 0; counter < numberOfFields; counter += 1) {
    var type = randomType(true);

    var field = {};
    if (type === 'rowCombination') {
      var numberOfSubFields = chance.integer() % 11 + 1;
      var subFields = [];
      for (var count = 0; count < numberOfSubFields; count += 1) {
        var subFieldType = randomType(false);
        var subField = {
          name: chance.word(),
          type: subFieldType,
          id: chance.word()
        };

        if (chance.integer() % 2 === 0) {
          subField.validation = 'required';
        }

        if (type === 'radio') {
          subField.options = createRandomOptions();
        }

        if (subFieldType === 'textArea' || type === 'input') {
          subField.placeholder = chance.word();
        }

        subFields[count] = subField;
      }

      field = {
        name: chance.word(),
        type: 'rowCombination',
        fields: subFields
      };
    } else {
      field = {
        name: chance.word(),
        type: type,
        id: chance.word()
      };

      if (chance.integer() % 2 === 0) {
        field.validation = 'required';
      }
      if (type === 'radio') {
        field.options = createRandomOptions();
      }
      if (type === 'textArea' || type === 'input') {
        field.placeholder = chance.word();
      }
    }

    fields[counter] = field;
  }
  jsonForm[name] = {};
  jsonForm[name].description = chance.word();
  jsonForm[name].fields = fields;
  return jsonForm;
};

describe('DynamicForm', function () {
  var wrapper = void 0;
  var setRequest = jest.fn();
  var testJson = generateTestFormJson();
  var _route = jest.fn();
  var renderComponent = function renderComponent() {
    return (0, _enzyme.shallow)(_react2.default.createElement(_DynamicForm2.default, {
      jsonForm: function jsonForm() {
        return testJson;
      },
      setRequest: setRequest,
      form: Object.keys(testJson)[0],
      route: function route() {
        _route();
      }
    }));
  };

  beforeEach(function () {
    wrapper = renderComponent();
  });

  it('is wrapped in a Segment', function () {
    expect(wrapper.type()).toEqual(_semanticUiReact.Segment);
  });

  it('is styled as a padded Segment', function () {
    expect(wrapper.props().padded).toBeTruthy();
  });

  describe('header', function () {
    var header = void 0;

    beforeEach(function () {
      header = wrapper.childAt(0);
    });

    it('is a header', function () {
      expect(header.type()).toEqual(_semanticUiReact.Header);
    });

    it('is has an as equal to h3', function () {
      expect(header.props().as).toEqual('h3');
    });

    it('is the correct text in the header', function () {
      expect(header.childAt(0).debug()).toEqual(testJson[Object.keys(testJson)[0]].description);
    });
  });
  describe('form segment', function () {
    var formSegment = void 0;

    beforeEach(function () {
      formSegment = wrapper.childAt(1);
    });

    it('is a segment', function () {
      expect(formSegment.type()).toEqual(_semanticUiReact.Segment);
    });

    describe('form', function () {
      var formComponent = void 0;
      beforeEach(function () {
        formComponent = formSegment.childAt(0);
      });
      it('is a form', function () {
        expect(formComponent.type()).toEqual(_semanticUiReact.Form);
      });

      describe('form data', function () {
        wrapper = renderComponent();
        testJson[Object.keys(testJson)[0]].fields.forEach(function (field) {
          if (field.validation) {
            var fail = chance.integer() % 2;
            var count = 0;
            var form = formComponent.childAt(0);
            var segmentOfFields = form.childAt(0);
            it('field ' + count + ' is correct', function () {
              var label = segmentOfFields.childAt(count).childAt(0);
              if (field.validation) {
                expect(label.text()).toEqual(' * ' + field.name);
              } else {
                expect(label.text()).toEqual(field.name);
              }
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).props().name === field.name);
              if (field.type === 'checkbox') {
                expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Checkbox);
              }
              if (field.type === 'radio') {
                expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Radio);
                failTest(wrapper, field, count);
              }
              if (field.type === 'textArea') {
                expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.TextArea);
                failTest(wrapper, field, count);
              }
              if (field.type === 'dropDown') {
                expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Dropdown);
                failTest(wrapper, field, count);
              }

              if (field.type === 'rowCombination') {
                expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Form.Group);

                var subFieldCounter = 0;
                field.fields.forEach(function (input) {
                  var rowInput = wrapper.childAt(1).childAt(0).childAt(count).childAt(1).childAt(subFieldCounter);

                  switch (input.type) {
                    case 'input':
                      expect(rowInput.type()).toEqual(_semanticUiReact.Input);
                      break;
                    case 'dropDown':
                      expect(rowInput.type()).toEqual(_semanticUiReact.Dropdown);
                      break;
                    case 'textArea':
                      expect(rowInput.type()).toEqual(_semanticUiReact.TextArea);
                      break;
                    case 'checkbox':
                      expect(rowInput.type()).toEqual(_semanticUiReact.Checkbox);
                      break;
                    case 'radio':
                      expect(rowInput.type()).toEqual(_semanticUiReact.Checkbox);
                      break;
                    default:
                  }
                  ifailTest(wrapper, field, count);
                  subFieldCounter += 1;
                });
              }

              if (field.type === 'input') {
                expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Input);

                failTest(wrapper, field, count);
              }
              count += 1;
            });
          }
        });
      });

      describe('Form Button', function () {
        var formButton = void 0;

        beforeEach(function () {
          formButton = formComponent.childAt(numberOfFields);
        });

        it('It is a button', function () {
          console.log(formComponent.debug());
          console.log(numberOfFields);
          expect(formButton.type()).toEqual(_semanticUiReact.Form.Button);
        });
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkR5bmFtaWNGb3JtLnNwZWMuanMiXSwibmFtZXMiOlsiY2hhbmNlIiwiQ2hhbmNlIiwibnVtYmVyT2ZGaWVsZHMiLCJpbnRlZ2VyIiwicmFuZG9tVHlwZSIsInVzZVJvd0NvbWJpbmF0aW9uIiwiZmFpbFRlc3QiLCJ3cmFwcGVyIiwiZmllbGQiLCJjb3VudCIsInN0YXRlIiwiZXJyb3JzIiwiaWQiLCJzZXRTdGF0ZSIsInVwZGF0ZSIsImV4cGVjdCIsImNoaWxkQXQiLCJmaW5kIiwiSW5saW5lRXJyb3JDb21wb25lbnQiLCJwcm9wcyIsInRleHQiLCJ0b0VxdWFsIiwiY3JlYXRlUmFuZG9tT3B0aW9ucyIsIm9wdGlvbnMiLCJudW1iZXJPZk9wdGlvbnMiLCJjb3VudGVyIiwid29yZCIsImdlbmVyYXRlVGVzdEZvcm1Kc29uIiwibmFtZSIsImpzb25Gb3JtIiwiZmllbGRzIiwidHlwZSIsIm51bWJlck9mU3ViRmllbGRzIiwic3ViRmllbGRzIiwic3ViRmllbGRUeXBlIiwic3ViRmllbGQiLCJ2YWxpZGF0aW9uIiwicGxhY2Vob2xkZXIiLCJkZXNjcmlwdGlvbiIsImRlc2NyaWJlIiwic2V0UmVxdWVzdCIsImplc3QiLCJmbiIsInRlc3RKc29uIiwicm91dGUiLCJyZW5kZXJDb21wb25lbnQiLCJPYmplY3QiLCJrZXlzIiwiYmVmb3JlRWFjaCIsIml0IiwiU2VnbWVudCIsInBhZGRlZCIsInRvQmVUcnV0aHkiLCJoZWFkZXIiLCJIZWFkZXIiLCJhcyIsImRlYnVnIiwiZm9ybVNlZ21lbnQiLCJmb3JtQ29tcG9uZW50IiwiRm9ybSIsImZvckVhY2giLCJmYWlsIiwiZm9ybSIsInNlZ21lbnRPZkZpZWxkcyIsImxhYmVsIiwiQ2hlY2tib3giLCJSYWRpbyIsIlRleHRBcmVhIiwiRHJvcGRvd24iLCJHcm91cCIsInN1YkZpZWxkQ291bnRlciIsImlucHV0Iiwicm93SW5wdXQiLCJJbnB1dCIsImlmYWlsVGVzdCIsImZvcm1CdXR0b24iLCJjb25zb2xlIiwibG9n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QkFBUUMsR0FBUixDQUFZbkIsY0FBY0YsS0FBZCxFQUFaO0FBQ0FvQixrQkFBUUMsR0FBUixDQUFZM0UsY0FBWjtBQUNBYSxpQkFBTzRELFdBQVc1QyxJQUFYLEVBQVAsRUFBMEJWLE9BQTFCLENBQWtDc0Msc0JBQUttQixNQUF2QztBQUNELFNBSkQ7QUFLRCxPQVpEO0FBYUQsS0FySkQ7QUFzSkQsR0FqS0Q7QUFrS0QsQ0FsTkQiLCJmaWxlIjoiRHluYW1pY0Zvcm0uc3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQge1xuICBCdXR0b24sXG4gIEZvcm0sXG4gIFNlZ21lbnQsXG4gIEhlYWRlcixcbiAgUmFkaW8sXG4gIENoZWNrYm94LFxuICBUZXh0QXJlYSxcbiAgRHJvcGRvd24sXG4gIElucHV0LFxufSBmcm9tICdzZW1hbnRpYy11aS1yZWFjdCc7XG5pbXBvcnQgeyBzaGFsbG93IH0gZnJvbSAnZW56eW1lJztcbmltcG9ydCB7IENoYW5jZSB9IGZyb20gJ2NoYW5jZSc7XG5pbXBvcnQgRHluYW1pY0Zvcm1Db21wb25lbnQgZnJvbSAnLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvaGVscGVycy9EeW5hbWljRm9ybSc7XG5pbXBvcnQgSW5saW5lRXJyb3JDb21wb25lbnQgZnJvbSAnLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvaGVscGVycy9JbmxpbmVFcnJvcic7XG5cbmNvbnN0IGNoYW5jZSA9IG5ldyBDaGFuY2UoKTtcbmNvbnN0IG51bWJlck9mRmllbGRzID0gKGNoYW5jZS5pbnRlZ2VyKCkgJSAxMSkgKyAxO1xuXG5jb25zdCByYW5kb21UeXBlID0gKHVzZVJvd0NvbWJpbmF0aW9uKSA9PiB7XG4gIHN3aXRjaCAoY2hhbmNlLmludGVnZXIoKSAlIDUpIHtcbiAgICBjYXNlIDA6XG4gICAgICByZXR1cm4gJ3RleHRBcmVhJztcbiAgICBjYXNlIDE6XG4gICAgICByZXR1cm4gJ3JhZGlvJztcbiAgICBjYXNlIDI6XG4gICAgICByZXR1cm4gJ2NoZWNrYm94JztcbiAgICBjYXNlIDM6XG4gICAgICByZXR1cm4gJ2lucHV0JztcbiAgICBjYXNlIDQ6XG4gICAgICBpZiAodXNlUm93Q29tYmluYXRpb24pIHtcbiAgICAgICAgcmV0dXJuICdyb3dDb21iaW5hdGlvbic7XG4gICAgICB9XG4gICAgICByZXR1cm4gJ2lucHV0JztcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuICd0ZXh0QXJlYSc7XG4gIH1cbn07XG5cbmNvbnN0IGZhaWxUZXN0ID0gKHdyYXBwZXIsIGZpZWxkLCBjb3VudCkgPT4ge1xuICBpZiAoY2hhbmNlLmludGVnZXIoKSAlIDIpIHtcbiAgICBjb25zdCBzdGF0ZSA9IHsgZXJyb3JzOiB7fSB9O1xuICAgIHN0YXRlLmVycm9yc1tmaWVsZC5pZF0gPSAnTm90aGluZyBpcyBTZWxlY3RlZCc7XG4gICAgd3JhcHBlci5zZXRTdGF0ZShzdGF0ZSk7XG4gICAgd3JhcHBlci51cGRhdGUoKTtcbiAgICBleHBlY3QoXG4gICAgICB3cmFwcGVyXG4gICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAuZmluZChJbmxpbmVFcnJvckNvbXBvbmVudClcbiAgICAgICAgLnByb3BzKCkudGV4dCxcbiAgICApLnRvRXF1YWwoJ05vdGhpbmcgaXMgU2VsZWN0ZWQnKTtcbiAgfVxufTtcblxuY29uc3QgY3JlYXRlUmFuZG9tT3B0aW9ucyA9ICgpID0+IHtcbiAgY29uc3Qgb3B0aW9ucyA9IFtdO1xuICBjb25zdCBudW1iZXJPZk9wdGlvbnMgPSAoY2hhbmNlLmludGVnZXIoKSAlIDExKSArIDE7XG4gIGZvciAobGV0IGNvdW50ZXIgPSAwOyBjb3VudGVyIDwgbnVtYmVyT2ZPcHRpb25zOyBjb3VudGVyICs9IDEpIHtcbiAgICBvcHRpb25zW2NvdW50ZXJdID0gY2hhbmNlLndvcmQoKTtcbiAgfVxuICByZXR1cm4gb3B0aW9ucztcbn07XG5cbmNvbnN0IGdlbmVyYXRlVGVzdEZvcm1Kc29uID0gKCkgPT4ge1xuICBjb25zdCBuYW1lID0gY2hhbmNlLndvcmQoKTtcbiAgY29uc3QganNvbkZvcm0gPSB7fTtcbiAgY29uc3QgZmllbGRzID0gW107XG4gIGZvciAobGV0IGNvdW50ZXIgPSAwOyBjb3VudGVyIDwgbnVtYmVyT2ZGaWVsZHM7IGNvdW50ZXIgKz0gMSkge1xuICAgIGNvbnN0IHR5cGUgPSByYW5kb21UeXBlKHRydWUpO1xuXG4gICAgbGV0IGZpZWxkID0ge307XG4gICAgaWYgKHR5cGUgPT09ICdyb3dDb21iaW5hdGlvbicpIHtcbiAgICAgIGNvbnN0IG51bWJlck9mU3ViRmllbGRzID0gKGNoYW5jZS5pbnRlZ2VyKCkgJSAxMSkgKyAxO1xuICAgICAgY29uc3Qgc3ViRmllbGRzID0gW107XG4gICAgICBmb3IgKGxldCBjb3VudCA9IDA7IGNvdW50IDwgbnVtYmVyT2ZTdWJGaWVsZHM7IGNvdW50ICs9IDEpIHtcbiAgICAgICAgY29uc3Qgc3ViRmllbGRUeXBlID0gcmFuZG9tVHlwZShmYWxzZSk7XG4gICAgICAgIGNvbnN0IHN1YkZpZWxkID0ge1xuICAgICAgICAgIG5hbWU6IGNoYW5jZS53b3JkKCksXG4gICAgICAgICAgdHlwZTogc3ViRmllbGRUeXBlLFxuICAgICAgICAgIGlkOiBjaGFuY2Uud29yZCgpLFxuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChjaGFuY2UuaW50ZWdlcigpICUgMiA9PT0gMCkge1xuICAgICAgICAgIHN1YkZpZWxkLnZhbGlkYXRpb24gPSAncmVxdWlyZWQnO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGUgPT09ICdyYWRpbycpIHtcbiAgICAgICAgICBzdWJGaWVsZC5vcHRpb25zID0gY3JlYXRlUmFuZG9tT3B0aW9ucygpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHN1YkZpZWxkVHlwZSA9PT0gJ3RleHRBcmVhJyB8fCB0eXBlID09PSAnaW5wdXQnKSB7XG4gICAgICAgICAgc3ViRmllbGQucGxhY2Vob2xkZXIgPSBjaGFuY2Uud29yZCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgc3ViRmllbGRzW2NvdW50XSA9IHN1YkZpZWxkO1xuICAgICAgfVxuXG4gICAgICBmaWVsZCA9IHtcbiAgICAgICAgbmFtZTogY2hhbmNlLndvcmQoKSxcbiAgICAgICAgdHlwZTogJ3Jvd0NvbWJpbmF0aW9uJyxcbiAgICAgICAgZmllbGRzOiBzdWJGaWVsZHMsXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBmaWVsZCA9IHtcbiAgICAgICAgbmFtZTogY2hhbmNlLndvcmQoKSxcbiAgICAgICAgdHlwZSxcbiAgICAgICAgaWQ6IGNoYW5jZS53b3JkKCksXG4gICAgICB9O1xuXG4gICAgICBpZiAoY2hhbmNlLmludGVnZXIoKSAlIDIgPT09IDApIHtcbiAgICAgICAgZmllbGQudmFsaWRhdGlvbiA9ICdyZXF1aXJlZCc7XG4gICAgICB9XG4gICAgICBpZiAodHlwZSA9PT0gJ3JhZGlvJykge1xuICAgICAgICBmaWVsZC5vcHRpb25zID0gY3JlYXRlUmFuZG9tT3B0aW9ucygpO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGUgPT09ICd0ZXh0QXJlYScgfHwgdHlwZSA9PT0gJ2lucHV0Jykge1xuICAgICAgICBmaWVsZC5wbGFjZWhvbGRlciA9IGNoYW5jZS53b3JkKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZmllbGRzW2NvdW50ZXJdID0gZmllbGQ7XG4gIH1cbiAganNvbkZvcm1bbmFtZV0gPSB7fTtcbiAganNvbkZvcm1bbmFtZV0uZGVzY3JpcHRpb24gPSBjaGFuY2Uud29yZCgpO1xuICBqc29uRm9ybVtuYW1lXS5maWVsZHMgPSBmaWVsZHM7XG4gIHJldHVybiBqc29uRm9ybTtcbn07XG5cbmRlc2NyaWJlKCdEeW5hbWljRm9ybScsICgpID0+IHtcbiAgbGV0IHdyYXBwZXI7XG4gIGNvbnN0IHNldFJlcXVlc3QgPSBqZXN0LmZuKCk7XG4gIGNvbnN0IHRlc3RKc29uID0gZ2VuZXJhdGVUZXN0Rm9ybUpzb24oKTtcbiAgY29uc3Qgcm91dGUgPSBqZXN0LmZuKCk7XG4gIGNvbnN0IHJlbmRlckNvbXBvbmVudCA9ICgpID0+XG4gICAgc2hhbGxvdyhcbiAgICAgIDxEeW5hbWljRm9ybUNvbXBvbmVudFxuICAgICAgICBqc29uRm9ybT17KCkgPT4gdGVzdEpzb259XG4gICAgICAgIHNldFJlcXVlc3Q9e3NldFJlcXVlc3R9XG4gICAgICAgIGZvcm09e09iamVjdC5rZXlzKHRlc3RKc29uKVswXX1cbiAgICAgICAgcm91dGU9eygpID0+IHtcbiAgICAgICAgICByb3V0ZSgpO1xuICAgICAgICB9fVxuICAgICAgLz4sXG4gICAgKTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICB3cmFwcGVyID0gcmVuZGVyQ29tcG9uZW50KCk7XG4gIH0pO1xuXG4gIGl0KCdpcyB3cmFwcGVkIGluIGEgU2VnbWVudCcsICgpID0+IHtcbiAgICBleHBlY3Qod3JhcHBlci50eXBlKCkpLnRvRXF1YWwoU2VnbWVudCk7XG4gIH0pO1xuXG4gIGl0KCdpcyBzdHlsZWQgYXMgYSBwYWRkZWQgU2VnbWVudCcsICgpID0+IHtcbiAgICBleHBlY3Qod3JhcHBlci5wcm9wcygpLnBhZGRlZCkudG9CZVRydXRoeSgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnaGVhZGVyJywgKCkgPT4ge1xuICAgIGxldCBoZWFkZXI7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGhlYWRlciA9IHdyYXBwZXIuY2hpbGRBdCgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdpcyBhIGhlYWRlcicsICgpID0+IHtcbiAgICAgIGV4cGVjdChoZWFkZXIudHlwZSgpKS50b0VxdWFsKEhlYWRlcik7XG4gICAgfSk7XG5cbiAgICBpdCgnaXMgaGFzIGFuIGFzIGVxdWFsIHRvIGgzJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGhlYWRlci5wcm9wcygpLmFzKS50b0VxdWFsKCdoMycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2lzIHRoZSBjb3JyZWN0IHRleHQgaW4gdGhlIGhlYWRlcicsICgpID0+IHtcbiAgICAgIGV4cGVjdChoZWFkZXIuY2hpbGRBdCgwKS5kZWJ1ZygpKS50b0VxdWFsKHRlc3RKc29uW09iamVjdC5rZXlzKHRlc3RKc29uKVswXV0uZGVzY3JpcHRpb24pO1xuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoJ2Zvcm0gc2VnbWVudCcsICgpID0+IHtcbiAgICBsZXQgZm9ybVNlZ21lbnQ7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGZvcm1TZWdtZW50ID0gd3JhcHBlci5jaGlsZEF0KDEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2lzIGEgc2VnbWVudCcsICgpID0+IHtcbiAgICAgIGV4cGVjdChmb3JtU2VnbWVudC50eXBlKCkpLnRvRXF1YWwoU2VnbWVudCk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnZm9ybScsICgpID0+IHtcbiAgICAgIGxldCBmb3JtQ29tcG9uZW50O1xuICAgICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgIGZvcm1Db21wb25lbnQgPSBmb3JtU2VnbWVudC5jaGlsZEF0KDApO1xuICAgICAgfSk7XG4gICAgICBpdCgnaXMgYSBmb3JtJywgKCkgPT4ge1xuICAgICAgICBleHBlY3QoZm9ybUNvbXBvbmVudC50eXBlKCkpLnRvRXF1YWwoRm9ybSk7XG4gICAgICB9KTtcblxuICAgICAgZGVzY3JpYmUoJ2Zvcm0gZGF0YScsICgpID0+IHtcbiAgICAgICAgd3JhcHBlciA9IHJlbmRlckNvbXBvbmVudCgpO1xuICAgICAgICB0ZXN0SnNvbltPYmplY3Qua2V5cyh0ZXN0SnNvbilbMF1dLmZpZWxkcy5mb3JFYWNoKChmaWVsZCkgPT4ge1xuICAgICAgICAgIGlmIChmaWVsZC52YWxpZGF0aW9uKSB7XG4gICAgICAgICAgICBjb25zdCBmYWlsID0gY2hhbmNlLmludGVnZXIoKSAlIDI7XG4gICAgICAgICAgICBsZXQgY291bnQgPSAwO1xuICAgICAgICAgICAgY29uc3QgZm9ybSA9IGZvcm1Db21wb25lbnQuY2hpbGRBdCgwKTtcbiAgICAgICAgICAgIGNvbnN0IHNlZ21lbnRPZkZpZWxkcyA9IGZvcm0uY2hpbGRBdCgwKTtcbiAgICAgICAgICAgIGl0KGBmaWVsZCAke2NvdW50fSBpcyBjb3JyZWN0YCwgKCkgPT4ge1xuICAgICAgICAgICAgICBjb25zdCBsYWJlbCA9IHNlZ21lbnRPZkZpZWxkcy5jaGlsZEF0KGNvdW50KS5jaGlsZEF0KDApO1xuICAgICAgICAgICAgICBpZiAoZmllbGQudmFsaWRhdGlvbikge1xuICAgICAgICAgICAgICAgIGV4cGVjdChsYWJlbC50ZXh0KCkpLnRvRXF1YWwoYCAqICR7ZmllbGQubmFtZX1gKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBleHBlY3QobGFiZWwudGV4dCgpKS50b0VxdWFsKGZpZWxkLm5hbWUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGV4cGVjdChcbiAgICAgICAgICAgICAgICB3cmFwcGVyXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgIC5wcm9wcygpLm5hbWUgPT09IGZpZWxkLm5hbWUsXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAnY2hlY2tib3gnKSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KFxuICAgICAgICAgICAgICAgICAgd3JhcHBlclxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdChjb3VudClcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLnR5cGUoKSxcbiAgICAgICAgICAgICAgICApLnRvRXF1YWwoQ2hlY2tib3gpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAncmFkaW8nKSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KFxuICAgICAgICAgICAgICAgICAgd3JhcHBlclxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdChjb3VudClcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLnR5cGUoKSxcbiAgICAgICAgICAgICAgICApLnRvRXF1YWwoUmFkaW8pO1xuICAgICAgICAgICAgICAgIGZhaWxUZXN0KHdyYXBwZXIsIGZpZWxkLCBjb3VudCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICd0ZXh0QXJlYScpIHtcbiAgICAgICAgICAgICAgICBleHBlY3QoXG4gICAgICAgICAgICAgICAgICB3cmFwcGVyXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgICAudHlwZSgpLFxuICAgICAgICAgICAgICAgICkudG9FcXVhbChUZXh0QXJlYSk7XG4gICAgICAgICAgICAgICAgZmFpbFRlc3Qod3JhcHBlciwgZmllbGQsIGNvdW50KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAoZmllbGQudHlwZSA9PT0gJ2Ryb3BEb3duJykge1xuICAgICAgICAgICAgICAgIGV4cGVjdChcbiAgICAgICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAgIC50eXBlKCksXG4gICAgICAgICAgICAgICAgKS50b0VxdWFsKERyb3Bkb3duKTtcbiAgICAgICAgICAgICAgICBmYWlsVGVzdCh3cmFwcGVyLCBmaWVsZCwgY291bnQpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICdyb3dDb21iaW5hdGlvbicpIHtcbiAgICAgICAgICAgICAgICBleHBlY3QoXG4gICAgICAgICAgICAgICAgICB3cmFwcGVyXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgICAudHlwZSgpLFxuICAgICAgICAgICAgICAgICkudG9FcXVhbChGb3JtLkdyb3VwKTtcblxuICAgICAgICAgICAgICAgIGxldCBzdWJGaWVsZENvdW50ZXIgPSAwO1xuICAgICAgICAgICAgICAgIGZpZWxkLmZpZWxkcy5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgICAgICAgICAgICAgICAgY29uc3Qgcm93SW5wdXQgPSB3cmFwcGVyXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdChzdWJGaWVsZENvdW50ZXIpO1xuXG4gICAgICAgICAgICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnaW5wdXQnOlxuICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdChyb3dJbnB1dC50eXBlKCkpLnRvRXF1YWwoSW5wdXQpO1xuICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdkcm9wRG93bic6XG4gICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KHJvd0lucHV0LnR5cGUoKSkudG9FcXVhbChEcm9wZG93bik7XG4gICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3RleHRBcmVhJzpcbiAgICAgICAgICAgICAgICAgICAgICBleHBlY3Qocm93SW5wdXQudHlwZSgpKS50b0VxdWFsKFRleHRBcmVhKTtcbiAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnY2hlY2tib3gnOlxuICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdChyb3dJbnB1dC50eXBlKCkpLnRvRXF1YWwoQ2hlY2tib3gpO1xuICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdyYWRpbyc6XG4gICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KHJvd0lucHV0LnR5cGUoKSkudG9FcXVhbChDaGVja2JveCk7XG4gICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBpZmFpbFRlc3Qod3JhcHBlciwgZmllbGQsIGNvdW50KTtcbiAgICAgICAgICAgICAgICAgIHN1YkZpZWxkQ291bnRlciArPSAxO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICdpbnB1dCcpIHtcbiAgICAgICAgICAgICAgICBleHBlY3QoXG4gICAgICAgICAgICAgICAgICB3cmFwcGVyXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgICAudHlwZSgpLFxuICAgICAgICAgICAgICAgICkudG9FcXVhbChJbnB1dCk7XG5cbiAgICAgICAgICAgICAgICBmYWlsVGVzdCh3cmFwcGVyLCBmaWVsZCwgY291bnQpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNvdW50ICs9IDE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGRlc2NyaWJlKCdGb3JtIEJ1dHRvbicsICgpID0+IHtcbiAgICAgICAgbGV0IGZvcm1CdXR0b247XG5cbiAgICAgICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgICAgZm9ybUJ1dHRvbiA9IGZvcm1Db21wb25lbnQuY2hpbGRBdChudW1iZXJPZkZpZWxkcyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdJdCBpcyBhIGJ1dHRvbicsICgpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhmb3JtQ29tcG9uZW50LmRlYnVnKCkpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKG51bWJlck9mRmllbGRzKTtcbiAgICAgICAgICBleHBlY3QoZm9ybUJ1dHRvbi50eXBlKCkpLnRvRXF1YWwoRm9ybS5CdXR0b24pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19