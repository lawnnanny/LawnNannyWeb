685ea45c80b441e8603c9901db025544
'use strict';

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _semanticUiReact = require('semantic-ui-react');

var _enzyme = require('enzyme');

var _chance = require('chance');

var _DynamicForm = require('../../../src/components/helpers/DynamicForm');

var _DynamicForm2 = _interopRequireDefault(_DynamicForm);

var _InlineError = require('../../../src/components/helpers/InlineError');

var _InlineError2 = _interopRequireDefault(_InlineError);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var chance = new _chance.Chance();

var randomType = function randomType(useRowCombination) {
  switch (chance.integer() % 5) {
    case 0:
      return 'textArea';
    case 1:
      return 'radio';
    case 2:
      return 'checkbox';
    case 3:
      return 'input';
    case 4:
      if (useRowCombination) {
        return 'rowCombination';
      }
      return 'input';
    default:
      return 'textArea';
  }
};

var failTest = function failTest(wrapper, field, count) {
  if (chance.integer() % 2) {
    var state = { errors: {} };
    state.errors[field.id] = 'Nothing is Selected';
    wrapper.setState(state);
    wrapper.update();
    expect(wrapper.childAt(1).childAt(0).childAt(count).find(_InlineError2.default).props().text).toEqual('Nothing is Selected');
  }
};

var createRandomOptions = function createRandomOptions() {
  var options = [];
  var numberOfOptions = chance.integer() % 11 + 1;
  for (var counter = 0; counter < numberOfOptions; counter += 1) {
    options[counter] = chance.word();
  }
  return options;
};

var generateTestFormJson = function generateTestFormJson() {
  var name = chance.word();
  var jsonForm = {};
  var numberOfFields = chance.integer() % 11 + 1;
  var fields = [];
  for (var counter = 0; counter < numberOfFields; counter += 1) {
    var type = randomType(true);

    var field = {};
    if (type === 'rowCombination') {
      var numberOfSubFields = chance.integer() % 11 + 1;
      var subFields = [];
      for (var count = 0; count < numberOfSubFields; count += 1) {
        var subFieldType = randomType(false);
        var subField = {
          name: chance.word(),
          type: subFieldType,
          id: chance.word()
        };

        if (chance.integer() % 2 === 0) {
          subField.validation = 'required';
        }

        if (type === 'radio') {
          subField.options = createRandomOptions();
        }

        if (subFieldType === 'textArea' || type === 'input') {
          subField.placeholder = chance.word();
        }

        subFields[count] = subField;
      }

      field = {
        name: chance.word(),
        type: 'rowCombination',
        fields: subFields
      };
    } else {
      field = {
        name: chance.word(),
        type: type,
        id: chance.word()
      };

      if (chance.integer() % 2 === 0) {
        field.validation = 'required';
      }
      if (type === 'radio') {
        field.options = createRandomOptions();
      }
      if (type === 'textArea' || type === 'input') {
        field.placeholder = chance.word();
      }
    }

    fields[counter] = field;
  }
  jsonForm[name] = {};
  jsonForm[name].fields = fields;
  return jsonForm;
};

describe('DynamicForm', function () {
  var wrapper = void 0;
  var setRequest = jest.fn();
  var testJson = generateTestFormJson();
  var _route = jest.fn();
  var renderComponent = function renderComponent() {
    return (0, _enzyme.shallow)(_react2.default.createElement(_DynamicForm2.default, {
      jsonForm: function jsonForm() {
        return testJson;
      },
      setRequest: setRequest,
      form: Object.keys(testJson)[0],
      route: function route() {
        _route();
      }
    }));
  };

  beforeEach(function () {
    wrapper = renderComponent();
  });

  it('is wrapped in a Segment', function () {
    expect(wrapper.type()).toEqual(_semanticUiReact.Segment);
  });

  it('is styled as a padded Segment', function () {
    expect(wrapper.props().padded).toBeTruthy();
  });

  describe('header', function () {
    var header = void 0;

    beforeEach(function () {
      header = wrapper.childAt(0);
    });

    it('is a header', function () {
      expect(header.type()).toEqual(_semanticUiReact.Header);
    });

    it('is has a large size', function () {
      expect(header.props().size).toEqual('large');
    });

    it('is the correct text in the header', function () {
      expect(header.childAt(0).debug()).toEqual(Object.keys(testJson)[0]);
    });
  });

  describe('form', function () {
    it('is a form', function () {
      expect(wrapper.childAt(1).type()).toEqual(_semanticUiReact.Form);
    });

    describe('form data', function () {
      wrapper = renderComponent();
      testJson[Object.keys(testJson)[0]].fields.forEach(function (field) {
        if (field.validation) {
          var fail = chance.integer() % 2;
          var count = 0;
          var form = wrapper.childAt(1);
          var segmentOfFields = form.childAt(0);
          it('field ' + count + ' is correct', function () {
            var label = segmentOfFields.childAt(count).childAt(0);
            if (field.validation) {
              expect(label.text()).toEqual(' * ' + field.name);
            } else {
              expect(label.text()).toEqual(field.name);
            }
            expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).props().name === field.name);
            if (field.type === 'checkbox') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Checkbox);
            }
            if (field.type === 'radio') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Radio);
              failTest(wrapper, field, count);
            }
            if (field.type === 'textArea') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.TextArea);
              failTest(wrapper, field, count);
            }
            if (field.type === 'dropDown') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Dropdown);
              failTest(wrapper, field, count);
            }

            if (field.type === 'rowCombination') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Form.Group);

              var subFieldCounter = 0;
              field.fields.forEach(function (input) {
                var rowInput = wrapper.childAt(1).childAt(0).childAt(count).childAt(1).childAt(subFieldCounter);

                switch (input.type) {
                  case 'input':
                    expect(rowInput.type()).toEqual(_semanticUiReact.Input);
                    break;
                  case 'dropDown':
                    expect(rowInput.type()).toEqual(_semanticUiReact.Dropdown);
                    break;
                  case 'textArea':
                    expect(rowInput.type()).toEqual(_semanticUiReact.TextArea);
                    break;
                  case 'checkbox':
                    expect(rowInput.type()).toEqual(_semanticUiReact.Checkbox);
                    break;
                  case 'radio':
                    expect(rowInput.type()).toEqual(_semanticUiReact.Checkbox);
                    break;
                  default:
                }
                ifailTest(wrapper, field, count);
                subFieldCounter += 1;
              });
            }

            if (field.type === 'input') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Input);

              failTest(wrapper, field, count);
            }
            count += 1;
          });
        }
      });
    });
  });

  describe('Submit Button', function () {
    var submitSegment = void 0;

    beforeEach(function () {
      submitSegment = wrapper.childAt(1).childAt(1);
    });

    it('It is a segment', function () {
      expect(submitSegment.type()).toEqual(_semanticUiReact.Segment);
    });

    it('There is a button in the segment', function () {
      var button = submitSegment.childAt(0);
      expect(button.type()).toEqual(_semanticUiReact.Button);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkR5bmFtaWNGb3JtLnNwZWMuanMiXSwibmFtZXMiOlsiY2hhbmNlIiwiQ2hhbmNlIiwicmFuZG9tVHlwZSIsInVzZVJvd0NvbWJpbmF0aW9uIiwiaW50ZWdlciIsImZhaWxUZXN0Iiwid3JhcHBlciIsImZpZWxkIiwiY291bnQiLCJzdGF0ZSIsImVycm9ycyIsImlkIiwic2V0U3RhdGUiLCJ1cGRhdGUiLCJleHBlY3QiLCJjaGlsZEF0IiwiZmluZCIsIklubGluZUVycm9yQ29tcG9uZW50IiwicHJvcHMiLCJ0ZXh0IiwidG9FcXVhbCIsImNyZWF0ZVJhbmRvbU9wdGlvbnMiLCJvcHRpb25zIiwibnVtYmVyT2ZPcHRpb25zIiwiY291bnRlciIsIndvcmQiLCJnZW5lcmF0ZVRlc3RGb3JtSnNvbiIsIm5hbWUiLCJqc29uRm9ybSIsIm51bWJlck9mRmllbGRzIiwiZmllbGRzIiwidHlwZSIsIm51bWJlck9mU3ViRmllbGRzIiwic3ViRmllbGRzIiwic3ViRmllbGRUeXBlIiwic3ViRmllbGQiLCJ2YWxpZGF0aW9uIiwicGxhY2Vob2xkZXIiLCJkZXNjcmliZSIsInNldFJlcXVlc3QiLCJqZXN0IiwiZm4iLCJ0ZXN0SnNvbiIsInJvdXRlIiwicmVuZGVyQ29tcG9uZW50IiwiT2JqZWN0Iiwia2V5cyIsImJlZm9yZUVhY2giLCJpdCIsIlNlZ21lbnQiLCJwYWRkZWQiLCJ0b0JlVHJ1dGh5IiwiaGVhZGVyIiwiSGVhZGVyIiwic2l6ZSIsImRlYnVnIiwiRm9ybSIsImZvckVhY2giLCJmYWlsIiwiZm9ybSIsInNlZ21lbnRPZkZpZWxkcyIsImxhYmVsIiwiQ2hlY2tib3giLCJSYWRpbyIsIlRleHRBcmVhIiwiRHJvcGRvd24iLCJHcm91cCIsInN1YkZpZWxkQ291bnRlciIsImlucHV0Iiwicm93SW5wdXQiLCJJbnB1dCIsImlmYWlsVGVzdCIsInN1Ym1pdFNlZ21lbnQiLCJidXR0b24iLCJCdXR0b24iXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7QUFDQTs7QUFXQTs7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QTBCQyxLQUExQjtBQUNBMkQsbUNBQW1CLENBQW5CO0FBQ0QsZUE1QkQ7QUE2QkQ7O0FBRUQsZ0JBQUk1RCxNQUFNd0IsSUFBTixLQUFlLE9BQW5CLEVBQTRCO0FBQzFCakIscUJBQ0VSLFFBQ0dTLE9BREgsQ0FDVyxDQURYLEVBRUdBLE9BRkgsQ0FFVyxDQUZYLEVBR0dBLE9BSEgsQ0FHV1AsS0FIWCxFQUlHTyxPQUpILENBSVcsQ0FKWCxFQUtHZ0IsSUFMSCxFQURGLEVBT0VYLE9BUEYsQ0FPVWtELHNCQVBWOztBQVNBakUsdUJBQVNDLE9BQVQsRUFBa0JDLEtBQWxCLEVBQXlCQyxLQUF6QjtBQUNEO0FBQ0RBLHFCQUFTLENBQVQ7QUFDRCxXQWxIRDtBQW1IRDtBQUNGLE9BMUhEO0FBMkhELEtBN0hEO0FBOEhELEdBcElEOztBQXNJQThCLFdBQVMsZUFBVCxFQUEwQixZQUFNO0FBQzlCLFFBQUlrQyxzQkFBSjs7QUFFQXpCLGVBQVcsWUFBTTtBQUNmeUIsc0JBQWdCbEUsUUFBUVMsT0FBUixDQUFnQixDQUFoQixFQUFtQkEsT0FBbkIsQ0FBMkIsQ0FBM0IsQ0FBaEI7QUFDRCxLQUZEOztBQUlBaUMsT0FBRyxpQkFBSCxFQUFzQixZQUFNO0FBQzFCbEMsYUFBTzBELGNBQWN6QyxJQUFkLEVBQVAsRUFBNkJYLE9BQTdCLENBQXFDNkIsd0JBQXJDO0FBQ0QsS0FGRDs7QUFJQUQsT0FBRyxrQ0FBSCxFQUF1QyxZQUFNO0FBQzNDLFVBQU15QixTQUFTRCxjQUFjekQsT0FBZCxDQUFzQixDQUF0QixDQUFmO0FBQ0FELGFBQU8yRCxPQUFPMUMsSUFBUCxFQUFQLEVBQXNCWCxPQUF0QixDQUE4QnNELHVCQUE5QjtBQUNELEtBSEQ7QUFJRCxHQWZEO0FBZ0JELENBdk1EIiwiZmlsZSI6IkR5bmFtaWNGb3JtLnNwZWMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtcbiAgQnV0dG9uLFxuICBGb3JtLFxuICBTZWdtZW50LFxuICBIZWFkZXIsXG4gIFJhZGlvLFxuICBDaGVja2JveCxcbiAgVGV4dEFyZWEsXG4gIERyb3Bkb3duLFxuICBJbnB1dCxcbn0gZnJvbSAnc2VtYW50aWMtdWktcmVhY3QnO1xuaW1wb3J0IHsgc2hhbGxvdyB9IGZyb20gJ2VuenltZSc7XG5pbXBvcnQgeyBDaGFuY2UgfSBmcm9tICdjaGFuY2UnO1xuaW1wb3J0IER5bmFtaWNGb3JtQ29tcG9uZW50IGZyb20gJy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL2hlbHBlcnMvRHluYW1pY0Zvcm0nO1xuaW1wb3J0IElubGluZUVycm9yQ29tcG9uZW50IGZyb20gJy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL2hlbHBlcnMvSW5saW5lRXJyb3InO1xuXG5jb25zdCBjaGFuY2UgPSBuZXcgQ2hhbmNlKCk7XG5cbmNvbnN0IHJhbmRvbVR5cGUgPSAodXNlUm93Q29tYmluYXRpb24pID0+IHtcbiAgc3dpdGNoIChjaGFuY2UuaW50ZWdlcigpICUgNSkge1xuICAgIGNhc2UgMDpcbiAgICAgIHJldHVybiAndGV4dEFyZWEnO1xuICAgIGNhc2UgMTpcbiAgICAgIHJldHVybiAncmFkaW8nO1xuICAgIGNhc2UgMjpcbiAgICAgIHJldHVybiAnY2hlY2tib3gnO1xuICAgIGNhc2UgMzpcbiAgICAgIHJldHVybiAnaW5wdXQnO1xuICAgIGNhc2UgNDpcbiAgICAgIGlmICh1c2VSb3dDb21iaW5hdGlvbikge1xuICAgICAgICByZXR1cm4gJ3Jvd0NvbWJpbmF0aW9uJztcbiAgICAgIH1cbiAgICAgIHJldHVybiAnaW5wdXQnO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gJ3RleHRBcmVhJztcbiAgfVxufTtcblxuY29uc3QgZmFpbFRlc3QgPSAod3JhcHBlciwgZmllbGQsIGNvdW50KSA9PiB7XG4gIGlmIChjaGFuY2UuaW50ZWdlcigpICUgMikge1xuICAgIGNvbnN0IHN0YXRlID0geyBlcnJvcnM6IHt9IH07XG4gICAgc3RhdGUuZXJyb3JzW2ZpZWxkLmlkXSA9ICdOb3RoaW5nIGlzIFNlbGVjdGVkJztcbiAgICB3cmFwcGVyLnNldFN0YXRlKHN0YXRlKTtcbiAgICB3cmFwcGVyLnVwZGF0ZSgpO1xuICAgIGV4cGVjdChcbiAgICAgIHdyYXBwZXJcbiAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgIC5maW5kKElubGluZUVycm9yQ29tcG9uZW50KVxuICAgICAgICAucHJvcHMoKS50ZXh0LFxuICAgICkudG9FcXVhbCgnTm90aGluZyBpcyBTZWxlY3RlZCcpO1xuICB9XG59O1xuXG5jb25zdCBjcmVhdGVSYW5kb21PcHRpb25zID0gKCkgPT4ge1xuICBjb25zdCBvcHRpb25zID0gW107XG4gIGNvbnN0IG51bWJlck9mT3B0aW9ucyA9IChjaGFuY2UuaW50ZWdlcigpICUgMTEpICsgMTtcbiAgZm9yIChsZXQgY291bnRlciA9IDA7IGNvdW50ZXIgPCBudW1iZXJPZk9wdGlvbnM7IGNvdW50ZXIgKz0gMSkge1xuICAgIG9wdGlvbnNbY291bnRlcl0gPSBjaGFuY2Uud29yZCgpO1xuICB9XG4gIHJldHVybiBvcHRpb25zO1xufTtcblxuY29uc3QgZ2VuZXJhdGVUZXN0Rm9ybUpzb24gPSAoKSA9PiB7XG4gIGNvbnN0IG5hbWUgPSBjaGFuY2Uud29yZCgpO1xuICBjb25zdCBqc29uRm9ybSA9IHt9O1xuICBjb25zdCBudW1iZXJPZkZpZWxkcyA9IChjaGFuY2UuaW50ZWdlcigpICUgMTEpICsgMTtcbiAgY29uc3QgZmllbGRzID0gW107XG4gIGZvciAobGV0IGNvdW50ZXIgPSAwOyBjb3VudGVyIDwgbnVtYmVyT2ZGaWVsZHM7IGNvdW50ZXIgKz0gMSkge1xuICAgIGNvbnN0IHR5cGUgPSByYW5kb21UeXBlKHRydWUpO1xuXG4gICAgbGV0IGZpZWxkID0ge307XG4gICAgaWYgKHR5cGUgPT09ICdyb3dDb21iaW5hdGlvbicpIHtcbiAgICAgIGNvbnN0IG51bWJlck9mU3ViRmllbGRzID0gKGNoYW5jZS5pbnRlZ2VyKCkgJSAxMSkgKyAxO1xuICAgICAgY29uc3Qgc3ViRmllbGRzID0gW107XG4gICAgICBmb3IgKGxldCBjb3VudCA9IDA7IGNvdW50IDwgbnVtYmVyT2ZTdWJGaWVsZHM7IGNvdW50ICs9IDEpIHtcbiAgICAgICAgY29uc3Qgc3ViRmllbGRUeXBlID0gcmFuZG9tVHlwZShmYWxzZSk7XG4gICAgICAgIGNvbnN0IHN1YkZpZWxkID0ge1xuICAgICAgICAgIG5hbWU6IGNoYW5jZS53b3JkKCksXG4gICAgICAgICAgdHlwZTogc3ViRmllbGRUeXBlLFxuICAgICAgICAgIGlkOiBjaGFuY2Uud29yZCgpLFxuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChjaGFuY2UuaW50ZWdlcigpICUgMiA9PT0gMCkge1xuICAgICAgICAgIHN1YkZpZWxkLnZhbGlkYXRpb24gPSAncmVxdWlyZWQnO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGUgPT09ICdyYWRpbycpIHtcbiAgICAgICAgICBzdWJGaWVsZC5vcHRpb25zID0gY3JlYXRlUmFuZG9tT3B0aW9ucygpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHN1YkZpZWxkVHlwZSA9PT0gJ3RleHRBcmVhJyB8fCB0eXBlID09PSAnaW5wdXQnKSB7XG4gICAgICAgICAgc3ViRmllbGQucGxhY2Vob2xkZXIgPSBjaGFuY2Uud29yZCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgc3ViRmllbGRzW2NvdW50XSA9IHN1YkZpZWxkO1xuICAgICAgfVxuXG4gICAgICBmaWVsZCA9IHtcbiAgICAgICAgbmFtZTogY2hhbmNlLndvcmQoKSxcbiAgICAgICAgdHlwZTogJ3Jvd0NvbWJpbmF0aW9uJyxcbiAgICAgICAgZmllbGRzOiBzdWJGaWVsZHMsXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBmaWVsZCA9IHtcbiAgICAgICAgbmFtZTogY2hhbmNlLndvcmQoKSxcbiAgICAgICAgdHlwZSxcbiAgICAgICAgaWQ6IGNoYW5jZS53b3JkKCksXG4gICAgICB9O1xuXG4gICAgICBpZiAoY2hhbmNlLmludGVnZXIoKSAlIDIgPT09IDApIHtcbiAgICAgICAgZmllbGQudmFsaWRhdGlvbiA9ICdyZXF1aXJlZCc7XG4gICAgICB9XG4gICAgICBpZiAodHlwZSA9PT0gJ3JhZGlvJykge1xuICAgICAgICBmaWVsZC5vcHRpb25zID0gY3JlYXRlUmFuZG9tT3B0aW9ucygpO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGUgPT09ICd0ZXh0QXJlYScgfHwgdHlwZSA9PT0gJ2lucHV0Jykge1xuICAgICAgICBmaWVsZC5wbGFjZWhvbGRlciA9IGNoYW5jZS53b3JkKCk7XG4gICAgICB9XG4gICAgfVxuXG5cbiAgICBmaWVsZHNbY291bnRlcl0gPSBmaWVsZDtcbiAgfVxuICBqc29uRm9ybVtuYW1lXSA9IHt9O1xuICBqc29uRm9ybVtuYW1lXS5maWVsZHMgPSBmaWVsZHM7XG4gIHJldHVybiBqc29uRm9ybTtcbn07XG5cbmRlc2NyaWJlKCdEeW5hbWljRm9ybScsICgpID0+IHtcbiAgbGV0IHdyYXBwZXI7XG4gIGNvbnN0IHNldFJlcXVlc3QgPSBqZXN0LmZuKCk7XG4gIGNvbnN0IHRlc3RKc29uID0gZ2VuZXJhdGVUZXN0Rm9ybUpzb24oKTtcbiAgY29uc3Qgcm91dGUgPSBqZXN0LmZuKCk7XG4gIGNvbnN0IHJlbmRlckNvbXBvbmVudCA9ICgpID0+XG4gICAgc2hhbGxvdyhcbiAgICAgIDxEeW5hbWljRm9ybUNvbXBvbmVudFxuICAgICAgICBqc29uRm9ybT17KCkgPT4gdGVzdEpzb259XG4gICAgICAgIHNldFJlcXVlc3Q9e3NldFJlcXVlc3R9XG4gICAgICAgIGZvcm09e09iamVjdC5rZXlzKHRlc3RKc29uKVswXX1cbiAgICAgICAgcm91dGU9eygpID0+IHtcbiAgICAgICAgICByb3V0ZSgpO1xuICAgICAgICB9fVxuICAgICAgLz4sXG4gICAgKTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICB3cmFwcGVyID0gcmVuZGVyQ29tcG9uZW50KCk7XG4gIH0pO1xuXG4gIGl0KCdpcyB3cmFwcGVkIGluIGEgU2VnbWVudCcsICgpID0+IHtcbiAgICBleHBlY3Qod3JhcHBlci50eXBlKCkpLnRvRXF1YWwoU2VnbWVudCk7XG4gIH0pO1xuXG4gIGl0KCdpcyBzdHlsZWQgYXMgYSBwYWRkZWQgU2VnbWVudCcsICgpID0+IHtcbiAgICBleHBlY3Qod3JhcHBlci5wcm9wcygpLnBhZGRlZCkudG9CZVRydXRoeSgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnaGVhZGVyJywgKCkgPT4ge1xuICAgIGxldCBoZWFkZXI7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGhlYWRlciA9IHdyYXBwZXIuY2hpbGRBdCgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdpcyBhIGhlYWRlcicsICgpID0+IHtcbiAgICAgIGV4cGVjdChoZWFkZXIudHlwZSgpKS50b0VxdWFsKEhlYWRlcik7XG4gICAgfSk7XG5cbiAgICBpdCgnaXMgaGFzIGEgbGFyZ2Ugc2l6ZScsICgpID0+IHtcbiAgICAgIGV4cGVjdChoZWFkZXIucHJvcHMoKS5zaXplKS50b0VxdWFsKCdsYXJnZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2lzIHRoZSBjb3JyZWN0IHRleHQgaW4gdGhlIGhlYWRlcicsICgpID0+IHtcbiAgICAgIGV4cGVjdChoZWFkZXIuY2hpbGRBdCgwKS5kZWJ1ZygpKS50b0VxdWFsKE9iamVjdC5rZXlzKHRlc3RKc29uKVswXSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdmb3JtJywgKCkgPT4ge1xuICAgIGl0KCdpcyBhIGZvcm0nLCAoKSA9PiB7XG4gICAgICBleHBlY3Qod3JhcHBlci5jaGlsZEF0KDEpLnR5cGUoKSkudG9FcXVhbChGb3JtKTtcbiAgICB9KTtcblxuXG4gICAgZGVzY3JpYmUoJ2Zvcm0gZGF0YScsICgpID0+IHtcbiAgICAgIHdyYXBwZXIgPSByZW5kZXJDb21wb25lbnQoKTtcbiAgICAgIHRlc3RKc29uW09iamVjdC5rZXlzKHRlc3RKc29uKVswXV0uZmllbGRzLmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgICAgIGlmIChmaWVsZC52YWxpZGF0aW9uKSB7XG4gICAgICAgICAgY29uc3QgZmFpbCA9IGNoYW5jZS5pbnRlZ2VyKCkgJSAyO1xuICAgICAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICAgICAgY29uc3QgZm9ybSA9IHdyYXBwZXIuY2hpbGRBdCgxKTtcbiAgICAgICAgICBjb25zdCBzZWdtZW50T2ZGaWVsZHMgPSBmb3JtLmNoaWxkQXQoMCk7XG4gICAgICAgICAgaXQoYGZpZWxkICR7Y291bnR9IGlzIGNvcnJlY3RgLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBsYWJlbCA9IHNlZ21lbnRPZkZpZWxkcy5jaGlsZEF0KGNvdW50KS5jaGlsZEF0KDApO1xuICAgICAgICAgICAgaWYgKGZpZWxkLnZhbGlkYXRpb24pIHtcbiAgICAgICAgICAgICAgZXhwZWN0KGxhYmVsLnRleHQoKSkudG9FcXVhbChgICogJHtmaWVsZC5uYW1lfWApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZXhwZWN0KGxhYmVsLnRleHQoKSkudG9FcXVhbChmaWVsZC5uYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGV4cGVjdChcbiAgICAgICAgICAgICAgd3JhcHBlclxuICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgICAgICAgICAuY2hpbGRBdChjb3VudClcbiAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgIC5wcm9wcygpLm5hbWUgPT09IGZpZWxkLm5hbWUsXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICdjaGVja2JveCcpIHtcbiAgICAgICAgICAgICAgZXhwZWN0KFxuICAgICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLnR5cGUoKSxcbiAgICAgICAgICAgICAgKS50b0VxdWFsKENoZWNrYm94KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAncmFkaW8nKSB7XG4gICAgICAgICAgICAgIGV4cGVjdChcbiAgICAgICAgICAgICAgICB3cmFwcGVyXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgIC50eXBlKCksXG4gICAgICAgICAgICAgICkudG9FcXVhbChSYWRpbyk7XG4gICAgICAgICAgICAgIGZhaWxUZXN0KHdyYXBwZXIsIGZpZWxkLCBjb3VudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZmllbGQudHlwZSA9PT0gJ3RleHRBcmVhJykge1xuICAgICAgICAgICAgICBleHBlY3QoXG4gICAgICAgICAgICAgICAgd3JhcHBlclxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdChjb3VudClcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAudHlwZSgpLFxuICAgICAgICAgICAgICApLnRvRXF1YWwoVGV4dEFyZWEpO1xuICAgICAgICAgICAgICBmYWlsVGVzdCh3cmFwcGVyLCBmaWVsZCwgY291bnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICdkcm9wRG93bicpIHtcbiAgICAgICAgICAgICAgZXhwZWN0KFxuICAgICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLnR5cGUoKSxcbiAgICAgICAgICAgICAgKS50b0VxdWFsKERyb3Bkb3duKTtcbiAgICAgICAgICAgICAgZmFpbFRlc3Qod3JhcHBlciwgZmllbGQsIGNvdW50KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICdyb3dDb21iaW5hdGlvbicpIHtcbiAgICAgICAgICAgICAgZXhwZWN0KFxuICAgICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLnR5cGUoKSxcbiAgICAgICAgICAgICAgKS50b0VxdWFsKEZvcm0uR3JvdXApO1xuXG4gICAgICAgICAgICAgIGxldCBzdWJGaWVsZENvdW50ZXIgPSAwO1xuICAgICAgICAgICAgICBmaWVsZC5maWVsZHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByb3dJbnB1dCA9IHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoc3ViRmllbGRDb3VudGVyKTtcblxuICAgICAgICAgICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkge1xuICAgICAgICAgICAgICAgICAgY2FzZSAnaW5wdXQnOlxuICAgICAgICAgICAgICAgICAgICBleHBlY3Qocm93SW5wdXQudHlwZSgpKS50b0VxdWFsKElucHV0KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICBjYXNlICdkcm9wRG93bic6XG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChyb3dJbnB1dC50eXBlKCkpLnRvRXF1YWwoRHJvcGRvd24pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIGNhc2UgJ3RleHRBcmVhJzpcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KHJvd0lucHV0LnR5cGUoKSkudG9FcXVhbChUZXh0QXJlYSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgY2FzZSAnY2hlY2tib3gnOlxuICAgICAgICAgICAgICAgICAgICBleHBlY3Qocm93SW5wdXQudHlwZSgpKS50b0VxdWFsKENoZWNrYm94KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICBjYXNlICdyYWRpbyc6XG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChyb3dJbnB1dC50eXBlKCkpLnRvRXF1YWwoQ2hlY2tib3gpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmYWlsVGVzdCh3cmFwcGVyLCBmaWVsZCwgY291bnQpO1xuICAgICAgICAgICAgICAgIHN1YkZpZWxkQ291bnRlciArPSAxO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICdpbnB1dCcpIHtcbiAgICAgICAgICAgICAgZXhwZWN0KFxuICAgICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLnR5cGUoKSxcbiAgICAgICAgICAgICAgKS50b0VxdWFsKElucHV0KTtcblxuICAgICAgICAgICAgICBmYWlsVGVzdCh3cmFwcGVyLCBmaWVsZCwgY291bnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY291bnQgKz0gMTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTdWJtaXQgQnV0dG9uJywgKCkgPT4ge1xuICAgIGxldCBzdWJtaXRTZWdtZW50O1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBzdWJtaXRTZWdtZW50ID0gd3JhcHBlci5jaGlsZEF0KDEpLmNoaWxkQXQoMSk7XG4gICAgfSk7XG5cbiAgICBpdCgnSXQgaXMgYSBzZWdtZW50JywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHN1Ym1pdFNlZ21lbnQudHlwZSgpKS50b0VxdWFsKFNlZ21lbnQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ1RoZXJlIGlzIGEgYnV0dG9uIGluIHRoZSBzZWdtZW50JywgKCkgPT4ge1xuICAgICAgY29uc3QgYnV0dG9uID0gc3VibWl0U2VnbWVudC5jaGlsZEF0KDApO1xuICAgICAgZXhwZWN0KGJ1dHRvbi50eXBlKCkpLnRvRXF1YWwoQnV0dG9uKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==