16638f8f32c6475c202e0e9ac3e91e90
'use strict';

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _semanticUiReact = require('semantic-ui-react');

var _enzyme = require('enzyme');

var _chance = require('chance');

var _DynamicForm = require('../../../src/components/helpers/DynamicForm');

var _DynamicForm2 = _interopRequireDefault(_DynamicForm);

var _InlineError = require('../../../src/components/helpers/InlineError');

var _InlineError2 = _interopRequireDefault(_InlineError);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var chance = new _chance.Chance();

var numberOfFields = Math.abs(chance.integer()) % 11 + 1;

var randomType = function randomType(useRowCombination) {
  switch (chance.integer() % 5) {
    case 0:
      return 'textArea';
    case 1:
      return 'radio';
    case 2:
      return 'checkbox';
    case 3:
      return 'input';
    case 4:
      if (useRowCombination) {
        return 'rowCombination';
      }
      return 'input';
    default:
      return 'textArea';
  }
};

var failTest = function failTest(wrapper, field, count) {
  if (chance.integer() % 2 && field.validation) {
    var state = { errors: {} };
    state.errors[field.id] = 'Nothing is Selected';
    wrapper.setState(state);
    wrapper.update();
    expect(wrapper.childAt(1).childAt(0).childAt(count).find(_InlineError2.default).props().text).toEqual('Nothing is Selected');
  }
};

var createRandomOptions = function createRandomOptions() {
  var options = [];
  var numberOfOptions = chance.integer() % 11 + 1;
  for (var counter = 0; counter < numberOfOptions; counter += 1) {
    options[counter] = chance.word();
  }
  return options;
};

var generateTestFormJson = function generateTestFormJson() {
  var name = chance.word();
  var jsonForm = {};
  var fields = [];
  for (var counter = 0; counter < numberOfFields; counter += 1) {
    var type = randomType(true);

    var field = {};
    if (type === 'rowCombination') {
      var numberOfSubFields = chance.integer() % 11 + 1;
      var subFields = [];
      for (var counting = 0; counting < numberOfSubFields; counting += 1) {
        var subFieldType = randomType(false);
        var subField = {
          name: chance.word(),
          type: subFieldType,
          id: chance.word()
        };

        if (chance.integer() % 2 === 0) {
          subField.validation = 'required';
        }

        if (type === 'radio') {
          subField.options = createRandomOptions();
        }

        if (subFieldType === 'textArea' || type === 'input') {
          subField.placeholder = chance.word();
        }

        subFields[counting] = subField;
      }

      field = {
        name: chance.word(),
        type: 'rowCombination',
        fields: subFields
      };
    } else {
      field = {
        name: chance.word(),
        type: type,
        id: chance.word()
      };

      if (chance.integer() % 2 === 0) {
        field.validation = 'required';
      }
      if (type === 'radio') {
        field.options = createRandomOptions();
      }
      if (type === 'textArea' || type === 'input') {
        field.placeholder = chance.word();
      }
    }

    fields[counter] = field;
  }
  jsonForm[name] = {};
  jsonForm[name].description = chance.word();
  jsonForm[name].fields = fields;
  return jsonForm;
};

describe('DynamicForm', function () {
  var wrapper = void 0;
  var setRequest = jest.fn();
  var testJson = generateTestFormJson();
  var _route = jest.fn();
  var renderComponent = function renderComponent() {
    return (0, _enzyme.shallow)(_react2.default.createElement(_DynamicForm2.default, {
      jsonForm: function jsonForm() {
        return testJson;
      },
      setRequest: setRequest,
      form: Object.keys(testJson)[0],
      route: function route() {
        _route();
      }
    }));
  };

  beforeEach(function () {
    wrapper = renderComponent();
  });

  it('is wrapped in a Segment', function () {
    expect(wrapper.type()).toEqual(_semanticUiReact.Segment);
  });

  it('is styled as a padded Segment', function () {
    expect(wrapper.props().padded).toBeTruthy();
  });

  describe('header', function () {
    var header = void 0;

    beforeEach(function () {
      header = wrapper.childAt(0);
    });

    it('is a header', function () {
      expect(header.type()).toEqual(_semanticUiReact.Header);
    });

    it('is has an as equal to h3', function () {
      expect(header.props().as).toEqual('h3');
    });

    it('is the correct text in the header', function () {
      expect(header.childAt(0).debug()).toEqual(testJson[Object.keys(testJson)[0]].description);
    });
  });
  describe('form segment', function () {
    var formSegment = void 0;

    beforeEach(function () {
      formSegment = wrapper.childAt(1);
    });

    it('is a segment', function () {
      expect(formSegment.type()).toEqual(_semanticUiReact.Segment);
    });

    describe('form', function () {
      var formComponent = void 0;
      beforeEach(function () {
        formComponent = formSegment.childAt(0);
      });
      it('is a form', function () {
        expect(formComponent.type()).toEqual(_semanticUiReact.Form);
      });

      describe('form data', function () {
        wrapper = renderComponent();
        formSegment = wrapper.childAt(1);
        formComponent = formSegment.childAt(0);
        console.log(formComponent.debug());
        var count = 0;
        testJson[Object.keys(testJson)[0]].fields.forEach(function (field) {
          console.log(field);
          console.log(count);
          it('field ' + count + ' is correct', function () {
            count += 1;
            var label = formComponent.childAt(count).childAt(0);
            if (field.validation) {
              expect(label.text()).toEqual(' * ' + field.name);
            } else {
              expect(label.text()).toEqual(field.name);
            }
            expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).props().name === field.name);
            if (field.type === 'checkbox') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Checkbox);
              failTest(wrapper, field, count);
            }
            if (field.type === 'radio') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Radio);
              failTest(wrapper, field, count);
            }
            if (field.type === 'textArea') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.TextArea);
              failTest(wrapper, field, count);
            }
            if (field.type === 'dropDown') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Dropdown);
              failTest(wrapper, field, count);
            }

            if (field.type === 'rowCombination') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Form.Group);

              var subFieldCounter = 0;
              field.fields.forEach(function (input) {
                var rowInput = wrapper.childAt(1).childAt(0).childAt(count).childAt(1).childAt(subFieldCounter);

                switch (input.type) {
                  case 'input':
                    expect(rowInput.type()).toEqual(_semanticUiReact.Input);
                    break;
                  case 'dropDown':
                    expect(rowInput.type()).toEqual(_semanticUiReact.Dropdown);
                    break;
                  case 'textArea':
                    expect(rowInput.type()).toEqual(_semanticUiReact.TextArea);
                    break;
                  case 'checkbox':
                    expect(rowInput.type()).toEqual(_semanticUiReact.Checkbox);
                    break;
                  case 'radio':
                    expect(rowInput.type()).toEqual(_semanticUiReact.Checkbox);
                    break;
                  default:
                }
                failTest(wrapper, field, count);
                subFieldCounter += 1;
              });
            }

            if (field.type === 'input') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Input);

              failTest(wrapper, field, count);
            }
          });
          count += 1;
        });
      });

      describe('Form Button', function () {
        var formButton = void 0;

        beforeEach(function () {
          formButton = formComponent.childAt(numberOfFields);
        });

        it('It is a button', function () {
          expect(formButton.type()).toEqual(_semanticUiReact.Form.Button);
        });
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkR5bmFtaWNGb3JtLnNwZWMuanMiXSwibmFtZXMiOlsiY2hhbmNlIiwiQ2hhbmNlIiwibnVtYmVyT2ZGaWVsZHMiLCJNYXRoIiwiYWJzIiwiaW50ZWdlciIsInJhbmRvbVR5cGUiLCJ1c2VSb3dDb21iaW5hdGlvbiIsImZhaWxUZXN0Iiwid3JhcHBlciIsImZpZWxkIiwiY291bnQiLCJ2YWxpZGF0aW9uIiwic3RhdGUiLCJlcnJvcnMiLCJpZCIsInNldFN0YXRlIiwidXBkYXRlIiwiZXhwZWN0IiwiY2hpbGRBdCIsImZpbmQiLCJJbmxpbmVFcnJvckNvbXBvbmVudCIsInByb3BzIiwidGV4dCIsInRvRXF1YWwiLCJjcmVhdGVSYW5kb21PcHRpb25zIiwib3B0aW9ucyIsIm51bWJlck9mT3B0aW9ucyIsImNvdW50ZXIiLCJ3b3JkIiwiZ2VuZXJhdGVUZXN0Rm9ybUpzb24iLCJuYW1lIiwianNvbkZvcm0iLCJmaWVsZHMiLCJ0eXBlIiwibnVtYmVyT2ZTdWJGaWVsZHMiLCJzdWJGaWVsZHMiLCJjb3VudGluZyIsInN1YkZpZWxkVHlwZSIsInN1YkZpZWxkIiwicGxhY2Vob2xkZXIiLCJkZXNjcmlwdGlvbiIsImRlc2NyaWJlIiwic2V0UmVxdWVzdCIsImplc3QiLCJmbiIsInRlc3RKc29uIiwicm91dGUiLCJyZW5kZXJDb21wb25lbnQiLCJPYmplY3QiLCJrZXlzIiwiYmVmb3JlRWFjaCIsIml0IiwiU2VnbWVudCIsInBhZGRlZCIsInRvQmVUcnV0aHkiLCJoZWFkZXIiLCJIZWFkZXIiLCJhcyIsImRlYnVnIiwiZm9ybVNlZ21lbnQiLCJmb3JtQ29tcG9uZW50IiwiRm9ybSIsImNvbnNvbGUiLCJsb2ciLCJmb3JFYWNoIiwibGFiZWwiLCJDaGVja2JveCIsIlJhZGlvIiwiVGV4dEFyZWEiLCJEcm9wZG93biIsIkdyb3VwIiwic3ViRmllbGRDb3VudGVyIiwiaW5wdXQiLCJyb3dJbnB1dCIsIklucHV0IiwiZm9ybUJ1dHRvbiIsIkJ1dHRvbiJdLCJtYXBwaW5n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eUIsdUJBQWFmLGNBQWMxQyxPQUFkLENBQXNCakIsY0FBdEIsQ0FBYjtBQUNELFNBRkQ7O0FBSUFrRCxXQUFHLGdCQUFILEVBQXFCLFlBQU07QUFDekJsQyxpQkFBTzBELFdBQVcxQyxJQUFYLEVBQVAsRUFBMEJWLE9BQTFCLENBQWtDc0Msc0JBQUtlLE1BQXZDO0FBQ0QsU0FGRDtBQUdELE9BVkQ7QUFXRCxLQXJKRDtBQXNKRCxHQWpLRDtBQWtLRCxDQWxORCIsImZpbGUiOiJEeW5hbWljRm9ybS5zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7XG4gIEJ1dHRvbixcbiAgRm9ybSxcbiAgU2VnbWVudCxcbiAgSGVhZGVyLFxuICBSYWRpbyxcbiAgQ2hlY2tib3gsXG4gIFRleHRBcmVhLFxuICBEcm9wZG93bixcbiAgSW5wdXQsXG59IGZyb20gJ3NlbWFudGljLXVpLXJlYWN0JztcbmltcG9ydCB7IHNoYWxsb3cgfSBmcm9tICdlbnp5bWUnO1xuaW1wb3J0IHsgQ2hhbmNlIH0gZnJvbSAnY2hhbmNlJztcbmltcG9ydCBEeW5hbWljRm9ybUNvbXBvbmVudCBmcm9tICcuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9oZWxwZXJzL0R5bmFtaWNGb3JtJztcbmltcG9ydCBJbmxpbmVFcnJvckNvbXBvbmVudCBmcm9tICcuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9oZWxwZXJzL0lubGluZUVycm9yJztcblxuY29uc3QgY2hhbmNlID0gbmV3IENoYW5jZSgpO1xuXG5jb25zdCBudW1iZXJPZkZpZWxkcyA9IChNYXRoLmFicyhjaGFuY2UuaW50ZWdlcigpKSAlIDExKSArIDE7XG5cbmNvbnN0IHJhbmRvbVR5cGUgPSAodXNlUm93Q29tYmluYXRpb24pID0+IHtcbiAgc3dpdGNoIChjaGFuY2UuaW50ZWdlcigpICUgNSkge1xuICAgIGNhc2UgMDpcbiAgICAgIHJldHVybiAndGV4dEFyZWEnO1xuICAgIGNhc2UgMTpcbiAgICAgIHJldHVybiAncmFkaW8nO1xuICAgIGNhc2UgMjpcbiAgICAgIHJldHVybiAnY2hlY2tib3gnO1xuICAgIGNhc2UgMzpcbiAgICAgIHJldHVybiAnaW5wdXQnO1xuICAgIGNhc2UgNDpcbiAgICAgIGlmICh1c2VSb3dDb21iaW5hdGlvbikge1xuICAgICAgICByZXR1cm4gJ3Jvd0NvbWJpbmF0aW9uJztcbiAgICAgIH1cbiAgICAgIHJldHVybiAnaW5wdXQnO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gJ3RleHRBcmVhJztcbiAgfVxufTtcblxuY29uc3QgZmFpbFRlc3QgPSAod3JhcHBlciwgZmllbGQsIGNvdW50KSA9PiB7XG4gIGlmICgoY2hhbmNlLmludGVnZXIoKSAlIDIpICYmIGZpZWxkLnZhbGlkYXRpb24pIHtcbiAgICBjb25zdCBzdGF0ZSA9IHsgZXJyb3JzOiB7fSB9O1xuICAgIHN0YXRlLmVycm9yc1tmaWVsZC5pZF0gPSAnTm90aGluZyBpcyBTZWxlY3RlZCc7XG4gICAgd3JhcHBlci5zZXRTdGF0ZShzdGF0ZSk7XG4gICAgd3JhcHBlci51cGRhdGUoKTtcbiAgICBleHBlY3QoXG4gICAgICB3cmFwcGVyXG4gICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAuZmluZChJbmxpbmVFcnJvckNvbXBvbmVudClcbiAgICAgICAgLnByb3BzKCkudGV4dCxcbiAgICApLnRvRXF1YWwoJ05vdGhpbmcgaXMgU2VsZWN0ZWQnKTtcbiAgfVxufTtcblxuY29uc3QgY3JlYXRlUmFuZG9tT3B0aW9ucyA9ICgpID0+IHtcbiAgY29uc3Qgb3B0aW9ucyA9IFtdO1xuICBjb25zdCBudW1iZXJPZk9wdGlvbnMgPSAoY2hhbmNlLmludGVnZXIoKSAlIDExKSArIDE7XG4gIGZvciAobGV0IGNvdW50ZXIgPSAwOyBjb3VudGVyIDwgbnVtYmVyT2ZPcHRpb25zOyBjb3VudGVyICs9IDEpIHtcbiAgICBvcHRpb25zW2NvdW50ZXJdID0gY2hhbmNlLndvcmQoKTtcbiAgfVxuICByZXR1cm4gb3B0aW9ucztcbn07XG5cbmNvbnN0IGdlbmVyYXRlVGVzdEZvcm1Kc29uID0gKCkgPT4ge1xuICBjb25zdCBuYW1lID0gY2hhbmNlLndvcmQoKTtcbiAgY29uc3QganNvbkZvcm0gPSB7fTtcbiAgY29uc3QgZmllbGRzID0gW107XG4gIGZvciAobGV0IGNvdW50ZXIgPSAwOyBjb3VudGVyIDwgbnVtYmVyT2ZGaWVsZHM7IGNvdW50ZXIgKz0gMSkge1xuICAgIGNvbnN0IHR5cGUgPSByYW5kb21UeXBlKHRydWUpO1xuXG4gICAgbGV0IGZpZWxkID0ge307XG4gICAgaWYgKHR5cGUgPT09ICdyb3dDb21iaW5hdGlvbicpIHtcbiAgICAgIGNvbnN0IG51bWJlck9mU3ViRmllbGRzID0gKGNoYW5jZS5pbnRlZ2VyKCkgJSAxMSkgKyAxO1xuICAgICAgY29uc3Qgc3ViRmllbGRzID0gW107XG4gICAgICBmb3IgKGxldCBjb3VudGluZyA9IDA7IGNvdW50aW5nIDwgbnVtYmVyT2ZTdWJGaWVsZHM7IGNvdW50aW5nICs9IDEpIHtcbiAgICAgICAgY29uc3Qgc3ViRmllbGRUeXBlID0gcmFuZG9tVHlwZShmYWxzZSk7XG4gICAgICAgIGNvbnN0IHN1YkZpZWxkID0ge1xuICAgICAgICAgIG5hbWU6IGNoYW5jZS53b3JkKCksXG4gICAgICAgICAgdHlwZTogc3ViRmllbGRUeXBlLFxuICAgICAgICAgIGlkOiBjaGFuY2Uud29yZCgpLFxuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChjaGFuY2UuaW50ZWdlcigpICUgMiA9PT0gMCkge1xuICAgICAgICAgIHN1YkZpZWxkLnZhbGlkYXRpb24gPSAncmVxdWlyZWQnO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGUgPT09ICdyYWRpbycpIHtcbiAgICAgICAgICBzdWJGaWVsZC5vcHRpb25zID0gY3JlYXRlUmFuZG9tT3B0aW9ucygpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHN1YkZpZWxkVHlwZSA9PT0gJ3RleHRBcmVhJyB8fCB0eXBlID09PSAnaW5wdXQnKSB7XG4gICAgICAgICAgc3ViRmllbGQucGxhY2Vob2xkZXIgPSBjaGFuY2Uud29yZCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgc3ViRmllbGRzW2NvdW50aW5nXSA9IHN1YkZpZWxkO1xuICAgICAgfVxuXG4gICAgICBmaWVsZCA9IHtcbiAgICAgICAgbmFtZTogY2hhbmNlLndvcmQoKSxcbiAgICAgICAgdHlwZTogJ3Jvd0NvbWJpbmF0aW9uJyxcbiAgICAgICAgZmllbGRzOiBzdWJGaWVsZHMsXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBmaWVsZCA9IHtcbiAgICAgICAgbmFtZTogY2hhbmNlLndvcmQoKSxcbiAgICAgICAgdHlwZSxcbiAgICAgICAgaWQ6IGNoYW5jZS53b3JkKCksXG4gICAgICB9O1xuXG4gICAgICBpZiAoY2hhbmNlLmludGVnZXIoKSAlIDIgPT09IDApIHtcbiAgICAgICAgZmllbGQudmFsaWRhdGlvbiA9ICdyZXF1aXJlZCc7XG4gICAgICB9XG4gICAgICBpZiAodHlwZSA9PT0gJ3JhZGlvJykge1xuICAgICAgICBmaWVsZC5vcHRpb25zID0gY3JlYXRlUmFuZG9tT3B0aW9ucygpO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGUgPT09ICd0ZXh0QXJlYScgfHwgdHlwZSA9PT0gJ2lucHV0Jykge1xuICAgICAgICBmaWVsZC5wbGFjZWhvbGRlciA9IGNoYW5jZS53b3JkKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZmllbGRzW2NvdW50ZXJdID0gZmllbGQ7XG4gIH1cbiAganNvbkZvcm1bbmFtZV0gPSB7fTtcbiAganNvbkZvcm1bbmFtZV0uZGVzY3JpcHRpb24gPSBjaGFuY2Uud29yZCgpO1xuICBqc29uRm9ybVtuYW1lXS5maWVsZHMgPSBmaWVsZHM7XG4gIHJldHVybiBqc29uRm9ybTtcbn07XG5cbmRlc2NyaWJlKCdEeW5hbWljRm9ybScsICgpID0+IHtcbiAgbGV0IHdyYXBwZXI7XG4gIGNvbnN0IHNldFJlcXVlc3QgPSBqZXN0LmZuKCk7XG4gIGNvbnN0IHRlc3RKc29uID0gZ2VuZXJhdGVUZXN0Rm9ybUpzb24oKTtcbiAgY29uc3Qgcm91dGUgPSBqZXN0LmZuKCk7XG4gIGNvbnN0IHJlbmRlckNvbXBvbmVudCA9ICgpID0+XG4gICAgc2hhbGxvdyhcbiAgICAgIDxEeW5hbWljRm9ybUNvbXBvbmVudFxuICAgICAgICBqc29uRm9ybT17KCkgPT4gdGVzdEpzb259XG4gICAgICAgIHNldFJlcXVlc3Q9e3NldFJlcXVlc3R9XG4gICAgICAgIGZvcm09e09iamVjdC5rZXlzKHRlc3RKc29uKVswXX1cbiAgICAgICAgcm91dGU9eygpID0+IHtcbiAgICAgICAgICByb3V0ZSgpO1xuICAgICAgICB9fVxuICAgICAgLz4sXG4gICAgKTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICB3cmFwcGVyID0gcmVuZGVyQ29tcG9uZW50KCk7XG4gIH0pO1xuXG4gIGl0KCdpcyB3cmFwcGVkIGluIGEgU2VnbWVudCcsICgpID0+IHtcbiAgICBleHBlY3Qod3JhcHBlci50eXBlKCkpLnRvRXF1YWwoU2VnbWVudCk7XG4gIH0pO1xuXG4gIGl0KCdpcyBzdHlsZWQgYXMgYSBwYWRkZWQgU2VnbWVudCcsICgpID0+IHtcbiAgICBleHBlY3Qod3JhcHBlci5wcm9wcygpLnBhZGRlZCkudG9CZVRydXRoeSgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnaGVhZGVyJywgKCkgPT4ge1xuICAgIGxldCBoZWFkZXI7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGhlYWRlciA9IHdyYXBwZXIuY2hpbGRBdCgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdpcyBhIGhlYWRlcicsICgpID0+IHtcbiAgICAgIGV4cGVjdChoZWFkZXIudHlwZSgpKS50b0VxdWFsKEhlYWRlcik7XG4gICAgfSk7XG5cbiAgICBpdCgnaXMgaGFzIGFuIGFzIGVxdWFsIHRvIGgzJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGhlYWRlci5wcm9wcygpLmFzKS50b0VxdWFsKCdoMycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2lzIHRoZSBjb3JyZWN0IHRleHQgaW4gdGhlIGhlYWRlcicsICgpID0+IHtcbiAgICAgIGV4cGVjdChoZWFkZXIuY2hpbGRBdCgwKS5kZWJ1ZygpKS50b0VxdWFsKHRlc3RKc29uW09iamVjdC5rZXlzKHRlc3RKc29uKVswXV0uZGVzY3JpcHRpb24pO1xuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoJ2Zvcm0gc2VnbWVudCcsICgpID0+IHtcbiAgICBsZXQgZm9ybVNlZ21lbnQ7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGZvcm1TZWdtZW50ID0gd3JhcHBlci5jaGlsZEF0KDEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2lzIGEgc2VnbWVudCcsICgpID0+IHtcbiAgICAgIGV4cGVjdChmb3JtU2VnbWVudC50eXBlKCkpLnRvRXF1YWwoU2VnbWVudCk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnZm9ybScsICgpID0+IHtcbiAgICAgIGxldCBmb3JtQ29tcG9uZW50O1xuICAgICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgIGZvcm1Db21wb25lbnQgPSBmb3JtU2VnbWVudC5jaGlsZEF0KDApO1xuICAgICAgfSk7XG4gICAgICBpdCgnaXMgYSBmb3JtJywgKCkgPT4ge1xuICAgICAgICBleHBlY3QoZm9ybUNvbXBvbmVudC50eXBlKCkpLnRvRXF1YWwoRm9ybSk7XG4gICAgICB9KTtcblxuICAgICAgZGVzY3JpYmUoJ2Zvcm0gZGF0YScsICgpID0+IHtcbiAgICAgICAgd3JhcHBlciA9IHJlbmRlckNvbXBvbmVudCgpO1xuICAgICAgICBmb3JtU2VnbWVudCA9IHdyYXBwZXIuY2hpbGRBdCgxKTtcbiAgICAgICAgZm9ybUNvbXBvbmVudCA9IGZvcm1TZWdtZW50LmNoaWxkQXQoMCk7XG4gICAgICAgIGNvbnNvbGUubG9nKGZvcm1Db21wb25lbnQuZGVidWcoKSk7XG4gICAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICAgIHRlc3RKc29uW09iamVjdC5rZXlzKHRlc3RKc29uKVswXV0uZmllbGRzLmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coZmllbGQpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGNvdW50KTtcbiAgICAgICAgICBpdChgZmllbGQgJHtjb3VudH0gaXMgY29ycmVjdGAsICgpID0+IHtcbiAgICAgICAgICAgIGNvdW50ICs9IDE7XG4gICAgICAgICAgICBjb25zdCBsYWJlbCA9IGZvcm1Db21wb25lbnQuY2hpbGRBdChjb3VudCkuY2hpbGRBdCgwKTtcbiAgICAgICAgICAgIGlmIChmaWVsZC52YWxpZGF0aW9uKSB7XG4gICAgICAgICAgICAgIGV4cGVjdChsYWJlbC50ZXh0KCkpLnRvRXF1YWwoYCAqICR7ZmllbGQubmFtZX1gKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGV4cGVjdChsYWJlbC50ZXh0KCkpLnRvRXF1YWwoZmllbGQubmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBleHBlY3QoXG4gICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAucHJvcHMoKS5uYW1lID09PSBmaWVsZC5uYW1lLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAnY2hlY2tib3gnKSB7XG4gICAgICAgICAgICAgIGV4cGVjdChcbiAgICAgICAgICAgICAgICB3cmFwcGVyXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgIC50eXBlKCksXG4gICAgICAgICAgICAgICkudG9FcXVhbChDaGVja2JveCk7XG4gICAgICAgICAgICAgIGZhaWxUZXN0KHdyYXBwZXIsIGZpZWxkLCBjb3VudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZmllbGQudHlwZSA9PT0gJ3JhZGlvJykge1xuICAgICAgICAgICAgICBleHBlY3QoXG4gICAgICAgICAgICAgICAgd3JhcHBlclxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdChjb3VudClcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAudHlwZSgpLFxuICAgICAgICAgICAgICApLnRvRXF1YWwoUmFkaW8pO1xuICAgICAgICAgICAgICBmYWlsVGVzdCh3cmFwcGVyLCBmaWVsZCwgY291bnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICd0ZXh0QXJlYScpIHtcbiAgICAgICAgICAgICAgZXhwZWN0KFxuICAgICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLnR5cGUoKSxcbiAgICAgICAgICAgICAgKS50b0VxdWFsKFRleHRBcmVhKTtcbiAgICAgICAgICAgICAgZmFpbFRlc3Qod3JhcHBlciwgZmllbGQsIGNvdW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAnZHJvcERvd24nKSB7XG4gICAgICAgICAgICAgIGV4cGVjdChcbiAgICAgICAgICAgICAgICB3cmFwcGVyXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgIC50eXBlKCksXG4gICAgICAgICAgICAgICkudG9FcXVhbChEcm9wZG93bik7XG4gICAgICAgICAgICAgIGZhaWxUZXN0KHdyYXBwZXIsIGZpZWxkLCBjb3VudCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAncm93Q29tYmluYXRpb24nKSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KFxuICAgICAgICAgICAgICAgICAgd3JhcHBlclxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdChjb3VudClcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLnR5cGUoKSxcbiAgICAgICAgICAgICAgICApLnRvRXF1YWwoRm9ybS5Hcm91cCk7XG5cbiAgICAgICAgICAgICAgICBsZXQgc3ViRmllbGRDb3VudGVyID0gMDtcbiAgICAgICAgICAgICAgICBmaWVsZC5maWVsZHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHJvd0lucHV0ID0gd3JhcHBlclxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdChjb3VudClcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoc3ViRmllbGRDb3VudGVyKTtcblxuICAgICAgICAgICAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2lucHV0JzpcbiAgICAgICAgICAgICAgICAgICAgICBleHBlY3Qocm93SW5wdXQudHlwZSgpKS50b0VxdWFsKElucHV0KTtcbiAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZHJvcERvd24nOlxuICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdChyb3dJbnB1dC50eXBlKCkpLnRvRXF1YWwoRHJvcGRvd24pO1xuICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICd0ZXh0QXJlYSc6XG4gICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KHJvd0lucHV0LnR5cGUoKSkudG9FcXVhbChUZXh0QXJlYSk7XG4gICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NoZWNrYm94JzpcbiAgICAgICAgICAgICAgICAgICAgICBleHBlY3Qocm93SW5wdXQudHlwZSgpKS50b0VxdWFsKENoZWNrYm94KTtcbiAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAncmFkaW8nOlxuICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdChyb3dJbnB1dC50eXBlKCkpLnRvRXF1YWwoQ2hlY2tib3gpO1xuICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZmFpbFRlc3Qod3JhcHBlciwgZmllbGQsIGNvdW50KTtcbiAgICAgICAgICAgICAgICAgIHN1YkZpZWxkQ291bnRlciArPSAxO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAnaW5wdXQnKSB7XG4gICAgICAgICAgICAgIGV4cGVjdChcbiAgICAgICAgICAgICAgICB3cmFwcGVyXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgIC50eXBlKCksXG4gICAgICAgICAgICAgICkudG9FcXVhbChJbnB1dCk7XG5cbiAgICAgICAgICAgICAgZmFpbFRlc3Qod3JhcHBlciwgZmllbGQsIGNvdW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb3VudCArPSAxO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBkZXNjcmliZSgnRm9ybSBCdXR0b24nLCAoKSA9PiB7XG4gICAgICAgIGxldCBmb3JtQnV0dG9uO1xuXG4gICAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICAgIGZvcm1CdXR0b24gPSBmb3JtQ29tcG9uZW50LmNoaWxkQXQobnVtYmVyT2ZGaWVsZHMpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnSXQgaXMgYSBidXR0b24nLCAoKSA9PiB7XG4gICAgICAgICAgZXhwZWN0KGZvcm1CdXR0b24udHlwZSgpKS50b0VxdWFsKEZvcm0uQnV0dG9uKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==