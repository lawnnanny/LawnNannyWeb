3b01d1d350e37984a7d43069e40240c5
'use strict';

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _semanticUiReact = require('semantic-ui-react');

var _enzyme = require('enzyme');

var _chance = require('chance');

var _DynamicForm = require('../../../src/components/helpers/DynamicForm');

var _DynamicForm2 = _interopRequireDefault(_DynamicForm);

var _InlineError = require('../../../src/components/helpers/InlineError');

var _InlineError2 = _interopRequireDefault(_InlineError);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var chance = new _chance.Chance();

var numberOfFields = Math.abs(chance.integer()) % 11 + 1;

var randomType = function randomType(useRowCombination) {
  switch (chance.integer() % 5) {
    case 0:
      return 'textArea';
    case 1:
      return 'radio';
    case 2:
      return 'checkbox';
    case 3:
      return 'input';
    case 4:
      if (useRowCombination) {
        return 'rowCombination';
      }
      return 'input';
    default:
      return 'textArea';
  }
};

var failTest = function failTest(wrapper, field, count) {
  if (chance.integer() % 2) {
    var state = { errors: {} };
    state.errors[field.id] = 'Nothing is Selected';
    wrapper.setState(state);
    wrapper.update();
    expect(wrapper.childAt(1).childAt(0).childAt(count).find(_InlineError2.default).props().text).toEqual('Nothing is Selected');
  }
};

var createRandomOptions = function createRandomOptions() {
  var options = [];
  var numberOfOptions = chance.integer() % 11 + 1;
  for (var counter = 0; counter < numberOfOptions; counter += 1) {
    options[counter] = chance.word();
  }
  return options;
};

var generateTestFormJson = function generateTestFormJson() {
  var name = chance.word();
  var jsonForm = {};
  var fields = [];
  for (var counter = 0; counter < numberOfFields; counter += 1) {
    var type = randomType(true);

    var field = {};
    if (type === 'rowCombination') {
      var numberOfSubFields = chance.integer() % 11 + 1;
      var subFields = [];
      for (var count = 0; count < numberOfSubFields; count += 1) {
        var subFieldType = randomType(false);
        var subField = {
          name: chance.word(),
          type: subFieldType,
          id: chance.word()
        };

        if (chance.integer() % 2 === 0) {
          subField.validation = 'required';
        }

        if (type === 'radio') {
          subField.options = createRandomOptions();
        }

        if (subFieldType === 'textArea' || type === 'input') {
          subField.placeholder = chance.word();
        }

        subFields[count] = subField;
      }

      field = {
        name: chance.word(),
        type: 'rowCombination',
        fields: subFields
      };
    } else {
      field = {
        name: chance.word(),
        type: type,
        id: chance.word()
      };

      if (chance.integer() % 2 === 0) {
        field.validation = 'required';
      }
      if (type === 'radio') {
        field.options = createRandomOptions();
      }
      if (type === 'textArea' || type === 'input') {
        field.placeholder = chance.word();
      }
    }

    fields[counter] = field;
  }
  jsonForm[name] = {};
  jsonForm[name].description = chance.word();
  jsonForm[name].fields = fields;
  return jsonForm;
};

describe('DynamicForm', function () {
  var wrapper = void 0;
  var setRequest = jest.fn();
  var testJson = generateTestFormJson();
  var _route = jest.fn();
  var renderComponent = function renderComponent() {
    return (0, _enzyme.shallow)(_react2.default.createElement(_DynamicForm2.default, {
      jsonForm: function jsonForm() {
        return testJson;
      },
      setRequest: setRequest,
      form: Object.keys(testJson)[0],
      route: function route() {
        _route();
      }
    }));
  };

  beforeEach(function () {
    wrapper = renderComponent();
  });

  it('is wrapped in a Segment', function () {
    expect(wrapper.type()).toEqual(_semanticUiReact.Segment);
  });

  it('is styled as a padded Segment', function () {
    expect(wrapper.props().padded).toBeTruthy();
  });

  describe('header', function () {
    var header = void 0;

    beforeEach(function () {
      header = wrapper.childAt(0);
    });

    it('is a header', function () {
      expect(header.type()).toEqual(_semanticUiReact.Header);
    });

    it('is has an as equal to h3', function () {
      expect(header.props().as).toEqual('h3');
    });

    it('is the correct text in the header', function () {
      expect(header.childAt(0).debug()).toEqual(testJson[Object.keys(testJson)[0]].description);
    });
  });
  describe('form segment', function () {
    var formSegment = void 0;

    beforeEach(function () {
      formSegment = wrapper.childAt(1);
    });

    it('is a segment', function () {
      expect(formSegment.type()).toEqual(_semanticUiReact.Segment);
    });

    describe('form', function () {
      var formComponent = void 0;
      beforeEach(function () {
        formComponent = formSegment.childAt(0);
      });
      it('is a form', function () {
        expect(formComponent.type()).toEqual(_semanticUiReact.Form);
      });

      describe('form data', function () {
        wrapper = renderComponent();
        formSegment = wrapper.childAt(1);
        formComponent = formSegment.childAt(0);
        console.log(formComponent.debug());
        var count = 0;
        testJson[Object.keys(testJson)[0]].fields.forEach(function (field) {
          if (field.validation) {
            it('field ' + count + ' is correct', function () {
              var label = formComponent.childAt(count).childAt(0);
              console.log(formComponent.childAt(0).debug());
              console.log(count);
              console.log(label.debug());
              if (field.validation) {
                expect(label.text()).toEqual(' * ' + field.name);
              } else {
                expect(label.text()).toEqual(field.name);
              }
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).props().name === field.name);
              if (field.type === 'checkbox') {
                expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Checkbox);
              }
              if (field.type === 'radio') {
                expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Radio);
                failTest(wrapper, field, count);
              }
              if (field.type === 'textArea') {
                expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.TextArea);
                failTest(wrapper, field, count);
              }
              if (field.type === 'dropDown') {
                expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Dropdown);
                failTest(wrapper, field, count);
              }

              if (field.type === 'rowCombination') {
                expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Form.Group);

                var subFieldCounter = 0;
                field.fields.forEach(function (input) {
                  var rowInput = wrapper.childAt(1).childAt(0).childAt(count).childAt(1).childAt(subFieldCounter);

                  switch (input.type) {
                    case 'input':
                      expect(rowInput.type()).toEqual(_semanticUiReact.Input);
                      break;
                    case 'dropDown':
                      expect(rowInput.type()).toEqual(_semanticUiReact.Dropdown);
                      break;
                    case 'textArea':
                      expect(rowInput.type()).toEqual(_semanticUiReact.TextArea);
                      break;
                    case 'checkbox':
                      expect(rowInput.type()).toEqual(_semanticUiReact.Checkbox);
                      break;
                    case 'radio':
                      expect(rowInput.type()).toEqual(_semanticUiReact.Checkbox);
                      break;
                    default:
                  }
                  failTest(wrapper, field, count);
                  subFieldCounter += 1;
                });
              }

              if (field.type === 'input') {
                expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Input);

                failTest(wrapper, field, count);
              }
            });
          }
          count += 1;
        });
      });

      describe('Form Button', function () {
        var formButton = void 0;

        beforeEach(function () {
          formButton = formComponent.childAt(numberOfFields);
        });

        it('It is a button', function () {
          expect(formButton.type()).toEqual(_semanticUiReact.Form.Button);
        });
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkR5bmFtaWNGb3JtLnNwZWMuanMiXSwibmFtZXMiOlsiY2hhbmNlIiwiQ2hhbmNlIiwibnVtYmVyT2ZGaWVsZHMiLCJNYXRoIiwiYWJzIiwiaW50ZWdlciIsInJhbmRvbVR5cGUiLCJ1c2VSb3dDb21iaW5hdGlvbiIsImZhaWxUZXN0Iiwid3JhcHBlciIsImZpZWxkIiwiY291bnQiLCJzdGF0ZSIsImVycm9ycyIsImlkIiwic2V0U3RhdGUiLCJ1cGRhdGUiLCJleHBlY3QiLCJjaGlsZEF0IiwiZmluZCIsIklubGluZUVycm9yQ29tcG9uZW50IiwicHJvcHMiLCJ0ZXh0IiwidG9FcXVhbCIsImNyZWF0ZVJhbmRvbU9wdGlvbnMiLCJvcHRpb25zIiwibnVtYmVyT2ZPcHRpb25zIiwiY291bnRlciIsIndvcmQiLCJnZW5lcmF0ZVRlc3RGb3JtSnNvbiIsIm5hbWUiLCJqc29uRm9ybSIsImZpZWxkcyIsInR5cGUiLCJudW1iZXJPZlN1YkZpZWxkcyIsInN1YkZpZWxkcyIsInN1YkZpZWxkVHlwZSIsInN1YkZpZWxkIiwidmFsaWRhdGlvbiIsInBsYWNlaG9sZGVyIiwiZGVzY3JpcHRpb24iLCJkZXNjcmliZSIsInNldFJlcXVlc3QiLCJqZXN0IiwiZm4iLCJ0ZXN0SnNvbiIsInJvdXRlIiwicmVuZGVyQ29tcG9uZW50IiwiT2JqZWN0Iiwia2V5cyIsImJlZm9yZUVhY2giLCJpdCIsIlNlZ21lbnQiLCJwYWRkZWQiLCJ0b0JlVHJ1dGh5IiwiaGVhZGVyIiwiSGVhZGVyIiwiYXMiLCJkZWJ1ZyIsImZvcm1TZWdtZW50IiwiZm9ybUNvbXBvbmVudCIsIkZvcm0iLCJjb25zb2xlIiwibG9nIiwiZm9yRWFjaCIsImxhYmVsIiwiQ2hlY2tib3giLCJSYWRpbyIsIlRleHRBcmVhIiwiRHJvcGRvd24iLCJHcm91cCIsInN1YkZpZWxkQ291bnRlciIsImlucHV0Iiwicm93SW5wdXQiLCJJbnB1dCIsImZvcm1CdXR0b24iLCJCdXR0b24iXSwibWFwcGluZ3MiOiI7O0FBQUE7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QUFKOztBQUVBekIsbUJBQVcsWUFBTTtBQUNmeUIsdUJBQWFmLGNBQWMxQyxPQUFkLENBQXNCaEIsY0FBdEIsQ0FBYjtBQUNELFNBRkQ7O0FBSUFpRCxXQUFHLGdCQUFILEVBQXFCLFlBQU07QUFDekJsQyxpQkFBTzBELFdBQVcxQyxJQUFYLEVBQVAsRUFBMEJWLE9BQTFCLENBQWtDc0Msc0JBQUtlLE1BQXZDO0FBQ0QsU0FGRDtBQUdELE9BVkQ7QUFXRCxLQXRKRDtBQXVKRCxHQWxLRDtBQW1LRCxDQW5ORCIsImZpbGUiOiJEeW5hbWljRm9ybS5zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7XG4gIEJ1dHRvbixcbiAgRm9ybSxcbiAgU2VnbWVudCxcbiAgSGVhZGVyLFxuICBSYWRpbyxcbiAgQ2hlY2tib3gsXG4gIFRleHRBcmVhLFxuICBEcm9wZG93bixcbiAgSW5wdXQsXG59IGZyb20gJ3NlbWFudGljLXVpLXJlYWN0JztcbmltcG9ydCB7IHNoYWxsb3cgfSBmcm9tICdlbnp5bWUnO1xuaW1wb3J0IHsgQ2hhbmNlIH0gZnJvbSAnY2hhbmNlJztcbmltcG9ydCBEeW5hbWljRm9ybUNvbXBvbmVudCBmcm9tICcuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9oZWxwZXJzL0R5bmFtaWNGb3JtJztcbmltcG9ydCBJbmxpbmVFcnJvckNvbXBvbmVudCBmcm9tICcuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9oZWxwZXJzL0lubGluZUVycm9yJztcblxuY29uc3QgY2hhbmNlID0gbmV3IENoYW5jZSgpO1xuXG5jb25zdCBudW1iZXJPZkZpZWxkcyA9IChNYXRoLmFicyhjaGFuY2UuaW50ZWdlcigpKSAlIDExKSArIDE7XG5cbmNvbnN0IHJhbmRvbVR5cGUgPSAodXNlUm93Q29tYmluYXRpb24pID0+IHtcbiAgc3dpdGNoIChjaGFuY2UuaW50ZWdlcigpICUgNSkge1xuICAgIGNhc2UgMDpcbiAgICAgIHJldHVybiAndGV4dEFyZWEnO1xuICAgIGNhc2UgMTpcbiAgICAgIHJldHVybiAncmFkaW8nO1xuICAgIGNhc2UgMjpcbiAgICAgIHJldHVybiAnY2hlY2tib3gnO1xuICAgIGNhc2UgMzpcbiAgICAgIHJldHVybiAnaW5wdXQnO1xuICAgIGNhc2UgNDpcbiAgICAgIGlmICh1c2VSb3dDb21iaW5hdGlvbikge1xuICAgICAgICByZXR1cm4gJ3Jvd0NvbWJpbmF0aW9uJztcbiAgICAgIH1cbiAgICAgIHJldHVybiAnaW5wdXQnO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gJ3RleHRBcmVhJztcbiAgfVxufTtcblxuY29uc3QgZmFpbFRlc3QgPSAod3JhcHBlciwgZmllbGQsIGNvdW50KSA9PiB7XG4gIGlmIChjaGFuY2UuaW50ZWdlcigpICUgMikge1xuICAgIGNvbnN0IHN0YXRlID0geyBlcnJvcnM6IHt9IH07XG4gICAgc3RhdGUuZXJyb3JzW2ZpZWxkLmlkXSA9ICdOb3RoaW5nIGlzIFNlbGVjdGVkJztcbiAgICB3cmFwcGVyLnNldFN0YXRlKHN0YXRlKTtcbiAgICB3cmFwcGVyLnVwZGF0ZSgpO1xuICAgIGV4cGVjdChcbiAgICAgIHdyYXBwZXJcbiAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgIC5maW5kKElubGluZUVycm9yQ29tcG9uZW50KVxuICAgICAgICAucHJvcHMoKS50ZXh0LFxuICAgICkudG9FcXVhbCgnTm90aGluZyBpcyBTZWxlY3RlZCcpO1xuICB9XG59O1xuXG5jb25zdCBjcmVhdGVSYW5kb21PcHRpb25zID0gKCkgPT4ge1xuICBjb25zdCBvcHRpb25zID0gW107XG4gIGNvbnN0IG51bWJlck9mT3B0aW9ucyA9IChjaGFuY2UuaW50ZWdlcigpICUgMTEpICsgMTtcbiAgZm9yIChsZXQgY291bnRlciA9IDA7IGNvdW50ZXIgPCBudW1iZXJPZk9wdGlvbnM7IGNvdW50ZXIgKz0gMSkge1xuICAgIG9wdGlvbnNbY291bnRlcl0gPSBjaGFuY2Uud29yZCgpO1xuICB9XG4gIHJldHVybiBvcHRpb25zO1xufTtcblxuY29uc3QgZ2VuZXJhdGVUZXN0Rm9ybUpzb24gPSAoKSA9PiB7XG4gIGNvbnN0IG5hbWUgPSBjaGFuY2Uud29yZCgpO1xuICBjb25zdCBqc29uRm9ybSA9IHt9O1xuICBjb25zdCBmaWVsZHMgPSBbXTtcbiAgZm9yIChsZXQgY291bnRlciA9IDA7IGNvdW50ZXIgPCBudW1iZXJPZkZpZWxkczsgY291bnRlciArPSAxKSB7XG4gICAgY29uc3QgdHlwZSA9IHJhbmRvbVR5cGUodHJ1ZSk7XG5cbiAgICBsZXQgZmllbGQgPSB7fTtcbiAgICBpZiAodHlwZSA9PT0gJ3Jvd0NvbWJpbmF0aW9uJykge1xuICAgICAgY29uc3QgbnVtYmVyT2ZTdWJGaWVsZHMgPSAoY2hhbmNlLmludGVnZXIoKSAlIDExKSArIDE7XG4gICAgICBjb25zdCBzdWJGaWVsZHMgPSBbXTtcbiAgICAgIGZvciAobGV0IGNvdW50ID0gMDsgY291bnQgPCBudW1iZXJPZlN1YkZpZWxkczsgY291bnQgKz0gMSkge1xuICAgICAgICBjb25zdCBzdWJGaWVsZFR5cGUgPSByYW5kb21UeXBlKGZhbHNlKTtcbiAgICAgICAgY29uc3Qgc3ViRmllbGQgPSB7XG4gICAgICAgICAgbmFtZTogY2hhbmNlLndvcmQoKSxcbiAgICAgICAgICB0eXBlOiBzdWJGaWVsZFR5cGUsXG4gICAgICAgICAgaWQ6IGNoYW5jZS53b3JkKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKGNoYW5jZS5pbnRlZ2VyKCkgJSAyID09PSAwKSB7XG4gICAgICAgICAgc3ViRmllbGQudmFsaWRhdGlvbiA9ICdyZXF1aXJlZCc7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZSA9PT0gJ3JhZGlvJykge1xuICAgICAgICAgIHN1YkZpZWxkLm9wdGlvbnMgPSBjcmVhdGVSYW5kb21PcHRpb25zKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoc3ViRmllbGRUeXBlID09PSAndGV4dEFyZWEnIHx8IHR5cGUgPT09ICdpbnB1dCcpIHtcbiAgICAgICAgICBzdWJGaWVsZC5wbGFjZWhvbGRlciA9IGNoYW5jZS53b3JkKCk7XG4gICAgICAgIH1cblxuICAgICAgICBzdWJGaWVsZHNbY291bnRdID0gc3ViRmllbGQ7XG4gICAgICB9XG5cbiAgICAgIGZpZWxkID0ge1xuICAgICAgICBuYW1lOiBjaGFuY2Uud29yZCgpLFxuICAgICAgICB0eXBlOiAncm93Q29tYmluYXRpb24nLFxuICAgICAgICBmaWVsZHM6IHN1YkZpZWxkcyxcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGZpZWxkID0ge1xuICAgICAgICBuYW1lOiBjaGFuY2Uud29yZCgpLFxuICAgICAgICB0eXBlLFxuICAgICAgICBpZDogY2hhbmNlLndvcmQoKSxcbiAgICAgIH07XG5cbiAgICAgIGlmIChjaGFuY2UuaW50ZWdlcigpICUgMiA9PT0gMCkge1xuICAgICAgICBmaWVsZC52YWxpZGF0aW9uID0gJ3JlcXVpcmVkJztcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlID09PSAncmFkaW8nKSB7XG4gICAgICAgIGZpZWxkLm9wdGlvbnMgPSBjcmVhdGVSYW5kb21PcHRpb25zKCk7XG4gICAgICB9XG4gICAgICBpZiAodHlwZSA9PT0gJ3RleHRBcmVhJyB8fCB0eXBlID09PSAnaW5wdXQnKSB7XG4gICAgICAgIGZpZWxkLnBsYWNlaG9sZGVyID0gY2hhbmNlLndvcmQoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmaWVsZHNbY291bnRlcl0gPSBmaWVsZDtcbiAgfVxuICBqc29uRm9ybVtuYW1lXSA9IHt9O1xuICBqc29uRm9ybVtuYW1lXS5kZXNjcmlwdGlvbiA9IGNoYW5jZS53b3JkKCk7XG4gIGpzb25Gb3JtW25hbWVdLmZpZWxkcyA9IGZpZWxkcztcbiAgcmV0dXJuIGpzb25Gb3JtO1xufTtcblxuZGVzY3JpYmUoJ0R5bmFtaWNGb3JtJywgKCkgPT4ge1xuICBsZXQgd3JhcHBlcjtcbiAgY29uc3Qgc2V0UmVxdWVzdCA9IGplc3QuZm4oKTtcbiAgY29uc3QgdGVzdEpzb24gPSBnZW5lcmF0ZVRlc3RGb3JtSnNvbigpO1xuICBjb25zdCByb3V0ZSA9IGplc3QuZm4oKTtcbiAgY29uc3QgcmVuZGVyQ29tcG9uZW50ID0gKCkgPT5cbiAgICBzaGFsbG93KFxuICAgICAgPER5bmFtaWNGb3JtQ29tcG9uZW50XG4gICAgICAgIGpzb25Gb3JtPXsoKSA9PiB0ZXN0SnNvbn1cbiAgICAgICAgc2V0UmVxdWVzdD17c2V0UmVxdWVzdH1cbiAgICAgICAgZm9ybT17T2JqZWN0LmtleXModGVzdEpzb24pWzBdfVxuICAgICAgICByb3V0ZT17KCkgPT4ge1xuICAgICAgICAgIHJvdXRlKCk7XG4gICAgICAgIH19XG4gICAgICAvPixcbiAgICApO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHdyYXBwZXIgPSByZW5kZXJDb21wb25lbnQoKTtcbiAgfSk7XG5cbiAgaXQoJ2lzIHdyYXBwZWQgaW4gYSBTZWdtZW50JywgKCkgPT4ge1xuICAgIGV4cGVjdCh3cmFwcGVyLnR5cGUoKSkudG9FcXVhbChTZWdtZW50KTtcbiAgfSk7XG5cbiAgaXQoJ2lzIHN0eWxlZCBhcyBhIHBhZGRlZCBTZWdtZW50JywgKCkgPT4ge1xuICAgIGV4cGVjdCh3cmFwcGVyLnByb3BzKCkucGFkZGVkKS50b0JlVHJ1dGh5KCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdoZWFkZXInLCAoKSA9PiB7XG4gICAgbGV0IGhlYWRlcjtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgaGVhZGVyID0gd3JhcHBlci5jaGlsZEF0KDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2lzIGEgaGVhZGVyJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGhlYWRlci50eXBlKCkpLnRvRXF1YWwoSGVhZGVyKTtcbiAgICB9KTtcblxuICAgIGl0KCdpcyBoYXMgYW4gYXMgZXF1YWwgdG8gaDMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoaGVhZGVyLnByb3BzKCkuYXMpLnRvRXF1YWwoJ2gzJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnaXMgdGhlIGNvcnJlY3QgdGV4dCBpbiB0aGUgaGVhZGVyJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGhlYWRlci5jaGlsZEF0KDApLmRlYnVnKCkpLnRvRXF1YWwodGVzdEpzb25bT2JqZWN0LmtleXModGVzdEpzb24pWzBdXS5kZXNjcmlwdGlvbik7XG4gICAgfSk7XG4gIH0pO1xuICBkZXNjcmliZSgnZm9ybSBzZWdtZW50JywgKCkgPT4ge1xuICAgIGxldCBmb3JtU2VnbWVudDtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgZm9ybVNlZ21lbnQgPSB3cmFwcGVyLmNoaWxkQXQoMSk7XG4gICAgfSk7XG5cbiAgICBpdCgnaXMgYSBzZWdtZW50JywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGZvcm1TZWdtZW50LnR5cGUoKSkudG9FcXVhbChTZWdtZW50KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdmb3JtJywgKCkgPT4ge1xuICAgICAgbGV0IGZvcm1Db21wb25lbnQ7XG4gICAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgZm9ybUNvbXBvbmVudCA9IGZvcm1TZWdtZW50LmNoaWxkQXQoMCk7XG4gICAgICB9KTtcbiAgICAgIGl0KCdpcyBhIGZvcm0nLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdChmb3JtQ29tcG9uZW50LnR5cGUoKSkudG9FcXVhbChGb3JtKTtcbiAgICAgIH0pO1xuXG4gICAgICBkZXNjcmliZSgnZm9ybSBkYXRhJywgKCkgPT4ge1xuICAgICAgICB3cmFwcGVyID0gcmVuZGVyQ29tcG9uZW50KCk7XG4gICAgICAgIGZvcm1TZWdtZW50ID0gd3JhcHBlci5jaGlsZEF0KDEpO1xuICAgICAgICBmb3JtQ29tcG9uZW50ID0gZm9ybVNlZ21lbnQuY2hpbGRBdCgwKTtcbiAgICAgICAgY29uc29sZS5sb2coZm9ybUNvbXBvbmVudC5kZWJ1ZygpKTtcbiAgICAgICAgbGV0IGNvdW50ID0gMDtcbiAgICAgICAgdGVzdEpzb25bT2JqZWN0LmtleXModGVzdEpzb24pWzBdXS5maWVsZHMuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgICAgICBpZiAoZmllbGQudmFsaWRhdGlvbikge1xuICAgICAgICAgICAgaXQoYGZpZWxkICR7Y291bnR9IGlzIGNvcnJlY3RgLCAoKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gZm9ybUNvbXBvbmVudC5jaGlsZEF0KGNvdW50KS5jaGlsZEF0KDApO1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhmb3JtQ29tcG9uZW50LmNoaWxkQXQoMCkuZGVidWcoKSk7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKGNvdW50KTtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2cobGFiZWwuZGVidWcoKSk7XG4gICAgICAgICAgICAgIGlmIChmaWVsZC52YWxpZGF0aW9uKSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGxhYmVsLnRleHQoKSkudG9FcXVhbChgICogJHtmaWVsZC5uYW1lfWApO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGV4cGVjdChsYWJlbC50ZXh0KCkpLnRvRXF1YWwoZmllbGQubmFtZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZXhwZWN0KFxuICAgICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLnByb3BzKCkubmFtZSA9PT0gZmllbGQubmFtZSxcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICdjaGVja2JveCcpIHtcbiAgICAgICAgICAgICAgICBleHBlY3QoXG4gICAgICAgICAgICAgICAgICB3cmFwcGVyXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgICAudHlwZSgpLFxuICAgICAgICAgICAgICAgICkudG9FcXVhbChDaGVja2JveCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICdyYWRpbycpIHtcbiAgICAgICAgICAgICAgICBleHBlY3QoXG4gICAgICAgICAgICAgICAgICB3cmFwcGVyXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgICAudHlwZSgpLFxuICAgICAgICAgICAgICAgICkudG9FcXVhbChSYWRpbyk7XG4gICAgICAgICAgICAgICAgZmFpbFRlc3Qod3JhcHBlciwgZmllbGQsIGNvdW50KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAoZmllbGQudHlwZSA9PT0gJ3RleHRBcmVhJykge1xuICAgICAgICAgICAgICAgIGV4cGVjdChcbiAgICAgICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAgIC50eXBlKCksXG4gICAgICAgICAgICAgICAgKS50b0VxdWFsKFRleHRBcmVhKTtcbiAgICAgICAgICAgICAgICBmYWlsVGVzdCh3cmFwcGVyLCBmaWVsZCwgY291bnQpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAnZHJvcERvd24nKSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KFxuICAgICAgICAgICAgICAgICAgd3JhcHBlclxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdChjb3VudClcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLnR5cGUoKSxcbiAgICAgICAgICAgICAgICApLnRvRXF1YWwoRHJvcGRvd24pO1xuICAgICAgICAgICAgICAgIGZhaWxUZXN0KHdyYXBwZXIsIGZpZWxkLCBjb3VudCk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBpZiAoZmllbGQudHlwZSA9PT0gJ3Jvd0NvbWJpbmF0aW9uJykge1xuICAgICAgICAgICAgICAgIGV4cGVjdChcbiAgICAgICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAgIC50eXBlKCksXG4gICAgICAgICAgICAgICAgKS50b0VxdWFsKEZvcm0uR3JvdXApO1xuXG4gICAgICAgICAgICAgICAgbGV0IHN1YkZpZWxkQ291bnRlciA9IDA7XG4gICAgICAgICAgICAgICAgZmllbGQuZmllbGRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICAgICAgICAgICAgICBjb25zdCByb3dJbnB1dCA9IHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KHN1YkZpZWxkQ291bnRlcik7XG5cbiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdpbnB1dCc6XG4gICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KHJvd0lucHV0LnR5cGUoKSkudG9FcXVhbChJbnB1dCk7XG4gICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Ryb3BEb3duJzpcbiAgICAgICAgICAgICAgICAgICAgICBleHBlY3Qocm93SW5wdXQudHlwZSgpKS50b0VxdWFsKERyb3Bkb3duKTtcbiAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAndGV4dEFyZWEnOlxuICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdChyb3dJbnB1dC50eXBlKCkpLnRvRXF1YWwoVGV4dEFyZWEpO1xuICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdjaGVja2JveCc6XG4gICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KHJvd0lucHV0LnR5cGUoKSkudG9FcXVhbChDaGVja2JveCk7XG4gICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3JhZGlvJzpcbiAgICAgICAgICAgICAgICAgICAgICBleHBlY3Qocm93SW5wdXQudHlwZSgpKS50b0VxdWFsKENoZWNrYm94KTtcbiAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGZhaWxUZXN0KHdyYXBwZXIsIGZpZWxkLCBjb3VudCk7XG4gICAgICAgICAgICAgICAgICBzdWJGaWVsZENvdW50ZXIgKz0gMTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAnaW5wdXQnKSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KFxuICAgICAgICAgICAgICAgICAgd3JhcHBlclxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdChjb3VudClcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLnR5cGUoKSxcbiAgICAgICAgICAgICAgICApLnRvRXF1YWwoSW5wdXQpO1xuXG4gICAgICAgICAgICAgICAgZmFpbFRlc3Qod3JhcHBlciwgZmllbGQsIGNvdW50KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvdW50ICs9IDE7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGRlc2NyaWJlKCdGb3JtIEJ1dHRvbicsICgpID0+IHtcbiAgICAgICAgbGV0IGZvcm1CdXR0b247XG5cbiAgICAgICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgICAgZm9ybUJ1dHRvbiA9IGZvcm1Db21wb25lbnQuY2hpbGRBdChudW1iZXJPZkZpZWxkcyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdJdCBpcyBhIGJ1dHRvbicsICgpID0+IHtcbiAgICAgICAgICBleHBlY3QoZm9ybUJ1dHRvbi50eXBlKCkpLnRvRXF1YWwoRm9ybS5CdXR0b24pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19