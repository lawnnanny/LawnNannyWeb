6f398f23318dbdf41b18c454a441d8d2
'use strict';

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _semanticUiReact = require('semantic-ui-react');

var _enzyme = require('enzyme');

var _chance = require('chance');

var _DynamicForm = require('../../../src/components/helpers/DynamicForm');

var _DynamicForm2 = _interopRequireDefault(_DynamicForm);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var chance = new _chance.Chance();

var randomType = function randomType() {
  switch (chance.integer() % 4) {
    case 0:
      return 'textArea';
    case 1:
      return 'radio';
    case 2:
      return 'checkbox';
    case 3:
      return 'input';
    default:
      return 'textArea';
  }
};

var createRandomOptions = function createRandomOptions() {
  var options = [];
  var numberOfOptions = chance.integer() % 11 + 1;
  for (var counter = 0; counter < numberOfOptions; counter += 1) {
    options[counter] = chance.word();
  }
  return options;
};

var generateTestFormJson = function generateTestFormJson() {
  var name = chance.word();
  var jsonForm = {};
  var numberOfFields = chance.integer() % 11 + 1;
  var fields = [];
  for (var counter = 0; counter < numberOfFields; counter += 1) {
    var type = randomType();

    var field = {
      name: chance.word(),
      type: type,
      id: chance.word()
    };

    if (chance.integer() % 2 === 0) {
      field.validation = 'required';
    }
    if (type === 'radio') {
      field.options = createRandomOptions();
    }
    if (type === 'textArea' || type === 'input') {
      field.placeholder = chance.word();
    }

    fields[counter] = field;
  }
  jsonForm[name] = {};
  jsonForm[name].fields = fields;
  return jsonForm;
};

describe('DynamicForm', function () {
  var wrapper = void 0;
  var setRequest = jest.fn();
  var testJson = generateTestFormJson();
  var _route = jest.fn();
  var renderComponent = function renderComponent() {
    return (0, _enzyme.shallow)(_react2.default.createElement(_DynamicForm2.default, {
      jsonForm: function jsonForm() {
        return testJson;
      },
      setRequest: setRequest,
      form: Object.keys(testJson)[0],
      route: function route() {
        _route();
      }
    }));
  };

  beforeEach(function () {
    wrapper = renderComponent();
  });

  it('is wrapped in a Segment', function () {
    expect(wrapper.type()).toEqual(_semanticUiReact.Segment);
  });

  it('is styled as a padded Segment', function () {
    expect(wrapper.props().padded).toBeTruthy();
  });

  describe('header', function () {
    var header = void 0;

    beforeEach(function () {
      header = wrapper.childAt(0);
    });

    it('is a header', function () {
      expect(header.type()).toEqual(_semanticUiReact.Header);
    });

    it('is has a large size', function () {
      expect(header.props().size).toEqual('large');
    });

    it('is the correct text in the header', function () {
      expect(header.childAt(0).debug()).toEqual(Object.keys(testJson)[0]);
    });
  });

  describe('form', function () {
    it('is a form', function () {
      expect(wrapper.childAt(1).type()).toEqual(_semanticUiReact.Form);
    });

    describe('form data', function () {
      wrapper = renderComponent();
      var count = 0;
      var form = wrapper.childAt(1);
      var segmentOfFields = form.childAt(0);
      testJson[Object.keys(testJson)[0]].fields.forEach(function (field) {
        var jsxField = segmentOfFields.childAt(count);
        // console.log(segmentOfFields.childAt(0).childAt(0).text());
        // console.log(segmentOfFields.childAt(1).childAt(0).text());
        // console.log(field);
        it('field ' + count + ' is correct', function () {
          var label = jsxField.childAt(0);
          console.log(label.debug());
          if (field.validation) {
            expect(label.text()).toEqual(' * ' + field.name);
          } else {
            expect(label.text()).toEqual(field.name);
          }
          expect(jsxField.childAt(1).props().name === field.name);
          if (field.type === 'checkbox') {
            expect(jsxField.childAt(1).type()).toEqual(_semanticUiReact.Checkbox);
          }
          if (field.type === 'radio') {
            expect(jsxField.childAt(1).type()).toEqual(_semanticUiReact.Radio);
          }
          if (field.type === 'textArea') {
            expect(jsxField.childAt(1).type()).toEqual(_semanticUiReact.TextArea);
          }
          if (field.type === 'dropDown') {
            expect(jsxField.childAt(1).type()).toEqual(_semanticUiReact.Dropdown);
          }
          if (field.type === 'input') {
            expect(jsxField.childAt(1).type()).toEqual(_semanticUiReact.Input);
          }
          count += 1;
        });
      });
    });
  });

  describe('Submit Button', function () {
    var submitSegment = void 0;

    beforeEach(function () {
      submitSegment = wrapper.childAt(1).childAt(1);
    });

    it('It is a segment', function () {
      expect(submitSegment.type()).toEqual(_semanticUiReact.Segment);
    });

    it('There is a button in the segment', function () {
      var button = submitSegment.childAt(0);
      expect(button.type()).toEqual(_semanticUiReact.Button);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkR5bmFtaWNGb3JtLnNwZWMuanMiXSwibmFtZXMiOlsiY2hhbmNlIiwiQ2hhbmNlIiwicmFuZG9tVHlwZSIsImludGVnZXIiLCJjcmVhdGVSYW5kb21PcHRpb25zIiwib3B0aW9ucyIsIm51bWJlck9mT3B0aW9ucyIsImNvdW50ZXIiLCJ3b3JkIiwiZ2VuZXJhdGVUZXN0Rm9ybUpzb24iLCJuYW1lIiwianNvbkZvcm0iLCJudW1iZXJPZkZpZWxkcyIsImZpZWxkcyIsInR5cGUiLCJmaWVsZCIsImlkIiwidmFsaWRhdGlvbiIsInBsYWNlaG9sZGVyIiwiZGVzY3JpYmUiLCJ3cmFwcGVyIiwic2V0UmVxdWVzdCIsImplc3QiLCJmbiIsInRlc3RKc29uIiwicm91dGUiLCJyZW5kZXJDb21wb25lbnQiLCJPYmplY3QiLCJrZXlzIiwiYmVmb3JlRWFjaCIsIml0IiwiZXhwZWN0IiwidG9FcXVhbCIsIlNlZ21lbnQiLCJwcm9wcyIsInBhZGRlZCIsInRvQmVUcnV0aHkiLCJoZWFkZXIiLCJjaGlsZEF0IiwiSGVhZGVyIiwic2l6ZSIsImRlYnVnIiwiRm9ybSIsImNvdW50IiwiZm9ybSIsInNlZ21lbnRPZkZpZWxkcyIsImZvckVhY2giLCJqc3hGaWVsZCIsImxhYmVsIiwiY29uc29sZSIsImxvZyIsInRleHQiLCJDaGVja2JveCIsIlJhZGlvIiwiVGV4dEFyZWEiLCJEcm9wZG93biIsIklucHV0Iiwic3VibWl0U2VnbWVudCIsImJ1dHRvbiIsIkJ1dHRvbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7OztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7QUFFQSxJQUFNQSxTQUFTLElBQUlDLGNBQUosRUFBZjs7QUFFQSxJQUFNQyxhQUFhLFNBQWJBLFVBQWEsR0FBTTtBQUN2QixVQUFRRixPQUFPRyxPQUFQLEtBQW1CLENBQTNCO0FBQ0UsU0FBSyxDQUFMO0FBQ0UsYUFBTyxVQUFQO0FBQ0YsU0FBSyxDQUFMO0FBQ0UsYUFBTyxPQUFQO0FBQ0YsU0FBSyxDQUFMO0FB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QnhCLElBQXBCLEVBQVAsRUFBbUNrQixPQUFuQyxDQUEyQ3dCLHNCQUEzQztBQUNEO0FBQ0RiLG1CQUFTLENBQVQ7QUFDRCxTQXpCRDtBQTBCRCxPQS9CRDtBQWdDRCxLQXJDRDtBQXNDRCxHQTNDRDs7QUE2Q0F4QixXQUFTLGVBQVQsRUFBMEIsWUFBTTtBQUM5QixRQUFJc0Msc0JBQUo7O0FBRUE1QixlQUFXLFlBQU07QUFDZjRCLHNCQUFnQnJDLFFBQVFrQixPQUFSLENBQWdCLENBQWhCLEVBQW1CQSxPQUFuQixDQUEyQixDQUEzQixDQUFoQjtBQUNELEtBRkQ7O0FBSUFSLE9BQUcsaUJBQUgsRUFBc0IsWUFBTTtBQUMxQkMsYUFBTzBCLGNBQWMzQyxJQUFkLEVBQVAsRUFBNkJrQixPQUE3QixDQUFxQ0Msd0JBQXJDO0FBQ0QsS0FGRDs7QUFJQUgsT0FBRyxrQ0FBSCxFQUF1QyxZQUFNO0FBQzNDLFVBQU00QixTQUFTRCxjQUFjbkIsT0FBZCxDQUFzQixDQUF0QixDQUFmO0FBQ0FQLGFBQU8yQixPQUFPNUMsSUFBUCxFQUFQLEVBQXNCa0IsT0FBdEIsQ0FBOEIyQix1QkFBOUI7QUFDRCxLQUhEO0FBSUQsR0FmRDtBQWdCRCxDQTlHRCIsImZpbGUiOiJEeW5hbWljRm9ybS5zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IEJ1dHRvbiwgRm9ybSwgU2VnbWVudCwgSGVhZGVyLCBSYWRpbywgQ2hlY2tib3gsIFRleHRBcmVhLCBEcm9wZG93biwgSW5wdXQgfSBmcm9tICdzZW1hbnRpYy11aS1yZWFjdCc7XG5pbXBvcnQgeyBzaGFsbG93IH0gZnJvbSAnZW56eW1lJztcbmltcG9ydCB7IENoYW5jZSB9IGZyb20gJ2NoYW5jZSc7XG5pbXBvcnQgRHluYW1pY0Zvcm1Db21wb25lbnQgZnJvbSAnLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvaGVscGVycy9EeW5hbWljRm9ybSc7XG5cbmNvbnN0IGNoYW5jZSA9IG5ldyBDaGFuY2UoKTtcblxuY29uc3QgcmFuZG9tVHlwZSA9ICgpID0+IHtcbiAgc3dpdGNoIChjaGFuY2UuaW50ZWdlcigpICUgNCkge1xuICAgIGNhc2UgMDpcbiAgICAgIHJldHVybiAndGV4dEFyZWEnO1xuICAgIGNhc2UgMTpcbiAgICAgIHJldHVybiAncmFkaW8nO1xuICAgIGNhc2UgMjpcbiAgICAgIHJldHVybiAnY2hlY2tib3gnO1xuICAgIGNhc2UgMzpcbiAgICAgIHJldHVybiAnaW5wdXQnO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gJ3RleHRBcmVhJztcbiAgfVxufTtcblxuY29uc3QgY3JlYXRlUmFuZG9tT3B0aW9ucyA9ICgpID0+IHtcbiAgY29uc3Qgb3B0aW9ucyA9IFtdO1xuICBjb25zdCBudW1iZXJPZk9wdGlvbnMgPSAoY2hhbmNlLmludGVnZXIoKSAlIDExKSArIDE7XG4gIGZvciAobGV0IGNvdW50ZXIgPSAwOyBjb3VudGVyIDwgbnVtYmVyT2ZPcHRpb25zOyBjb3VudGVyICs9IDEpIHtcbiAgICBvcHRpb25zW2NvdW50ZXJdID0gY2hhbmNlLndvcmQoKTtcbiAgfVxuICByZXR1cm4gb3B0aW9ucztcbn07XG5cbmNvbnN0IGdlbmVyYXRlVGVzdEZvcm1Kc29uID0gKCkgPT4ge1xuICBjb25zdCBuYW1lID0gY2hhbmNlLndvcmQoKTtcbiAgY29uc3QganNvbkZvcm0gPSB7fTtcbiAgY29uc3QgbnVtYmVyT2ZGaWVsZHMgPSAoY2hhbmNlLmludGVnZXIoKSAlIDExKSArIDE7XG4gIGNvbnN0IGZpZWxkcyA9IFtdO1xuICBmb3IgKGxldCBjb3VudGVyID0gMDsgY291bnRlciA8IG51bWJlck9mRmllbGRzOyBjb3VudGVyICs9IDEpIHtcbiAgICBjb25zdCB0eXBlID0gcmFuZG9tVHlwZSgpO1xuXG4gICAgY29uc3QgZmllbGQgPSB7XG4gICAgICBuYW1lOiBjaGFuY2Uud29yZCgpLFxuICAgICAgdHlwZSxcbiAgICAgIGlkOiBjaGFuY2Uud29yZCgpLFxuICAgIH07XG5cbiAgICBpZiAoY2hhbmNlLmludGVnZXIoKSAlIDIgPT09IDApIHtcbiAgICAgIGZpZWxkLnZhbGlkYXRpb24gPSAncmVxdWlyZWQnO1xuICAgIH1cbiAgICBpZiAodHlwZSA9PT0gJ3JhZGlvJykge1xuICAgICAgZmllbGQub3B0aW9ucyA9IGNyZWF0ZVJhbmRvbU9wdGlvbnMoKTtcbiAgICB9XG4gICAgaWYgKHR5cGUgPT09ICd0ZXh0QXJlYScgfHwgdHlwZSA9PT0gJ2lucHV0Jykge1xuICAgICAgZmllbGQucGxhY2Vob2xkZXIgPSBjaGFuY2Uud29yZCgpO1xuICAgIH1cblxuICAgIGZpZWxkc1tjb3VudGVyXSA9IGZpZWxkO1xuICB9XG4gIGpzb25Gb3JtW25hbWVdID0ge307XG4gIGpzb25Gb3JtW25hbWVdLmZpZWxkcyA9IGZpZWxkcztcbiAgcmV0dXJuIGpzb25Gb3JtO1xufTtcblxuZGVzY3JpYmUoJ0R5bmFtaWNGb3JtJywgKCkgPT4ge1xuICBsZXQgd3JhcHBlcjtcbiAgY29uc3Qgc2V0UmVxdWVzdCA9IGplc3QuZm4oKTtcbiAgY29uc3QgdGVzdEpzb24gPSBnZW5lcmF0ZVRlc3RGb3JtSnNvbigpO1xuICBjb25zdCByb3V0ZSA9IGplc3QuZm4oKTtcbiAgY29uc3QgcmVuZGVyQ29tcG9uZW50ID0gKCkgPT5cbiAgICBzaGFsbG93KFxuICAgICAgPER5bmFtaWNGb3JtQ29tcG9uZW50XG4gICAgICAgIGpzb25Gb3JtPXsoKSA9PiB0ZXN0SnNvbn1cbiAgICAgICAgc2V0UmVxdWVzdD17c2V0UmVxdWVzdH1cbiAgICAgICAgZm9ybT17T2JqZWN0LmtleXModGVzdEpzb24pWzBdfVxuICAgICAgICByb3V0ZT17KCkgPT4ge1xuICAgICAgICAgIHJvdXRlKCk7XG4gICAgICAgIH19XG4gICAgICAvPixcbiAgICApO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHdyYXBwZXIgPSByZW5kZXJDb21wb25lbnQoKTtcbiAgfSk7XG5cbiAgaXQoJ2lzIHdyYXBwZWQgaW4gYSBTZWdtZW50JywgKCkgPT4ge1xuICAgIGV4cGVjdCh3cmFwcGVyLnR5cGUoKSkudG9FcXVhbChTZWdtZW50KTtcbiAgfSk7XG5cbiAgaXQoJ2lzIHN0eWxlZCBhcyBhIHBhZGRlZCBTZWdtZW50JywgKCkgPT4ge1xuICAgIGV4cGVjdCh3cmFwcGVyLnByb3BzKCkucGFkZGVkKS50b0JlVHJ1dGh5KCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdoZWFkZXInLCAoKSA9PiB7XG4gICAgbGV0IGhlYWRlcjtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgaGVhZGVyID0gd3JhcHBlci5jaGlsZEF0KDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2lzIGEgaGVhZGVyJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGhlYWRlci50eXBlKCkpLnRvRXF1YWwoSGVhZGVyKTtcbiAgICB9KTtcblxuICAgIGl0KCdpcyBoYXMgYSBsYXJnZSBzaXplJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGhlYWRlci5wcm9wcygpLnNpemUpLnRvRXF1YWwoJ2xhcmdlJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnaXMgdGhlIGNvcnJlY3QgdGV4dCBpbiB0aGUgaGVhZGVyJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGhlYWRlci5jaGlsZEF0KDApLmRlYnVnKCkpLnRvRXF1YWwoT2JqZWN0LmtleXModGVzdEpzb24pWzBdKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2Zvcm0nLCAoKSA9PiB7XG4gICAgaXQoJ2lzIGEgZm9ybScsICgpID0+IHtcbiAgICAgIGV4cGVjdCh3cmFwcGVyLmNoaWxkQXQoMSkudHlwZSgpKS50b0VxdWFsKEZvcm0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2Zvcm0gZGF0YScsICgpID0+IHtcbiAgICAgIHdyYXBwZXIgPSByZW5kZXJDb21wb25lbnQoKTtcbiAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICBjb25zdCBmb3JtID0gd3JhcHBlci5jaGlsZEF0KDEpO1xuICAgICAgY29uc3Qgc2VnbWVudE9mRmllbGRzID0gZm9ybS5jaGlsZEF0KDApO1xuICAgICAgdGVzdEpzb25bT2JqZWN0LmtleXModGVzdEpzb24pWzBdXS5maWVsZHMuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgICAgY29uc3QganN4RmllbGQgPSBzZWdtZW50T2ZGaWVsZHMuY2hpbGRBdChjb3VudCk7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHNlZ21lbnRPZkZpZWxkcy5jaGlsZEF0KDApLmNoaWxkQXQoMCkudGV4dCgpKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coc2VnbWVudE9mRmllbGRzLmNoaWxkQXQoMSkuY2hpbGRBdCgwKS50ZXh0KCkpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhmaWVsZCk7XG4gICAgICAgIGl0KGBmaWVsZCAke2NvdW50fSBpcyBjb3JyZWN0YCwgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGxhYmVsID0ganN4RmllbGQuY2hpbGRBdCgwKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhsYWJlbC5kZWJ1ZygpKTtcbiAgICAgICAgICBpZiAoZmllbGQudmFsaWRhdGlvbikge1xuICAgICAgICAgICAgZXhwZWN0KGxhYmVsLnRleHQoKSkudG9FcXVhbChgICogJHtmaWVsZC5uYW1lfWApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBleHBlY3QobGFiZWwudGV4dCgpKS50b0VxdWFsKGZpZWxkLm5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBleHBlY3QoanN4RmllbGQuY2hpbGRBdCgxKS5wcm9wcygpLm5hbWUgPT09IGZpZWxkLm5hbWUpO1xuICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAnY2hlY2tib3gnKSB7XG4gICAgICAgICAgICBleHBlY3QoanN4RmllbGQuY2hpbGRBdCgxKS50eXBlKCkpLnRvRXF1YWwoQ2hlY2tib3gpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZmllbGQudHlwZSA9PT0gJ3JhZGlvJykge1xuICAgICAgICAgICAgZXhwZWN0KGpzeEZpZWxkLmNoaWxkQXQoMSkudHlwZSgpKS50b0VxdWFsKFJhZGlvKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICd0ZXh0QXJlYScpIHtcbiAgICAgICAgICAgIGV4cGVjdChqc3hGaWVsZC5jaGlsZEF0KDEpLnR5cGUoKSkudG9FcXVhbChUZXh0QXJlYSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAnZHJvcERvd24nKSB7XG4gICAgICAgICAgICBleHBlY3QoanN4RmllbGQuY2hpbGRBdCgxKS50eXBlKCkpLnRvRXF1YWwoRHJvcGRvd24pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZmllbGQudHlwZSA9PT0gJ2lucHV0Jykge1xuICAgICAgICAgICAgZXhwZWN0KGpzeEZpZWxkLmNoaWxkQXQoMSkudHlwZSgpKS50b0VxdWFsKElucHV0KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY291bnQgKz0gMTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1N1Ym1pdCBCdXR0b24nLCAoKSA9PiB7XG4gICAgbGV0IHN1Ym1pdFNlZ21lbnQ7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIHN1Ym1pdFNlZ21lbnQgPSB3cmFwcGVyLmNoaWxkQXQoMSkuY2hpbGRBdCgxKTtcbiAgICB9KTtcblxuICAgIGl0KCdJdCBpcyBhIHNlZ21lbnQnLCAoKSA9PiB7XG4gICAgICBleHBlY3Qoc3VibWl0U2VnbWVudC50eXBlKCkpLnRvRXF1YWwoU2VnbWVudCk7XG4gICAgfSk7XG5cbiAgICBpdCgnVGhlcmUgaXMgYSBidXR0b24gaW4gdGhlIHNlZ21lbnQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBidXR0b24gPSBzdWJtaXRTZWdtZW50LmNoaWxkQXQoMCk7XG4gICAgICBleHBlY3QoYnV0dG9uLnR5cGUoKSkudG9FcXVhbChCdXR0b24pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19