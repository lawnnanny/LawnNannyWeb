d0f7b8460b8cc3254a55fac7f3778865
'use strict';

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _semanticUiReact = require('semantic-ui-react');

var _enzyme = require('enzyme');

var _chance = require('chance');

var _DynamicForm = require('../../../src/components/helpers/DynamicForm');

var _DynamicForm2 = _interopRequireDefault(_DynamicForm);

var _InlineError = require('../../../src/components/helpers/InlineError');

var _InlineError2 = _interopRequireDefault(_InlineError);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var chance = new _chance.Chance();

var numberOfFields = Math.abs(chance.integer()) % 20 + 100;

var randomType = function randomType(useRowCombination) {
  switch (chance.integer() % 5) {
    case 0:
      return 'textArea';
    case 1:
      return 'radio';
    case 2:
      return 'checkbox';
    case 3:
      if (useRowCombination) {
        return 'rowCombination';
      }
      return 'input';
    case 4:
      return 'input';
    default:
      return 'textArea';
  }
};

var failTest = function failTest(wrapper, field, count) {
  if (chance.integer() % 2 && field.validation) {
    var state = { errors: {} };
    state.errors[field.id] = 'Nothing is Selected';
    wrapper.setState(state);
    wrapper.update();
    expect(wrapper.childAt(1).childAt(0).childAt(count).find(_InlineError2.default).props().text).toEqual('Nothing is Selected');
  }
};

var createRandomOptions = function createRandomOptions() {
  var options = [];
  var numberOfOptions = Math.abs(chance.integer()) % 11 + 2;
  for (var counter = 0; counter < numberOfOptions; counter += 1) {
    options[counter] = chance.word();
  }
  return options;
};

var generateTestFormJson = function generateTestFormJson() {
  var name = chance.word();
  var jsonForm = {};
  var fields = [];
  for (var counter = 0; counter < numberOfFields; counter += 1) {
    var type = randomType(true);

    var field = {};
    if (type === 'rowCombination') {
      var numberOfSubFields = chance.integer() % 11 + 2;
      var subFields = [];
      for (var counting = 0; counting < numberOfSubFields; counting += 1) {
        var subFieldType = randomType(false);
        var subField = {
          name: chance.word(),
          type: subFieldType,
          id: chance.word()
        };

        if (chance.integer() % 2 === 0) {
          subField.validation = 'required';
        }

        if (type === 'radio') {
          subField.options = createRandomOptions();
        }

        if (subFieldType === 'textArea' || type === 'input') {
          subField.placeholder = chance.word();
        }
        subFields[counting] = subField;
      }

      field = {
        name: chance.word(),
        type: 'rowCombination',
        fields: subFields
      };
    } else {
      field = {
        name: chance.word(),
        type: type,
        id: chance.word()
      };

      if (chance.integer() % 2 === 0) {
        field.validation = 'required';
      }
      if (type === 'radio') {
        field.options = createRandomOptions();
      }
      if (type === 'textArea' || type === 'input') {
        field.placeholder = chance.word();
      }
    }

    fields[counter] = field;
  }
  jsonForm[name] = {};
  jsonForm[name].description = chance.word();
  jsonForm[name].fields = fields;
  return jsonForm;
};

describe('DynamicForm', function () {
  var wrapper = void 0;
  var setRequest = jest.fn();
  var testJson = generateTestFormJson();
  var _route = jest.fn();
  var renderComponent = function renderComponent() {
    return (0, _enzyme.shallow)(_react2.default.createElement(_DynamicForm2.default, {
      jsonForm: function jsonForm() {
        return testJson;
      },
      setRequest: setRequest,
      form: Object.keys(testJson)[0],
      route: function route() {
        _route();
      }
    }));
  };

  beforeEach(function () {
    wrapper = renderComponent();
  });

  it('is wrapped in a Segment', function () {
    expect(wrapper.type()).toEqual(_semanticUiReact.Segment);
  });

  it('is styled as a padded Segment', function () {
    expect(wrapper.props().padded).toBeTruthy();
  });

  describe('header', function () {
    var header = void 0;

    beforeEach(function () {
      header = wrapper.childAt(0);
    });

    it('is a header', function () {
      expect(header.type()).toEqual(_semanticUiReact.Header);
    });

    it('is has an as equal to h3', function () {
      expect(header.props().as).toEqual('h3');
    });

    it('is the correct text in the header', function () {
      expect(header.childAt(0).debug()).toEqual(testJson[Object.keys(testJson)[0]].description);
    });
  });
  describe('form segment', function () {
    var formSegment = void 0;

    beforeEach(function () {
      formSegment = wrapper.childAt(1);
    });

    it('is a segment', function () {
      expect(formSegment.type()).toEqual(_semanticUiReact.Segment);
    });

    describe('form', function () {
      var formComponent = void 0;
      beforeEach(function () {
        formComponent = formSegment.childAt(0);
      });
      it('is a form', function () {
        expect(formComponent.type()).toEqual(_semanticUiReact.Form);
      });

      describe('form data', function () {
        var count = -1;
        beforeEach(function () {
          count += 1;
          wrapper = renderComponent();
          formSegment = wrapper.childAt(1);
          formComponent = formSegment.childAt(0);
        });
        testJson[Object.keys(testJson)[0]].fields.forEach(function (field) {
          it('field ' + count + ' is correct', function () {
            if (field.type !== 'rowCombination') {
              var label = formComponent.childAt(count).childAt(0);
              console.log(formComponent.debug());
              if (field.validation) {
                expect(label.childAt(0).text()).toEqual(' * ' + field.name);
              } else {
                expect(label.childAt(0).text()).toEqual(field.name);
              }
            }
            expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).props().name === field.name);
            if (field.type === 'checkbox') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Checkbox);
              failTest(wrapper, field, count);
            }
            if (field.type === 'radio') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Form.Group);
              failTest(wrapper, field, count);
            }
            if (field.type === 'textArea') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.TextArea);
              failTest(wrapper, field, count);
            }
            if (field.type === 'dropDown') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Dropdown);
              failTest(wrapper, field, count);
            }

            if (field.type === 'rowCombination') {
              var subFieldCounter = 0;
              field.fields.forEach(function (input) {
                var rowInput = wrapper.childAt(1).childAt(0).childAt(count).childAt(subFieldCounter).childAt(1);

                switch (input.type) {
                  case 'input':
                    expect(rowInput.type()).toEqual(_semanticUiReact.Form.Input);
                    break;
                  case 'dropDown':
                    expect(rowInput.type()).toEqual(_semanticUiReact.Dropdown);
                    break;
                  case 'textArea':
                    expect(rowInput.type()).toEqual(_semanticUiReact.TextArea);
                    break;
                  case 'checkbox':
                    expect(rowInput.type()).toEqual(_semanticUiReact.Checkbox);
                    break;
                  case 'radio':
                    expect(rowInput.type()).toEqual(_semanticUiReact.Checkbox);
                    break;
                  default:
                }
                failTest(wrapper, field, count);
                subFieldCounter += 1;
              });
            }

            if (field.type === 'input') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Form.Input);

              failTest(wrapper, field, count);
            }
          });
        });
      });

      describe('Form Button', function () {
        var formButton = void 0;

        beforeEach(function () {
          formButton = formComponent.childAt(numberOfFields);
        });

        it('It is a button', function () {
          expect(formButton.type()).toEqual(_semanticUiReact.Form.Button);
        });
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkR5bmFtaWNGb3JtLnNwZWMuanMiXSwibmFtZXMiOlsiY2hhbmNlIiwiQ2hhbmNlIiwibnVtYmVyT2ZGaWVsZHMiLCJNYXRoIiwiYWJzIiwiaW50ZWdlciIsInJhbmRvbVR5cGUiLCJ1c2VSb3dDb21iaW5hdGlvbiIsImZhaWxUZXN0Iiwid3JhcHBlciIsImZpZWxkIiwiY291bnQiLCJ2YWxpZGF0aW9uIiwic3RhdGUiLCJlcnJvcnMiLCJpZCIsInNldFN0YXRlIiwidXBkYXRlIiwiZXhwZWN0IiwiY2hpbGRBdCIsImZpbmQiLCJJbmxpbmVFcnJvckNvbXBvbmVudCIsInByb3BzIiwidGV4dCIsInRvRXF1YWwiLCJjcmVhdGVSYW5kb21PcHRpb25zIiwib3B0aW9ucyIsIm51bWJlck9mT3B0aW9ucyIsImNvdW50ZXIiLCJ3b3JkIiwiZ2VuZXJhdGVUZXN0Rm9ybUpzb24iLCJuYW1lIiwianNvbkZvcm0iLCJmaWVsZHMiLCJ0eXBlIiwibnVtYmVyT2ZTdWJGaWVsZHMiLCJzdWJGaWVsZHMiLCJjb3VudGluZyIsInN1YkZpZWxkVHlwZSIsInN1YkZpZWxkIiwicGxhY2Vob2xkZXIiLCJkZXNjcmlwdGlvbiIsImRlc2NyaWJlIiwic2V0UmVxdWVzdCIsImplc3QiLCJmbiIsInRlc3RKc29uIiwicm91dGUiLCJyZW5kZXJDb21wb25lbnQiLCJPYmplY3QiLCJrZXlzIiwiYmVmb3JlRWFjaCIsIml0IiwiU2VnbWVudCIsInBhZGRlZCIsInRvQmVUcnV0aHkiLCJoZWFkZXIiLCJIZWFkZXIiLCJhcyIsImRlYnVnIiwiZm9ybVNlZ21lbnQiLCJmb3JtQ29tcG9uZW50IiwiRm9ybSIsImZvckVhY2giLCJsYWJlbCIsImNvbnNvbGUiLCJsb2ciLCJDaGVja2JveCIsIkdyb3VwIiwiVGV4dEFyZWEiLCJEcm9wZG93biIsInN1YkZpZWxkQ291bnRlciIsImlucHV0Iiwicm93SW5wdXQiLCJJbnB1dCIsImZvcm1CdXR0b24iLCJCdXR0b24iXSwibWFwcGluZ3MiOiI7O0FB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LGdCQUFILEVBQXFCLFlBQU07QUFDekJsQyxpQkFBT3lELFdBQVd6QyxJQUFYLEVBQVAsRUFBMEJWLE9BQTFCLENBQWtDc0Msc0JBQUtjLE1BQXZDO0FBQ0QsU0FGRDtBQUdELE9BVkQ7QUFXRCxLQTdJRDtBQThJRCxHQXpKRDtBQTBKRCxDQTFNRCIsImZpbGUiOiJEeW5hbWljRm9ybS5zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7XG4gIEJ1dHRvbixcbiAgRm9ybSxcbiAgU2VnbWVudCxcbiAgSGVhZGVyLFxuICBSYWRpbyxcbiAgQ2hlY2tib3gsXG4gIFRleHRBcmVhLFxuICBEcm9wZG93bixcbiAgSW5wdXQsXG59IGZyb20gJ3NlbWFudGljLXVpLXJlYWN0JztcbmltcG9ydCB7IHNoYWxsb3cgfSBmcm9tICdlbnp5bWUnO1xuaW1wb3J0IHsgQ2hhbmNlIH0gZnJvbSAnY2hhbmNlJztcbmltcG9ydCBEeW5hbWljRm9ybUNvbXBvbmVudCBmcm9tICcuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9oZWxwZXJzL0R5bmFtaWNGb3JtJztcbmltcG9ydCBJbmxpbmVFcnJvckNvbXBvbmVudCBmcm9tICcuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9oZWxwZXJzL0lubGluZUVycm9yJztcblxuY29uc3QgY2hhbmNlID0gbmV3IENoYW5jZSgpO1xuXG5jb25zdCBudW1iZXJPZkZpZWxkcyA9IChNYXRoLmFicyhjaGFuY2UuaW50ZWdlcigpKSAlIDIwKSArIDEwMDtcblxuY29uc3QgcmFuZG9tVHlwZSA9ICh1c2VSb3dDb21iaW5hdGlvbikgPT4ge1xuICBzd2l0Y2ggKGNoYW5jZS5pbnRlZ2VyKCkgJSA1KSB7XG4gICAgY2FzZSAwOlxuICAgICAgcmV0dXJuICd0ZXh0QXJlYSc7XG4gICAgY2FzZSAxOlxuICAgICAgcmV0dXJuICdyYWRpbyc7XG4gICAgY2FzZSAyOlxuICAgICAgcmV0dXJuICdjaGVja2JveCc7XG4gICAgY2FzZSAzOlxuICAgICAgaWYgKHVzZVJvd0NvbWJpbmF0aW9uKSB7XG4gICAgICAgIHJldHVybiAncm93Q29tYmluYXRpb24nO1xuICAgICAgfVxuICAgICAgcmV0dXJuICdpbnB1dCc7XG4gICAgY2FzZSA0OlxuICAgICAgcmV0dXJuICdpbnB1dCc7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiAndGV4dEFyZWEnO1xuICB9XG59O1xuXG5jb25zdCBmYWlsVGVzdCA9ICh3cmFwcGVyLCBmaWVsZCwgY291bnQpID0+IHtcbiAgaWYgKGNoYW5jZS5pbnRlZ2VyKCkgJSAyICYmIGZpZWxkLnZhbGlkYXRpb24pIHtcbiAgICBjb25zdCBzdGF0ZSA9IHsgZXJyb3JzOiB7fSB9O1xuICAgIHN0YXRlLmVycm9yc1tmaWVsZC5pZF0gPSAnTm90aGluZyBpcyBTZWxlY3RlZCc7XG4gICAgd3JhcHBlci5zZXRTdGF0ZShzdGF0ZSk7XG4gICAgd3JhcHBlci51cGRhdGUoKTtcbiAgICBleHBlY3QoXG4gICAgICB3cmFwcGVyXG4gICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAuZmluZChJbmxpbmVFcnJvckNvbXBvbmVudClcbiAgICAgICAgLnByb3BzKCkudGV4dCxcbiAgICApLnRvRXF1YWwoJ05vdGhpbmcgaXMgU2VsZWN0ZWQnKTtcbiAgfVxufTtcblxuY29uc3QgY3JlYXRlUmFuZG9tT3B0aW9ucyA9ICgpID0+IHtcbiAgY29uc3Qgb3B0aW9ucyA9IFtdO1xuICBjb25zdCBudW1iZXJPZk9wdGlvbnMgPSAoTWF0aC5hYnMoY2hhbmNlLmludGVnZXIoKSkgJSAxMSkgKyAyO1xuICBmb3IgKGxldCBjb3VudGVyID0gMDsgY291bnRlciA8IG51bWJlck9mT3B0aW9uczsgY291bnRlciArPSAxKSB7XG4gICAgb3B0aW9uc1tjb3VudGVyXSA9IGNoYW5jZS53b3JkKCk7XG4gIH1cbiAgcmV0dXJuIG9wdGlvbnM7XG59O1xuXG5jb25zdCBnZW5lcmF0ZVRlc3RGb3JtSnNvbiA9ICgpID0+IHtcbiAgY29uc3QgbmFtZSA9IGNoYW5jZS53b3JkKCk7XG4gIGNvbnN0IGpzb25Gb3JtID0ge307XG4gIGNvbnN0IGZpZWxkcyA9IFtdO1xuICBmb3IgKGxldCBjb3VudGVyID0gMDsgY291bnRlciA8IG51bWJlck9mRmllbGRzOyBjb3VudGVyICs9IDEpIHtcbiAgICBjb25zdCB0eXBlID0gcmFuZG9tVHlwZSh0cnVlKTtcblxuICAgIGxldCBmaWVsZCA9IHt9O1xuICAgIGlmICh0eXBlID09PSAncm93Q29tYmluYXRpb24nKSB7XG4gICAgICBjb25zdCBudW1iZXJPZlN1YkZpZWxkcyA9IChjaGFuY2UuaW50ZWdlcigpICUgMTEpICsgMjtcbiAgICAgIGNvbnN0IHN1YkZpZWxkcyA9IFtdO1xuICAgICAgZm9yIChsZXQgY291bnRpbmcgPSAwOyBjb3VudGluZyA8IG51bWJlck9mU3ViRmllbGRzOyBjb3VudGluZyArPSAxKSB7XG4gICAgICAgIGNvbnN0IHN1YkZpZWxkVHlwZSA9IHJhbmRvbVR5cGUoZmFsc2UpO1xuICAgICAgICBjb25zdCBzdWJGaWVsZCA9IHtcbiAgICAgICAgICBuYW1lOiBjaGFuY2Uud29yZCgpLFxuICAgICAgICAgIHR5cGU6IHN1YkZpZWxkVHlwZSxcbiAgICAgICAgICBpZDogY2hhbmNlLndvcmQoKSxcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAoY2hhbmNlLmludGVnZXIoKSAlIDIgPT09IDApIHtcbiAgICAgICAgICBzdWJGaWVsZC52YWxpZGF0aW9uID0gJ3JlcXVpcmVkJztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0eXBlID09PSAncmFkaW8nKSB7XG4gICAgICAgICAgc3ViRmllbGQub3B0aW9ucyA9IGNyZWF0ZVJhbmRvbU9wdGlvbnMoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzdWJGaWVsZFR5cGUgPT09ICd0ZXh0QXJlYScgfHwgdHlwZSA9PT0gJ2lucHV0Jykge1xuICAgICAgICAgIHN1YkZpZWxkLnBsYWNlaG9sZGVyID0gY2hhbmNlLndvcmQoKTtcbiAgICAgICAgfVxuICAgICAgICBzdWJGaWVsZHNbY291bnRpbmddID0gc3ViRmllbGQ7XG4gICAgICB9XG5cbiAgICAgIGZpZWxkID0ge1xuICAgICAgICBuYW1lOiBjaGFuY2Uud29yZCgpLFxuICAgICAgICB0eXBlOiAncm93Q29tYmluYXRpb24nLFxuICAgICAgICBmaWVsZHM6IHN1YkZpZWxkcyxcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGZpZWxkID0ge1xuICAgICAgICBuYW1lOiBjaGFuY2Uud29yZCgpLFxuICAgICAgICB0eXBlLFxuICAgICAgICBpZDogY2hhbmNlLndvcmQoKSxcbiAgICAgIH07XG5cbiAgICAgIGlmIChjaGFuY2UuaW50ZWdlcigpICUgMiA9PT0gMCkge1xuICAgICAgICBmaWVsZC52YWxpZGF0aW9uID0gJ3JlcXVpcmVkJztcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlID09PSAncmFkaW8nKSB7XG4gICAgICAgIGZpZWxkLm9wdGlvbnMgPSBjcmVhdGVSYW5kb21PcHRpb25zKCk7XG4gICAgICB9XG4gICAgICBpZiAodHlwZSA9PT0gJ3RleHRBcmVhJyB8fCB0eXBlID09PSAnaW5wdXQnKSB7XG4gICAgICAgIGZpZWxkLnBsYWNlaG9sZGVyID0gY2hhbmNlLndvcmQoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmaWVsZHNbY291bnRlcl0gPSBmaWVsZDtcbiAgfVxuICBqc29uRm9ybVtuYW1lXSA9IHt9O1xuICBqc29uRm9ybVtuYW1lXS5kZXNjcmlwdGlvbiA9IGNoYW5jZS53b3JkKCk7XG4gIGpzb25Gb3JtW25hbWVdLmZpZWxkcyA9IGZpZWxkcztcbiAgcmV0dXJuIGpzb25Gb3JtO1xufTtcblxuZGVzY3JpYmUoJ0R5bmFtaWNGb3JtJywgKCkgPT4ge1xuICBsZXQgd3JhcHBlcjtcbiAgY29uc3Qgc2V0UmVxdWVzdCA9IGplc3QuZm4oKTtcbiAgY29uc3QgdGVzdEpzb24gPSBnZW5lcmF0ZVRlc3RGb3JtSnNvbigpO1xuICBjb25zdCByb3V0ZSA9IGplc3QuZm4oKTtcbiAgY29uc3QgcmVuZGVyQ29tcG9uZW50ID0gKCkgPT5cbiAgICBzaGFsbG93KFxuICAgICAgPER5bmFtaWNGb3JtQ29tcG9uZW50XG4gICAgICAgIGpzb25Gb3JtPXsoKSA9PiB0ZXN0SnNvbn1cbiAgICAgICAgc2V0UmVxdWVzdD17c2V0UmVxdWVzdH1cbiAgICAgICAgZm9ybT17T2JqZWN0LmtleXModGVzdEpzb24pWzBdfVxuICAgICAgICByb3V0ZT17KCkgPT4ge1xuICAgICAgICAgIHJvdXRlKCk7XG4gICAgICAgIH19XG4gICAgICAvPixcbiAgICApO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHdyYXBwZXIgPSByZW5kZXJDb21wb25lbnQoKTtcbiAgfSk7XG5cbiAgaXQoJ2lzIHdyYXBwZWQgaW4gYSBTZWdtZW50JywgKCkgPT4ge1xuICAgIGV4cGVjdCh3cmFwcGVyLnR5cGUoKSkudG9FcXVhbChTZWdtZW50KTtcbiAgfSk7XG5cbiAgaXQoJ2lzIHN0eWxlZCBhcyBhIHBhZGRlZCBTZWdtZW50JywgKCkgPT4ge1xuICAgIGV4cGVjdCh3cmFwcGVyLnByb3BzKCkucGFkZGVkKS50b0JlVHJ1dGh5KCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdoZWFkZXInLCAoKSA9PiB7XG4gICAgbGV0IGhlYWRlcjtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgaGVhZGVyID0gd3JhcHBlci5jaGlsZEF0KDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2lzIGEgaGVhZGVyJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGhlYWRlci50eXBlKCkpLnRvRXF1YWwoSGVhZGVyKTtcbiAgICB9KTtcblxuICAgIGl0KCdpcyBoYXMgYW4gYXMgZXF1YWwgdG8gaDMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoaGVhZGVyLnByb3BzKCkuYXMpLnRvRXF1YWwoJ2gzJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnaXMgdGhlIGNvcnJlY3QgdGV4dCBpbiB0aGUgaGVhZGVyJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGhlYWRlci5jaGlsZEF0KDApLmRlYnVnKCkpLnRvRXF1YWwodGVzdEpzb25bT2JqZWN0LmtleXModGVzdEpzb24pWzBdXS5kZXNjcmlwdGlvbik7XG4gICAgfSk7XG4gIH0pO1xuICBkZXNjcmliZSgnZm9ybSBzZWdtZW50JywgKCkgPT4ge1xuICAgIGxldCBmb3JtU2VnbWVudDtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgZm9ybVNlZ21lbnQgPSB3cmFwcGVyLmNoaWxkQXQoMSk7XG4gICAgfSk7XG5cbiAgICBpdCgnaXMgYSBzZWdtZW50JywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGZvcm1TZWdtZW50LnR5cGUoKSkudG9FcXVhbChTZWdtZW50KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdmb3JtJywgKCkgPT4ge1xuICAgICAgbGV0IGZvcm1Db21wb25lbnQ7XG4gICAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgZm9ybUNvbXBvbmVudCA9IGZvcm1TZWdtZW50LmNoaWxkQXQoMCk7XG4gICAgICB9KTtcbiAgICAgIGl0KCdpcyBhIGZvcm0nLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdChmb3JtQ29tcG9uZW50LnR5cGUoKSkudG9FcXVhbChGb3JtKTtcbiAgICAgIH0pO1xuXG4gICAgICBkZXNjcmliZSgnZm9ybSBkYXRhJywgKCkgPT4ge1xuICAgICAgICBsZXQgY291bnQgPSAtMTtcbiAgICAgICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgICAgY291bnQgKz0gMTtcbiAgICAgICAgICB3cmFwcGVyID0gcmVuZGVyQ29tcG9uZW50KCk7XG4gICAgICAgICAgZm9ybVNlZ21lbnQgPSB3cmFwcGVyLmNoaWxkQXQoMSk7XG4gICAgICAgICAgZm9ybUNvbXBvbmVudCA9IGZvcm1TZWdtZW50LmNoaWxkQXQoMCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0ZXN0SnNvbltPYmplY3Qua2V5cyh0ZXN0SnNvbilbMF1dLmZpZWxkcy5mb3JFYWNoKChmaWVsZCkgPT4ge1xuICAgICAgICAgIGl0KGBmaWVsZCAke2NvdW50fSBpcyBjb3JyZWN0YCwgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgIT09ICdyb3dDb21iaW5hdGlvbicpIHtcbiAgICAgICAgICAgICAgY29uc3QgbGFiZWwgPSBmb3JtQ29tcG9uZW50LmNoaWxkQXQoY291bnQpLmNoaWxkQXQoMCk7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKGZvcm1Db21wb25lbnQuZGVidWcoKSk7XG4gICAgICAgICAgICAgIGlmIChmaWVsZC52YWxpZGF0aW9uKSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGxhYmVsLmNoaWxkQXQoMCkudGV4dCgpKS50b0VxdWFsKGAgKiAke2ZpZWxkLm5hbWV9YCk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGxhYmVsLmNoaWxkQXQoMCkudGV4dCgpKS50b0VxdWFsKGZpZWxkLm5hbWUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBleHBlY3QoXG4gICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAucHJvcHMoKS5uYW1lID09PSBmaWVsZC5uYW1lLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAnY2hlY2tib3gnKSB7XG4gICAgICAgICAgICAgIGV4cGVjdChcbiAgICAgICAgICAgICAgICB3cmFwcGVyXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgIC50eXBlKCksXG4gICAgICAgICAgICAgICkudG9FcXVhbChDaGVja2JveCk7XG4gICAgICAgICAgICAgIGZhaWxUZXN0KHdyYXBwZXIsIGZpZWxkLCBjb3VudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZmllbGQudHlwZSA9PT0gJ3JhZGlvJykge1xuICAgICAgICAgICAgICBleHBlY3QoXG4gICAgICAgICAgICAgICAgd3JhcHBlclxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdChjb3VudClcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAudHlwZSgpLFxuICAgICAgICAgICAgICApLnRvRXF1YWwoRm9ybS5Hcm91cCk7XG4gICAgICAgICAgICAgIGZhaWxUZXN0KHdyYXBwZXIsIGZpZWxkLCBjb3VudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZmllbGQudHlwZSA9PT0gJ3RleHRBcmVhJykge1xuICAgICAgICAgICAgICBleHBlY3QoXG4gICAgICAgICAgICAgICAgd3JhcHBlclxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdChjb3VudClcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAudHlwZSgpLFxuICAgICAgICAgICAgICApLnRvRXF1YWwoVGV4dEFyZWEpO1xuICAgICAgICAgICAgICBmYWlsVGVzdCh3cmFwcGVyLCBmaWVsZCwgY291bnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICdkcm9wRG93bicpIHtcbiAgICAgICAgICAgICAgZXhwZWN0KFxuICAgICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLnR5cGUoKSxcbiAgICAgICAgICAgICAgKS50b0VxdWFsKERyb3Bkb3duKTtcbiAgICAgICAgICAgICAgZmFpbFRlc3Qod3JhcHBlciwgZmllbGQsIGNvdW50KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICdyb3dDb21iaW5hdGlvbicpIHtcbiAgICAgICAgICAgICAgbGV0IHN1YkZpZWxkQ291bnRlciA9IDA7XG4gICAgICAgICAgICAgIGZpZWxkLmZpZWxkcy5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJvd0lucHV0ID0gd3JhcHBlclxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdChjb3VudClcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KHN1YkZpZWxkQ291bnRlcilcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpO1xuXG4gICAgICAgICAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7XG4gICAgICAgICAgICAgICAgICBjYXNlICdpbnB1dCc6XG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChyb3dJbnB1dC50eXBlKCkpLnRvRXF1YWwoRm9ybS5JbnB1dCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgY2FzZSAnZHJvcERvd24nOlxuICAgICAgICAgICAgICAgICAgICBleHBlY3Qocm93SW5wdXQudHlwZSgpKS50b0VxdWFsKERyb3Bkb3duKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICBjYXNlICd0ZXh0QXJlYSc6XG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChyb3dJbnB1dC50eXBlKCkpLnRvRXF1YWwoVGV4dEFyZWEpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIGNhc2UgJ2NoZWNrYm94JzpcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KHJvd0lucHV0LnR5cGUoKSkudG9FcXVhbChDaGVja2JveCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgY2FzZSAncmFkaW8nOlxuICAgICAgICAgICAgICAgICAgICBleHBlY3Qocm93SW5wdXQudHlwZSgpKS50b0VxdWFsKENoZWNrYm94KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmYWlsVGVzdCh3cmFwcGVyLCBmaWVsZCwgY291bnQpO1xuICAgICAgICAgICAgICAgIHN1YkZpZWxkQ291bnRlciArPSAxO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICdpbnB1dCcpIHtcbiAgICAgICAgICAgICAgZXhwZWN0KFxuICAgICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLnR5cGUoKSxcbiAgICAgICAgICAgICAgKS50b0VxdWFsKEZvcm0uSW5wdXQpO1xuXG4gICAgICAgICAgICAgIGZhaWxUZXN0KHdyYXBwZXIsIGZpZWxkLCBjb3VudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGRlc2NyaWJlKCdGb3JtIEJ1dHRvbicsICgpID0+IHtcbiAgICAgICAgbGV0IGZvcm1CdXR0b247XG5cbiAgICAgICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgICAgZm9ybUJ1dHRvbiA9IGZvcm1Db21wb25lbnQuY2hpbGRBdChudW1iZXJPZkZpZWxkcyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdJdCBpcyBhIGJ1dHRvbicsICgpID0+IHtcbiAgICAgICAgICBleHBlY3QoZm9ybUJ1dHRvbi50eXBlKCkpLnRvRXF1YWwoRm9ybS5CdXR0b24pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19