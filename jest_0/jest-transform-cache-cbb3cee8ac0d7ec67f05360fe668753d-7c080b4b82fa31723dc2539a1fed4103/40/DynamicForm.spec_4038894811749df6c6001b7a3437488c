424bec3e4e02c387cfde1d33fa405282
'use strict';

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _semanticUiReact = require('semantic-ui-react');

var _enzyme = require('enzyme');

var _chance = require('chance');

var _DynamicForm = require('../../../src/components/helpers/DynamicForm');

var _DynamicForm2 = _interopRequireDefault(_DynamicForm);

var _InlineError = require('../../../src/components/helpers/InlineError');

var _InlineError2 = _interopRequireDefault(_InlineError);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var chance = new _chance.Chance();

var numberOfFields = Math.abs(chance.integer()) % 20 + 100;

var randomType = function randomType(useRowCombination) {
  switch (chance.integer() % 5) {
    case 0:
      return 'textArea';
    case 1:
      return 'radio';
    case 2:
      return 'checkbox';
    case 3:
      if (useRowCombination) {
        return 'rowCombination';
      }
      return 'input';
    case 4:
      return 'input';
    default:
      return 'textArea';
  }
};

var failTest = function failTest(wrapper, field, count) {
  if (chance.integer() % 2 && field.validation) {
    var state = { errors: {} };
    state.errors[field.id] = 'Nothing is Selected';
    wrapper.setState(state);
    wrapper.update();
    expect(wrapper.childAt(1).childAt(0).childAt(count).find(_InlineError2.default).props().text).toEqual('Nothing is Selected');
  }
};

var createRandomOptions = function createRandomOptions() {
  var options = [];
  var numberOfOptions = Math.abs(chance.integer()) % 11 + 2;
  for (var counter = 0; counter < numberOfOptions; counter += 1) {
    options[counter] = chance.word();
  }
  return options;
};

var generateTestFormJson = function generateTestFormJson() {
  var name = chance.word();
  var jsonForm = {};
  var fields = [];
  for (var counter = 0; counter < numberOfFields; counter += 1) {
    var type = randomType(true);

    var field = {};
    if (type === 'rowCombination') {
      var numberOfSubFields = chance.integer() % 11 + 2;
      var subFields = [];
      for (var counting = 0; counting < numberOfSubFields; counting += 1) {
        var subFieldType = randomType(false);
        var subField = {
          name: chance.word(),
          type: subFieldType,
          id: chance.word()
        };

        if (chance.integer() % 2 === 0) {
          subField.validation = 'required';
        }

        if (type === 'radio') {
          subField.options = createRandomOptions();
        }

        if (subFieldType === 'textArea' || type === 'input') {
          subField.placeholder = chance.word();
        }
        subFields[counting] = subField;
      }

      field = {
        name: chance.word(),
        type: 'rowCombination',
        fields: subFields
      };
    } else {
      field = {
        name: chance.word(),
        type: type,
        id: chance.word()
      };

      if (chance.integer() % 2 === 0) {
        field.validation = 'required';
      }
      if (type === 'radio') {
        field.options = createRandomOptions();
      }
      if (type === 'textArea' || type === 'input') {
        field.placeholder = chance.word();
      }
    }

    fields[counter] = field;
  }
  jsonForm[name] = {};
  jsonForm[name].description = chance.word();
  jsonForm[name].fields = fields;
  return jsonForm;
};

describe('DynamicForm', function () {
  var wrapper = void 0;
  var setRequest = jest.fn();
  var testJson = generateTestFormJson();
  var _route = jest.fn();
  var renderComponent = function renderComponent() {
    return (0, _enzyme.shallow)(_react2.default.createElement(_DynamicForm2.default, {
      jsonForm: function jsonForm() {
        return testJson;
      },
      setRequest: setRequest,
      form: Object.keys(testJson)[0],
      route: function route() {
        _route();
      }
    }));
  };

  beforeEach(function () {
    wrapper = renderComponent();
  });

  it('is wrapped in a Segment', function () {
    expect(wrapper.type()).toEqual(_semanticUiReact.Segment);
  });

  it('is styled as a padded Segment', function () {
    expect(wrapper.props().padded).toBeTruthy();
  });

  describe('header', function () {
    var header = void 0;

    beforeEach(function () {
      header = wrapper.childAt(0);
    });

    it('is a header', function () {
      expect(header.type()).toEqual(_semanticUiReact.Header);
    });

    it('is has an as equal to h3', function () {
      expect(header.props().as).toEqual('h3');
    });

    it('is the correct text in the header', function () {
      expect(header.childAt(0).debug()).toEqual(testJson[Object.keys(testJson)[0]].description);
    });
  });
  describe('form segment', function () {
    var formSegment = void 0;

    beforeEach(function () {
      formSegment = wrapper.childAt(1);
    });

    it('is a segment', function () {
      console.log(testJson);
      expect(formSegment.type()).toEqual(_semanticUiReact.Segment);
    });

    describe('form', function () {
      var formComponent = void 0;
      beforeEach(function () {
        formComponent = formSegment.childAt(0);
      });
      it('is a form', function () {
        expect(formComponent.type()).toEqual(_semanticUiReact.Form);
      });

      describe('form data', function () {
        var count = -1;
        beforeEach(function () {
          count += 1;
          wrapper = renderComponent();
          formSegment = wrapper.childAt(1);
          formComponent = formSegment.childAt(0);
        });
        testJson[Object.keys(testJson)[0]].fields.forEach(function (field) {
          it('field ' + count + ' is correct', function () {
            if (field.type !== 'rowCombination') {
              var pre = formComponent.childAt(count);
              var label = pre.childAt(0);
              if (field.validation) {
                expect(label.childAt(0).text()).toEqual(' * ' + field.name);
              } else {
                expect(label.childAt(0).text()).toEqual(field.name);
              }
            }
            expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).props().name === field.name);
            if (field.type === 'checkbox') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Checkbox);
              failTest(wrapper, field, count);
            }
            if (field.type === 'radio') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Form.Group);
              failTest(wrapper, field, count);
            }
            if (field.type === 'textArea') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.TextArea);
              failTest(wrapper, field, count);
            }
            if (field.type === 'dropDown') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Dropdown);
              failTest(wrapper, field, count);
            }

            if (field.type === 'rowCombination') {
              var subFieldCounter = 0;
              field.fields.forEach(function (input) {
                var rowInput = wrapper.childAt(1).childAt(0).childAt(count).childAt(subFieldCounter).childAt(1);

                switch (input.type) {
                  case 'input':
                    expect(rowInput.type()).toEqual(_semanticUiReact.Form.Input);
                    break;
                  case 'dropDown':
                    expect(rowInput.type()).toEqual(_semanticUiReact.Dropdown);
                    break;
                  case 'textArea':
                    expect(rowInput.type()).toEqual(_semanticUiReact.TextArea);
                    break;
                  case 'checkbox':
                    expect(rowInput.type()).toEqual(_semanticUiReact.Checkbox);
                    break;
                  case 'radio':
                    expect(rowInput.type()).toEqual(_semanticUiReact.Checkbox);
                    break;
                  default:
                }
                failTest(wrapper, field, count);
                subFieldCounter += 1;
              });
            }

            if (field.type === 'input') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Form.Input);

              failTest(wrapper, field, count);
            }
          });
        });
      });

      describe('Form Button', function () {
        var formButton = void 0;

        beforeEach(function () {
          formButton = formComponent.childAt(numberOfFields);
        });

        it('It is a button', function () {
          expect(formButton.type()).toEqual(_semanticUiReact.Form.Button);
        });
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkR5bmFtaWNGb3JtLnNwZWMuanMiXSwibmFtZXMiOlsiY2hhbmNlIiwiQ2hhbmNlIiwibnVtYmVyT2ZGaWVsZHMiLCJNYXRoIiwiYWJzIiwiaW50ZWdlciIsInJhbmRvbVR5cGUiLCJ1c2VSb3dDb21iaW5hdGlvbiIsImZhaWxUZXN0Iiwid3JhcHBlciIsImZpZWxkIiwiY291bnQiLCJ2YWxpZGF0aW9uIiwic3RhdGUiLCJlcnJvcnMiLCJpZCIsInNldFN0YXRlIiwidXBkYXRlIiwiZXhwZWN0IiwiY2hpbGRBdCIsImZpbmQiLCJJbmxpbmVFcnJvckNvbXBvbmVudCIsInByb3BzIiwidGV4dCIsInRvRXF1YWwiLCJjcmVhdGVSYW5kb21PcHRpb25zIiwib3B0aW9ucyIsIm51bWJlck9mT3B0aW9ucyIsImNvdW50ZXIiLCJ3b3JkIiwiZ2VuZXJhdGVUZXN0Rm9ybUpzb24iLCJuYW1lIiwianNvbkZvcm0iLCJmaWVsZHMiLCJ0eXBlIiwibnVtYmVyT2ZTdWJGaWVsZHMiLCJzdWJGaWVsZHMiLCJjb3VudGluZyIsInN1YkZpZWxkVHlwZSIsInN1YkZpZWxkIiwicGxhY2Vob2xkZXIiLCJkZXNjcmlwdGlvbiIsImRlc2NyaWJlIiwic2V0UmVxdWVzdCIsImplc3QiLCJmbiIsInRlc3RKc29uIiwicm91dGUiLCJyZW5kZXJDb21wb25lbnQiLCJPYmplY3QiLCJrZXlzIiwiYmVmb3JlRWFjaCIsIml0IiwiU2VnbWVudCIsInBhZGRlZCIsInRvQmVUcnV0aHkiLCJoZWFkZXIiLCJIZWFkZXIiLCJhcyIsImRlYnVnIiwiZm9ybVNlZ21lbnQiLCJjb25zb2xlIiwibG9nIiwiZm9ybUNvbXBvbmVudCIsIkZvcm0iLCJmb3JFYWNoIiwicHJlIiwibGFiZWwiLCJDaGVja2JveCIsIkdyb3VwIiwiVGV4dEFyZWEiLCJEcm9wZG93biIsInN1YkZpZWxkQ291bnRlciIsImlucHV0Iiwicm93SW5wdXQiLCJJbnB1dCIsImZvcm1CdXR0b24iLCJCdXR0b24iXSwibWFwcGluZ3Mi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RDs7QUFJQWtELFdBQUcsZ0JBQUgsRUFBcUIsWUFBTTtBQUN6QmxDLGlCQUFPMEQsV0FBVzFDLElBQVgsRUFBUCxFQUEwQlYsT0FBMUIsQ0FBa0N3QyxzQkFBS2EsTUFBdkM7QUFDRCxTQUZEO0FBR0QsT0FWRDtBQVdELEtBN0lEO0FBOElELEdBMUpEO0FBMkpELENBM01EIiwiZmlsZSI6IkR5bmFtaWNGb3JtLnNwZWMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtcbiAgQnV0dG9uLFxuICBGb3JtLFxuICBTZWdtZW50LFxuICBIZWFkZXIsXG4gIFJhZGlvLFxuICBDaGVja2JveCxcbiAgVGV4dEFyZWEsXG4gIERyb3Bkb3duLFxuICBJbnB1dCxcbn0gZnJvbSAnc2VtYW50aWMtdWktcmVhY3QnO1xuaW1wb3J0IHsgc2hhbGxvdyB9IGZyb20gJ2VuenltZSc7XG5pbXBvcnQgeyBDaGFuY2UgfSBmcm9tICdjaGFuY2UnO1xuaW1wb3J0IER5bmFtaWNGb3JtQ29tcG9uZW50IGZyb20gJy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL2hlbHBlcnMvRHluYW1pY0Zvcm0nO1xuaW1wb3J0IElubGluZUVycm9yQ29tcG9uZW50IGZyb20gJy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL2hlbHBlcnMvSW5saW5lRXJyb3InO1xuXG5jb25zdCBjaGFuY2UgPSBuZXcgQ2hhbmNlKCk7XG5cbmNvbnN0IG51bWJlck9mRmllbGRzID0gKE1hdGguYWJzKGNoYW5jZS5pbnRlZ2VyKCkpICUgMjApICsgMTAwO1xuXG5jb25zdCByYW5kb21UeXBlID0gKHVzZVJvd0NvbWJpbmF0aW9uKSA9PiB7XG4gIHN3aXRjaCAoY2hhbmNlLmludGVnZXIoKSAlIDUpIHtcbiAgICBjYXNlIDA6XG4gICAgICByZXR1cm4gJ3RleHRBcmVhJztcbiAgICBjYXNlIDE6XG4gICAgICByZXR1cm4gJ3JhZGlvJztcbiAgICBjYXNlIDI6XG4gICAgICByZXR1cm4gJ2NoZWNrYm94JztcbiAgICBjYXNlIDM6XG4gICAgICBpZiAodXNlUm93Q29tYmluYXRpb24pIHtcbiAgICAgICAgcmV0dXJuICdyb3dDb21iaW5hdGlvbic7XG4gICAgICB9XG4gICAgICByZXR1cm4gJ2lucHV0JztcbiAgICBjYXNlIDQ6XG4gICAgICByZXR1cm4gJ2lucHV0JztcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuICd0ZXh0QXJlYSc7XG4gIH1cbn07XG5cbmNvbnN0IGZhaWxUZXN0ID0gKHdyYXBwZXIsIGZpZWxkLCBjb3VudCkgPT4ge1xuICBpZiAoY2hhbmNlLmludGVnZXIoKSAlIDIgJiYgZmllbGQudmFsaWRhdGlvbikge1xuICAgIGNvbnN0IHN0YXRlID0geyBlcnJvcnM6IHt9IH07XG4gICAgc3RhdGUuZXJyb3JzW2ZpZWxkLmlkXSA9ICdOb3RoaW5nIGlzIFNlbGVjdGVkJztcbiAgICB3cmFwcGVyLnNldFN0YXRlKHN0YXRlKTtcbiAgICB3cmFwcGVyLnVwZGF0ZSgpO1xuICAgIGV4cGVjdChcbiAgICAgIHdyYXBwZXJcbiAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgIC5maW5kKElubGluZUVycm9yQ29tcG9uZW50KVxuICAgICAgICAucHJvcHMoKS50ZXh0LFxuICAgICkudG9FcXVhbCgnTm90aGluZyBpcyBTZWxlY3RlZCcpO1xuICB9XG59O1xuXG5jb25zdCBjcmVhdGVSYW5kb21PcHRpb25zID0gKCkgPT4ge1xuICBjb25zdCBvcHRpb25zID0gW107XG4gIGNvbnN0IG51bWJlck9mT3B0aW9ucyA9IChNYXRoLmFicyhjaGFuY2UuaW50ZWdlcigpKSAlIDExKSArIDI7XG4gIGZvciAobGV0IGNvdW50ZXIgPSAwOyBjb3VudGVyIDwgbnVtYmVyT2ZPcHRpb25zOyBjb3VudGVyICs9IDEpIHtcbiAgICBvcHRpb25zW2NvdW50ZXJdID0gY2hhbmNlLndvcmQoKTtcbiAgfVxuICByZXR1cm4gb3B0aW9ucztcbn07XG5cbmNvbnN0IGdlbmVyYXRlVGVzdEZvcm1Kc29uID0gKCkgPT4ge1xuICBjb25zdCBuYW1lID0gY2hhbmNlLndvcmQoKTtcbiAgY29uc3QganNvbkZvcm0gPSB7fTtcbiAgY29uc3QgZmllbGRzID0gW107XG4gIGZvciAobGV0IGNvdW50ZXIgPSAwOyBjb3VudGVyIDwgbnVtYmVyT2ZGaWVsZHM7IGNvdW50ZXIgKz0gMSkge1xuICAgIGNvbnN0IHR5cGUgPSByYW5kb21UeXBlKHRydWUpO1xuXG4gICAgbGV0IGZpZWxkID0ge307XG4gICAgaWYgKHR5cGUgPT09ICdyb3dDb21iaW5hdGlvbicpIHtcbiAgICAgIGNvbnN0IG51bWJlck9mU3ViRmllbGRzID0gKGNoYW5jZS5pbnRlZ2VyKCkgJSAxMSkgKyAyO1xuICAgICAgY29uc3Qgc3ViRmllbGRzID0gW107XG4gICAgICBmb3IgKGxldCBjb3VudGluZyA9IDA7IGNvdW50aW5nIDwgbnVtYmVyT2ZTdWJGaWVsZHM7IGNvdW50aW5nICs9IDEpIHtcbiAgICAgICAgY29uc3Qgc3ViRmllbGRUeXBlID0gcmFuZG9tVHlwZShmYWxzZSk7XG4gICAgICAgIGNvbnN0IHN1YkZpZWxkID0ge1xuICAgICAgICAgIG5hbWU6IGNoYW5jZS53b3JkKCksXG4gICAgICAgICAgdHlwZTogc3ViRmllbGRUeXBlLFxuICAgICAgICAgIGlkOiBjaGFuY2Uud29yZCgpLFxuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChjaGFuY2UuaW50ZWdlcigpICUgMiA9PT0gMCkge1xuICAgICAgICAgIHN1YkZpZWxkLnZhbGlkYXRpb24gPSAncmVxdWlyZWQnO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGUgPT09ICdyYWRpbycpIHtcbiAgICAgICAgICBzdWJGaWVsZC5vcHRpb25zID0gY3JlYXRlUmFuZG9tT3B0aW9ucygpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHN1YkZpZWxkVHlwZSA9PT0gJ3RleHRBcmVhJyB8fCB0eXBlID09PSAnaW5wdXQnKSB7XG4gICAgICAgICAgc3ViRmllbGQucGxhY2Vob2xkZXIgPSBjaGFuY2Uud29yZCgpO1xuICAgICAgICB9XG4gICAgICAgIHN1YkZpZWxkc1tjb3VudGluZ10gPSBzdWJGaWVsZDtcbiAgICAgIH1cblxuICAgICAgZmllbGQgPSB7XG4gICAgICAgIG5hbWU6IGNoYW5jZS53b3JkKCksXG4gICAgICAgIHR5cGU6ICdyb3dDb21iaW5hdGlvbicsXG4gICAgICAgIGZpZWxkczogc3ViRmllbGRzLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmllbGQgPSB7XG4gICAgICAgIG5hbWU6IGNoYW5jZS53b3JkKCksXG4gICAgICAgIHR5cGUsXG4gICAgICAgIGlkOiBjaGFuY2Uud29yZCgpLFxuICAgICAgfTtcblxuICAgICAgaWYgKGNoYW5jZS5pbnRlZ2VyKCkgJSAyID09PSAwKSB7XG4gICAgICAgIGZpZWxkLnZhbGlkYXRpb24gPSAncmVxdWlyZWQnO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGUgPT09ICdyYWRpbycpIHtcbiAgICAgICAgZmllbGQub3B0aW9ucyA9IGNyZWF0ZVJhbmRvbU9wdGlvbnMoKTtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlID09PSAndGV4dEFyZWEnIHx8IHR5cGUgPT09ICdpbnB1dCcpIHtcbiAgICAgICAgZmllbGQucGxhY2Vob2xkZXIgPSBjaGFuY2Uud29yZCgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZpZWxkc1tjb3VudGVyXSA9IGZpZWxkO1xuICB9XG4gIGpzb25Gb3JtW25hbWVdID0ge307XG4gIGpzb25Gb3JtW25hbWVdLmRlc2NyaXB0aW9uID0gY2hhbmNlLndvcmQoKTtcbiAganNvbkZvcm1bbmFtZV0uZmllbGRzID0gZmllbGRzO1xuICByZXR1cm4ganNvbkZvcm07XG59O1xuXG5kZXNjcmliZSgnRHluYW1pY0Zvcm0nLCAoKSA9PiB7XG4gIGxldCB3cmFwcGVyO1xuICBjb25zdCBzZXRSZXF1ZXN0ID0gamVzdC5mbigpO1xuICBjb25zdCB0ZXN0SnNvbiA9IGdlbmVyYXRlVGVzdEZvcm1Kc29uKCk7XG4gIGNvbnN0IHJvdXRlID0gamVzdC5mbigpO1xuICBjb25zdCByZW5kZXJDb21wb25lbnQgPSAoKSA9PlxuICAgIHNoYWxsb3coXG4gICAgICA8RHluYW1pY0Zvcm1Db21wb25lbnRcbiAgICAgICAganNvbkZvcm09eygpID0+IHRlc3RKc29ufVxuICAgICAgICBzZXRSZXF1ZXN0PXtzZXRSZXF1ZXN0fVxuICAgICAgICBmb3JtPXtPYmplY3Qua2V5cyh0ZXN0SnNvbilbMF19XG4gICAgICAgIHJvdXRlPXsoKSA9PiB7XG4gICAgICAgICAgcm91dGUoKTtcbiAgICAgICAgfX1cbiAgICAgIC8+LFxuICAgICk7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgd3JhcHBlciA9IHJlbmRlckNvbXBvbmVudCgpO1xuICB9KTtcblxuICBpdCgnaXMgd3JhcHBlZCBpbiBhIFNlZ21lbnQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KHdyYXBwZXIudHlwZSgpKS50b0VxdWFsKFNlZ21lbnQpO1xuICB9KTtcblxuICBpdCgnaXMgc3R5bGVkIGFzIGEgcGFkZGVkIFNlZ21lbnQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KHdyYXBwZXIucHJvcHMoKS5wYWRkZWQpLnRvQmVUcnV0aHkoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2hlYWRlcicsICgpID0+IHtcbiAgICBsZXQgaGVhZGVyO1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBoZWFkZXIgPSB3cmFwcGVyLmNoaWxkQXQoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnaXMgYSBoZWFkZXInLCAoKSA9PiB7XG4gICAgICBleHBlY3QoaGVhZGVyLnR5cGUoKSkudG9FcXVhbChIZWFkZXIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2lzIGhhcyBhbiBhcyBlcXVhbCB0byBoMycsICgpID0+IHtcbiAgICAgIGV4cGVjdChoZWFkZXIucHJvcHMoKS5hcykudG9FcXVhbCgnaDMnKTtcbiAgICB9KTtcblxuICAgIGl0KCdpcyB0aGUgY29ycmVjdCB0ZXh0IGluIHRoZSBoZWFkZXInLCAoKSA9PiB7XG4gICAgICBleHBlY3QoaGVhZGVyLmNoaWxkQXQoMCkuZGVidWcoKSkudG9FcXVhbCh0ZXN0SnNvbltPYmplY3Qua2V5cyh0ZXN0SnNvbilbMF1dLmRlc2NyaXB0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG4gIGRlc2NyaWJlKCdmb3JtIHNlZ21lbnQnLCAoKSA9PiB7XG4gICAgbGV0IGZvcm1TZWdtZW50O1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBmb3JtU2VnbWVudCA9IHdyYXBwZXIuY2hpbGRBdCgxKTtcbiAgICB9KTtcblxuICAgIGl0KCdpcyBhIHNlZ21lbnQnLCAoKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyh0ZXN0SnNvbik7XG4gICAgICBleHBlY3QoZm9ybVNlZ21lbnQudHlwZSgpKS50b0VxdWFsKFNlZ21lbnQpO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2Zvcm0nLCAoKSA9PiB7XG4gICAgICBsZXQgZm9ybUNvbXBvbmVudDtcbiAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICBmb3JtQ29tcG9uZW50ID0gZm9ybVNlZ21lbnQuY2hpbGRBdCgwKTtcbiAgICAgIH0pO1xuICAgICAgaXQoJ2lzIGEgZm9ybScsICgpID0+IHtcbiAgICAgICAgZXhwZWN0KGZvcm1Db21wb25lbnQudHlwZSgpKS50b0VxdWFsKEZvcm0pO1xuICAgICAgfSk7XG5cbiAgICAgIGRlc2NyaWJlKCdmb3JtIGRhdGEnLCAoKSA9PiB7XG4gICAgICAgIGxldCBjb3VudCA9IC0xO1xuICAgICAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgICBjb3VudCArPSAxO1xuICAgICAgICAgIHdyYXBwZXIgPSByZW5kZXJDb21wb25lbnQoKTtcbiAgICAgICAgICBmb3JtU2VnbWVudCA9IHdyYXBwZXIuY2hpbGRBdCgxKTtcbiAgICAgICAgICBmb3JtQ29tcG9uZW50ID0gZm9ybVNlZ21lbnQuY2hpbGRBdCgwKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRlc3RKc29uW09iamVjdC5rZXlzKHRlc3RKc29uKVswXV0uZmllbGRzLmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgICAgICAgaXQoYGZpZWxkICR7Y291bnR9IGlzIGNvcnJlY3RgLCAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoZmllbGQudHlwZSAhPT0gJ3Jvd0NvbWJpbmF0aW9uJykge1xuICAgICAgICAgICAgICBjb25zdCBwcmUgPSBmb3JtQ29tcG9uZW50LmNoaWxkQXQoY291bnQpO1xuICAgICAgICAgICAgICBjb25zdCBsYWJlbCA9IHByZS5jaGlsZEF0KDApO1xuICAgICAgICAgICAgICBpZiAoZmllbGQudmFsaWRhdGlvbikge1xuICAgICAgICAgICAgICAgIGV4cGVjdChsYWJlbC5jaGlsZEF0KDApLnRleHQoKSkudG9FcXVhbChgICogJHtmaWVsZC5uYW1lfWApO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGV4cGVjdChsYWJlbC5jaGlsZEF0KDApLnRleHQoKSkudG9FcXVhbChmaWVsZC5uYW1lKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZXhwZWN0KFxuICAgICAgICAgICAgICB3cmFwcGVyXG4gICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgLnByb3BzKCkubmFtZSA9PT0gZmllbGQubmFtZSxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBpZiAoZmllbGQudHlwZSA9PT0gJ2NoZWNrYm94Jykge1xuICAgICAgICAgICAgICBleHBlY3QoXG4gICAgICAgICAgICAgICAgd3JhcHBlclxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdChjb3VudClcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAudHlwZSgpLFxuICAgICAgICAgICAgICApLnRvRXF1YWwoQ2hlY2tib3gpO1xuICAgICAgICAgICAgICBmYWlsVGVzdCh3cmFwcGVyLCBmaWVsZCwgY291bnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICdyYWRpbycpIHtcbiAgICAgICAgICAgICAgZXhwZWN0KFxuICAgICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLnR5cGUoKSxcbiAgICAgICAgICAgICAgKS50b0VxdWFsKEZvcm0uR3JvdXApO1xuICAgICAgICAgICAgICBmYWlsVGVzdCh3cmFwcGVyLCBmaWVsZCwgY291bnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICd0ZXh0QXJlYScpIHtcbiAgICAgICAgICAgICAgZXhwZWN0KFxuICAgICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLnR5cGUoKSxcbiAgICAgICAgICAgICAgKS50b0VxdWFsKFRleHRBcmVhKTtcbiAgICAgICAgICAgICAgZmFpbFRlc3Qod3JhcHBlciwgZmllbGQsIGNvdW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAnZHJvcERvd24nKSB7XG4gICAgICAgICAgICAgIGV4cGVjdChcbiAgICAgICAgICAgICAgICB3cmFwcGVyXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgIC50eXBlKCksXG4gICAgICAgICAgICAgICkudG9FcXVhbChEcm9wZG93bik7XG4gICAgICAgICAgICAgIGZhaWxUZXN0KHdyYXBwZXIsIGZpZWxkLCBjb3VudCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAncm93Q29tYmluYXRpb24nKSB7XG4gICAgICAgICAgICAgIGxldCBzdWJGaWVsZENvdW50ZXIgPSAwO1xuICAgICAgICAgICAgICBmaWVsZC5maWVsZHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByb3dJbnB1dCA9IHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdChzdWJGaWVsZENvdW50ZXIpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKTtcblxuICAgICAgICAgICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkge1xuICAgICAgICAgICAgICAgICAgY2FzZSAnaW5wdXQnOlxuICAgICAgICAgICAgICAgICAgICBleHBlY3Qocm93SW5wdXQudHlwZSgpKS50b0VxdWFsKEZvcm0uSW5wdXQpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIGNhc2UgJ2Ryb3BEb3duJzpcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KHJvd0lucHV0LnR5cGUoKSkudG9FcXVhbChEcm9wZG93bik7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgY2FzZSAndGV4dEFyZWEnOlxuICAgICAgICAgICAgICAgICAgICBleHBlY3Qocm93SW5wdXQudHlwZSgpKS50b0VxdWFsKFRleHRBcmVhKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICBjYXNlICdjaGVja2JveCc6XG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChyb3dJbnB1dC50eXBlKCkpLnRvRXF1YWwoQ2hlY2tib3gpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIGNhc2UgJ3JhZGlvJzpcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KHJvd0lucHV0LnR5cGUoKSkudG9FcXVhbChDaGVja2JveCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZmFpbFRlc3Qod3JhcHBlciwgZmllbGQsIGNvdW50KTtcbiAgICAgICAgICAgICAgICBzdWJGaWVsZENvdW50ZXIgKz0gMTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAnaW5wdXQnKSB7XG4gICAgICAgICAgICAgIGV4cGVjdChcbiAgICAgICAgICAgICAgICB3cmFwcGVyXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgIC50eXBlKCksXG4gICAgICAgICAgICAgICkudG9FcXVhbChGb3JtLklucHV0KTtcblxuICAgICAgICAgICAgICBmYWlsVGVzdCh3cmFwcGVyLCBmaWVsZCwgY291bnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBkZXNjcmliZSgnRm9ybSBCdXR0b24nLCAoKSA9PiB7XG4gICAgICAgIGxldCBmb3JtQnV0dG9uO1xuXG4gICAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICAgIGZvcm1CdXR0b24gPSBmb3JtQ29tcG9uZW50LmNoaWxkQXQobnVtYmVyT2ZGaWVsZHMpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnSXQgaXMgYSBidXR0b24nLCAoKSA9PiB7XG4gICAgICAgICAgZXhwZWN0KGZvcm1CdXR0b24udHlwZSgpKS50b0VxdWFsKEZvcm0uQnV0dG9uKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==