7efc52374d0dbdaede1b6dc000e1b611
'use strict';

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _semanticUiReact = require('semantic-ui-react');

var _enzyme = require('enzyme');

var _chance = require('chance');

var _DynamicForm = require('../../../src/components/helpers/DynamicForm');

var _DynamicForm2 = _interopRequireDefault(_DynamicForm);

var _InlineError = require('../../../src/components/helpers/InlineError');

var _InlineError2 = _interopRequireDefault(_InlineError);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var chance = new _chance.Chance();

var numberOfFields = Math.abs(chance.integer()) % 11 + 1;

var randomType = function randomType(useRowCombination) {
  switch (chance.integer() % 5) {
    case 0:
      return 'textArea';
    case 1:
      return 'radio';
    case 2:
      return 'checkbox';
    case 3:
      return 'input';
    case 4:
      if (useRowCombination) {
        return 'rowCombination';
      }
      return 'input';
    default:
      return 'textArea';
  }
};

var failTest = function failTest(wrapper, field, count) {
  if (chance.integer() % 2) {
    var state = { errors: {} };
    state.errors[field.id] = 'Nothing is Selected';
    wrapper.setState(state);
    wrapper.update();
    expect(wrapper.childAt(1).childAt(0).childAt(count).find(_InlineError2.default).props().text).toEqual('Nothing is Selected');
  }
};

var createRandomOptions = function createRandomOptions() {
  var options = [];
  var numberOfOptions = chance.integer() % 11 + 1;
  for (var counter = 0; counter < numberOfOptions; counter += 1) {
    options[counter] = chance.word();
  }
  return options;
};

var generateTestFormJson = function generateTestFormJson() {
  var name = chance.word();
  var jsonForm = {};
  var fields = [];
  for (var counter = 0; counter < numberOfFields; counter += 1) {
    var type = randomType(true);

    var field = {};
    if (type === 'rowCombination') {
      var numberOfSubFields = chance.integer() % 11 + 1;
      var subFields = [];
      for (var counting = 0; counting < numberOfSubFields; counting += 1) {
        var subFieldType = randomType(false);
        var subField = {
          name: chance.word(),
          type: subFieldType,
          id: chance.word()
        };

        if (chance.integer() % 2 === 0) {
          subField.validation = 'required';
        }

        if (type === 'radio') {
          subField.options = createRandomOptions();
        }

        if (subFieldType === 'textArea' || type === 'input') {
          subField.placeholder = chance.word();
        }

        subFields[counting] = subField;
      }

      field = {
        name: chance.word(),
        type: 'rowCombination',
        fields: subFields
      };
    } else {
      field = {
        name: chance.word(),
        type: type,
        id: chance.word()
      };

      if (chance.integer() % 2 === 0) {
        field.validation = 'required';
      }
      if (type === 'radio') {
        field.options = createRandomOptions();
      }
      if (type === 'textArea' || type === 'input') {
        field.placeholder = chance.word();
      }
    }

    fields[counter] = field;
  }
  jsonForm[name] = {};
  jsonForm[name].description = chance.word();
  jsonForm[name].fields = fields;
  return jsonForm;
};

describe('DynamicForm', function () {
  var wrapper = void 0;
  var setRequest = jest.fn();
  var testJson = generateTestFormJson();
  var _route = jest.fn();
  var renderComponent = function renderComponent() {
    return (0, _enzyme.shallow)(_react2.default.createElement(_DynamicForm2.default, {
      jsonForm: function jsonForm() {
        return testJson;
      },
      setRequest: setRequest,
      form: Object.keys(testJson)[0],
      route: function route() {
        _route();
      }
    }));
  };

  beforeEach(function () {
    wrapper = renderComponent();
  });

  it('is wrapped in a Segment', function () {
    expect(wrapper.type()).toEqual(_semanticUiReact.Segment);
  });

  it('is styled as a padded Segment', function () {
    expect(wrapper.props().padded).toBeTruthy();
  });

  describe('header', function () {
    var header = void 0;

    beforeEach(function () {
      header = wrapper.childAt(0);
    });

    it('is a header', function () {
      expect(header.type()).toEqual(_semanticUiReact.Header);
    });

    it('is has an as equal to h3', function () {
      expect(header.props().as).toEqual('h3');
    });

    it('is the correct text in the header', function () {
      expect(header.childAt(0).debug()).toEqual(testJson[Object.keys(testJson)[0]].description);
    });
  });
  describe('form segment', function () {
    var formSegment = void 0;

    beforeEach(function () {
      formSegment = wrapper.childAt(1);
    });

    it('is a segment', function () {
      expect(formSegment.type()).toEqual(_semanticUiReact.Segment);
    });

    describe('form', function () {
      var formComponent = void 0;
      beforeEach(function () {
        formComponent = formSegment.childAt(0);
      });
      it('is a form', function () {
        expect(formComponent.type()).toEqual(_semanticUiReact.Form);
      });

      describe('form data', function () {
        wrapper = renderComponent();
        formSegment = wrapper.childAt(1);
        formComponent = formSegment.childAt(0);
        console.log(formComponent.debug());
        var count = 0;
        testJson[Object.keys(testJson)[0]].fields.forEach(function (field) {
          if (field.validation) {
            it('field ' + count + ' is correct', function () {
              var label = formComponent.childAt(count).childAt(0);
              console.log(formComponent.childAt(0).debug());
              console.log(count);
              console.log(label.debug());
              if (field.validation) {
                expect(label.text()).toEqual(' * ' + field.name);
              } else {
                expect(label.text()).toEqual(field.name);
              }
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).props().name === field.name);
              if (field.type === 'checkbox') {
                expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Checkbox);
              }
              if (field.type === 'radio') {
                expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Radio);
                failTest(wrapper, field, count);
              }
              if (field.type === 'textArea') {
                expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.TextArea);
                failTest(wrapper, field, count);
              }
              if (field.type === 'dropDown') {
                expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Dropdown);
                failTest(wrapper, field, count);
              }

              if (field.type === 'rowCombination') {
                expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Form.Group);

                var subFieldCounter = 0;
                field.fields.forEach(function (input) {
                  var rowInput = wrapper.childAt(1).childAt(0).childAt(count).childAt(1).childAt(subFieldCounter);

                  switch (input.type) {
                    case 'input':
                      expect(rowInput.type()).toEqual(_semanticUiReact.Input);
                      break;
                    case 'dropDown':
                      expect(rowInput.type()).toEqual(_semanticUiReact.Dropdown);
                      break;
                    case 'textArea':
                      expect(rowInput.type()).toEqual(_semanticUiReact.TextArea);
                      break;
                    case 'checkbox':
                      expect(rowInput.type()).toEqual(_semanticUiReact.Checkbox);
                      break;
                    case 'radio':
                      expect(rowInput.type()).toEqual(_semanticUiReact.Checkbox);
                      break;
                    default:
                  }
                  failTest(wrapper, field, count);
                  subFieldCounter += 1;
                });
              }

              if (field.type === 'input') {
                expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Input);

                failTest(wrapper, field, count);
              }
            });
          }
          count += 1;
        });
      });

      describe('Form Button', function () {
        var formButton = void 0;

        beforeEach(function () {
          formButton = formComponent.childAt(numberOfFields);
        });

        it('It is a button', function () {
          expect(formButton.type()).toEqual(_semanticUiReact.Form.Button);
        });
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkR5bmFtaWNGb3JtLnNwZWMuanMiXSwibmFtZXMiOlsiY2hhbmNlIiwiQ2hhbmNlIiwibnVtYmVyT2ZGaWVsZHMiLCJNYXRoIiwiYWJzIiwiaW50ZWdlciIsInJhbmRvbVR5cGUiLCJ1c2VSb3dDb21iaW5hdGlvbiIsImZhaWxUZXN0Iiwid3JhcHBlciIsImZpZWxkIiwiY291bnQiLCJzdGF0ZSIsImVycm9ycyIsImlkIiwic2V0U3RhdGUiLCJ1cGRhdGUiLCJleHBlY3QiLCJjaGlsZEF0IiwiZmluZCIsIklubGluZUVycm9yQ29tcG9uZW50IiwicHJvcHMiLCJ0ZXh0IiwidG9FcXVhbCIsImNyZWF0ZVJhbmRvbU9wdGlvbnMiLCJvcHRpb25zIiwibnVtYmVyT2ZPcHRpb25zIiwiY291bnRlciIsIndvcmQiLCJnZW5lcmF0ZVRlc3RGb3JtSnNvbiIsIm5hbWUiLCJqc29uRm9ybSIsImZpZWxkcyIsInR5cGUiLCJudW1iZXJPZlN1YkZpZWxkcyIsInN1YkZpZWxkcyIsImNvdW50aW5nIiwic3ViRmllbGRUeXBlIiwic3ViRmllbGQiLCJ2YWxpZGF0aW9uIiwicGxhY2Vob2xkZXIiLCJkZXNjcmlwdGlvbiIsImRlc2NyaWJlIiwic2V0UmVxdWVzdCIsImplc3QiLCJmbiIsInRlc3RKc29uIiwicm91dGUiLCJyZW5kZXJDb21wb25lbnQiLCJPYmplY3QiLCJrZXlzIiwiYmVmb3JlRWFjaCIsIml0IiwiU2VnbWVudCIsInBhZGRlZCIsInRvQmVUcnV0aHkiLCJoZWFkZXIiLCJIZWFkZXIiLCJhcyIsImRlYnVnIiwiZm9ybVNlZ21lbnQiLCJmb3JtQ29tcG9uZW50IiwiRm9ybSIsImNvbnNvbGUiLCJsb2ciLCJmb3JFYWNoIiwibGFiZWwiLCJDaGVja2JveCIsIlJhZGlvIiwiVGV4dEFyZWEiLCJEcm9wZG93biIsIkdyb3VwIiwic3ViRmllbGRDb3VudGVyIiwiaW5wdXQiLCJyb3dJbnB1dCIsIklucHV0IiwiZm9ybUJ1dHRvbiIsIkJ1dHRvbiJdLCJtYXBwaW5n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a0MsbUJBQUo7O0FBRUF6QixtQkFBVyxZQUFNO0FBQ2Z5Qix1QkFBYWYsY0FBYzNDLE9BQWQsQ0FBc0JoQixjQUF0QixDQUFiO0FBQ0QsU0FGRDs7QUFJQWtELFdBQUcsZ0JBQUgsRUFBcUIsWUFBTTtBQUN6Qm5DLGlCQUFPMkQsV0FBVzNDLElBQVgsRUFBUCxFQUEwQlYsT0FBMUIsQ0FBa0N1QyxzQkFBS2UsTUFBdkM7QUFDRCxTQUZEO0FBR0QsT0FWRDtBQVdELEtBdEpEO0FBdUpELEdBbEtEO0FBbUtELENBbk5EIiwiZmlsZSI6IkR5bmFtaWNGb3JtLnNwZWMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtcbiAgQnV0dG9uLFxuICBGb3JtLFxuICBTZWdtZW50LFxuICBIZWFkZXIsXG4gIFJhZGlvLFxuICBDaGVja2JveCxcbiAgVGV4dEFyZWEsXG4gIERyb3Bkb3duLFxuICBJbnB1dCxcbn0gZnJvbSAnc2VtYW50aWMtdWktcmVhY3QnO1xuaW1wb3J0IHsgc2hhbGxvdyB9IGZyb20gJ2VuenltZSc7XG5pbXBvcnQgeyBDaGFuY2UgfSBmcm9tICdjaGFuY2UnO1xuaW1wb3J0IER5bmFtaWNGb3JtQ29tcG9uZW50IGZyb20gJy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL2hlbHBlcnMvRHluYW1pY0Zvcm0nO1xuaW1wb3J0IElubGluZUVycm9yQ29tcG9uZW50IGZyb20gJy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL2hlbHBlcnMvSW5saW5lRXJyb3InO1xuXG5jb25zdCBjaGFuY2UgPSBuZXcgQ2hhbmNlKCk7XG5cbmNvbnN0IG51bWJlck9mRmllbGRzID0gKE1hdGguYWJzKGNoYW5jZS5pbnRlZ2VyKCkpICUgMTEpICsgMTtcblxuY29uc3QgcmFuZG9tVHlwZSA9ICh1c2VSb3dDb21iaW5hdGlvbikgPT4ge1xuICBzd2l0Y2ggKGNoYW5jZS5pbnRlZ2VyKCkgJSA1KSB7XG4gICAgY2FzZSAwOlxuICAgICAgcmV0dXJuICd0ZXh0QXJlYSc7XG4gICAgY2FzZSAxOlxuICAgICAgcmV0dXJuICdyYWRpbyc7XG4gICAgY2FzZSAyOlxuICAgICAgcmV0dXJuICdjaGVja2JveCc7XG4gICAgY2FzZSAzOlxuICAgICAgcmV0dXJuICdpbnB1dCc7XG4gICAgY2FzZSA0OlxuICAgICAgaWYgKHVzZVJvd0NvbWJpbmF0aW9uKSB7XG4gICAgICAgIHJldHVybiAncm93Q29tYmluYXRpb24nO1xuICAgICAgfVxuICAgICAgcmV0dXJuICdpbnB1dCc7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiAndGV4dEFyZWEnO1xuICB9XG59O1xuXG5jb25zdCBmYWlsVGVzdCA9ICh3cmFwcGVyLCBmaWVsZCwgY291bnQpID0+IHtcbiAgaWYgKGNoYW5jZS5pbnRlZ2VyKCkgJSAyKSB7XG4gICAgY29uc3Qgc3RhdGUgPSB7IGVycm9yczoge30gfTtcbiAgICBzdGF0ZS5lcnJvcnNbZmllbGQuaWRdID0gJ05vdGhpbmcgaXMgU2VsZWN0ZWQnO1xuICAgIHdyYXBwZXIuc2V0U3RhdGUoc3RhdGUpO1xuICAgIHdyYXBwZXIudXBkYXRlKCk7XG4gICAgZXhwZWN0KFxuICAgICAgd3JhcHBlclxuICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAuY2hpbGRBdChjb3VudClcbiAgICAgICAgLmZpbmQoSW5saW5lRXJyb3JDb21wb25lbnQpXG4gICAgICAgIC5wcm9wcygpLnRleHQsXG4gICAgKS50b0VxdWFsKCdOb3RoaW5nIGlzIFNlbGVjdGVkJyk7XG4gIH1cbn07XG5cbmNvbnN0IGNyZWF0ZVJhbmRvbU9wdGlvbnMgPSAoKSA9PiB7XG4gIGNvbnN0IG9wdGlvbnMgPSBbXTtcbiAgY29uc3QgbnVtYmVyT2ZPcHRpb25zID0gKGNoYW5jZS5pbnRlZ2VyKCkgJSAxMSkgKyAxO1xuICBmb3IgKGxldCBjb3VudGVyID0gMDsgY291bnRlciA8IG51bWJlck9mT3B0aW9uczsgY291bnRlciArPSAxKSB7XG4gICAgb3B0aW9uc1tjb3VudGVyXSA9IGNoYW5jZS53b3JkKCk7XG4gIH1cbiAgcmV0dXJuIG9wdGlvbnM7XG59O1xuXG5jb25zdCBnZW5lcmF0ZVRlc3RGb3JtSnNvbiA9ICgpID0+IHtcbiAgY29uc3QgbmFtZSA9IGNoYW5jZS53b3JkKCk7XG4gIGNvbnN0IGpzb25Gb3JtID0ge307XG4gIGNvbnN0IGZpZWxkcyA9IFtdO1xuICBmb3IgKGxldCBjb3VudGVyID0gMDsgY291bnRlciA8IG51bWJlck9mRmllbGRzOyBjb3VudGVyICs9IDEpIHtcbiAgICBjb25zdCB0eXBlID0gcmFuZG9tVHlwZSh0cnVlKTtcblxuICAgIGxldCBmaWVsZCA9IHt9O1xuICAgIGlmICh0eXBlID09PSAncm93Q29tYmluYXRpb24nKSB7XG4gICAgICBjb25zdCBudW1iZXJPZlN1YkZpZWxkcyA9IChjaGFuY2UuaW50ZWdlcigpICUgMTEpICsgMTtcbiAgICAgIGNvbnN0IHN1YkZpZWxkcyA9IFtdO1xuICAgICAgZm9yIChsZXQgY291bnRpbmcgPSAwOyBjb3VudGluZyA8IG51bWJlck9mU3ViRmllbGRzOyBjb3VudGluZyArPSAxKSB7XG4gICAgICAgIGNvbnN0IHN1YkZpZWxkVHlwZSA9IHJhbmRvbVR5cGUoZmFsc2UpO1xuICAgICAgICBjb25zdCBzdWJGaWVsZCA9IHtcbiAgICAgICAgICBuYW1lOiBjaGFuY2Uud29yZCgpLFxuICAgICAgICAgIHR5cGU6IHN1YkZpZWxkVHlwZSxcbiAgICAgICAgICBpZDogY2hhbmNlLndvcmQoKSxcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAoY2hhbmNlLmludGVnZXIoKSAlIDIgPT09IDApIHtcbiAgICAgICAgICBzdWJGaWVsZC52YWxpZGF0aW9uID0gJ3JlcXVpcmVkJztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0eXBlID09PSAncmFkaW8nKSB7XG4gICAgICAgICAgc3ViRmllbGQub3B0aW9ucyA9IGNyZWF0ZVJhbmRvbU9wdGlvbnMoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzdWJGaWVsZFR5cGUgPT09ICd0ZXh0QXJlYScgfHwgdHlwZSA9PT0gJ2lucHV0Jykge1xuICAgICAgICAgIHN1YkZpZWxkLnBsYWNlaG9sZGVyID0gY2hhbmNlLndvcmQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHN1YkZpZWxkc1tjb3VudGluZ10gPSBzdWJGaWVsZDtcbiAgICAgIH1cblxuICAgICAgZmllbGQgPSB7XG4gICAgICAgIG5hbWU6IGNoYW5jZS53b3JkKCksXG4gICAgICAgIHR5cGU6ICdyb3dDb21iaW5hdGlvbicsXG4gICAgICAgIGZpZWxkczogc3ViRmllbGRzLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmllbGQgPSB7XG4gICAgICAgIG5hbWU6IGNoYW5jZS53b3JkKCksXG4gICAgICAgIHR5cGUsXG4gICAgICAgIGlkOiBjaGFuY2Uud29yZCgpLFxuICAgICAgfTtcblxuICAgICAgaWYgKGNoYW5jZS5pbnRlZ2VyKCkgJSAyID09PSAwKSB7XG4gICAgICAgIGZpZWxkLnZhbGlkYXRpb24gPSAncmVxdWlyZWQnO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGUgPT09ICdyYWRpbycpIHtcbiAgICAgICAgZmllbGQub3B0aW9ucyA9IGNyZWF0ZVJhbmRvbU9wdGlvbnMoKTtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlID09PSAndGV4dEFyZWEnIHx8IHR5cGUgPT09ICdpbnB1dCcpIHtcbiAgICAgICAgZmllbGQucGxhY2Vob2xkZXIgPSBjaGFuY2Uud29yZCgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZpZWxkc1tjb3VudGVyXSA9IGZpZWxkO1xuICB9XG4gIGpzb25Gb3JtW25hbWVdID0ge307XG4gIGpzb25Gb3JtW25hbWVdLmRlc2NyaXB0aW9uID0gY2hhbmNlLndvcmQoKTtcbiAganNvbkZvcm1bbmFtZV0uZmllbGRzID0gZmllbGRzO1xuICByZXR1cm4ganNvbkZvcm07XG59O1xuXG5kZXNjcmliZSgnRHluYW1pY0Zvcm0nLCAoKSA9PiB7XG4gIGxldCB3cmFwcGVyO1xuICBjb25zdCBzZXRSZXF1ZXN0ID0gamVzdC5mbigpO1xuICBjb25zdCB0ZXN0SnNvbiA9IGdlbmVyYXRlVGVzdEZvcm1Kc29uKCk7XG4gIGNvbnN0IHJvdXRlID0gamVzdC5mbigpO1xuICBjb25zdCByZW5kZXJDb21wb25lbnQgPSAoKSA9PlxuICAgIHNoYWxsb3coXG4gICAgICA8RHluYW1pY0Zvcm1Db21wb25lbnRcbiAgICAgICAganNvbkZvcm09eygpID0+IHRlc3RKc29ufVxuICAgICAgICBzZXRSZXF1ZXN0PXtzZXRSZXF1ZXN0fVxuICAgICAgICBmb3JtPXtPYmplY3Qua2V5cyh0ZXN0SnNvbilbMF19XG4gICAgICAgIHJvdXRlPXsoKSA9PiB7XG4gICAgICAgICAgcm91dGUoKTtcbiAgICAgICAgfX1cbiAgICAgIC8+LFxuICAgICk7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgd3JhcHBlciA9IHJlbmRlckNvbXBvbmVudCgpO1xuICB9KTtcblxuICBpdCgnaXMgd3JhcHBlZCBpbiBhIFNlZ21lbnQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KHdyYXBwZXIudHlwZSgpKS50b0VxdWFsKFNlZ21lbnQpO1xuICB9KTtcblxuICBpdCgnaXMgc3R5bGVkIGFzIGEgcGFkZGVkIFNlZ21lbnQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KHdyYXBwZXIucHJvcHMoKS5wYWRkZWQpLnRvQmVUcnV0aHkoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2hlYWRlcicsICgpID0+IHtcbiAgICBsZXQgaGVhZGVyO1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBoZWFkZXIgPSB3cmFwcGVyLmNoaWxkQXQoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnaXMgYSBoZWFkZXInLCAoKSA9PiB7XG4gICAgICBleHBlY3QoaGVhZGVyLnR5cGUoKSkudG9FcXVhbChIZWFkZXIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2lzIGhhcyBhbiBhcyBlcXVhbCB0byBoMycsICgpID0+IHtcbiAgICAgIGV4cGVjdChoZWFkZXIucHJvcHMoKS5hcykudG9FcXVhbCgnaDMnKTtcbiAgICB9KTtcblxuICAgIGl0KCdpcyB0aGUgY29ycmVjdCB0ZXh0IGluIHRoZSBoZWFkZXInLCAoKSA9PiB7XG4gICAgICBleHBlY3QoaGVhZGVyLmNoaWxkQXQoMCkuZGVidWcoKSkudG9FcXVhbCh0ZXN0SnNvbltPYmplY3Qua2V5cyh0ZXN0SnNvbilbMF1dLmRlc2NyaXB0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG4gIGRlc2NyaWJlKCdmb3JtIHNlZ21lbnQnLCAoKSA9PiB7XG4gICAgbGV0IGZvcm1TZWdtZW50O1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBmb3JtU2VnbWVudCA9IHdyYXBwZXIuY2hpbGRBdCgxKTtcbiAgICB9KTtcblxuICAgIGl0KCdpcyBhIHNlZ21lbnQnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoZm9ybVNlZ21lbnQudHlwZSgpKS50b0VxdWFsKFNlZ21lbnQpO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2Zvcm0nLCAoKSA9PiB7XG4gICAgICBsZXQgZm9ybUNvbXBvbmVudDtcbiAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICBmb3JtQ29tcG9uZW50ID0gZm9ybVNlZ21lbnQuY2hpbGRBdCgwKTtcbiAgICAgIH0pO1xuICAgICAgaXQoJ2lzIGEgZm9ybScsICgpID0+IHtcbiAgICAgICAgZXhwZWN0KGZvcm1Db21wb25lbnQudHlwZSgpKS50b0VxdWFsKEZvcm0pO1xuICAgICAgfSk7XG5cbiAgICAgIGRlc2NyaWJlKCdmb3JtIGRhdGEnLCAoKSA9PiB7XG4gICAgICAgIHdyYXBwZXIgPSByZW5kZXJDb21wb25lbnQoKTtcbiAgICAgICAgZm9ybVNlZ21lbnQgPSB3cmFwcGVyLmNoaWxkQXQoMSk7XG4gICAgICAgIGZvcm1Db21wb25lbnQgPSBmb3JtU2VnbWVudC5jaGlsZEF0KDApO1xuICAgICAgICBjb25zb2xlLmxvZyhmb3JtQ29tcG9uZW50LmRlYnVnKCkpO1xuICAgICAgICBsZXQgY291bnQgPSAwO1xuICAgICAgICB0ZXN0SnNvbltPYmplY3Qua2V5cyh0ZXN0SnNvbilbMF1dLmZpZWxkcy5mb3JFYWNoKChmaWVsZCkgPT4ge1xuICAgICAgICAgIGlmIChmaWVsZC52YWxpZGF0aW9uKSB7XG4gICAgICAgICAgICBpdChgZmllbGQgJHtjb3VudH0gaXMgY29ycmVjdGAsICgpID0+IHtcbiAgICAgICAgICAgICAgY29uc3QgbGFiZWwgPSBmb3JtQ29tcG9uZW50LmNoaWxkQXQoY291bnQpLmNoaWxkQXQoMCk7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKGZvcm1Db21wb25lbnQuY2hpbGRBdCgwKS5kZWJ1ZygpKTtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coY291bnQpO1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhsYWJlbC5kZWJ1ZygpKTtcbiAgICAgICAgICAgICAgaWYgKGZpZWxkLnZhbGlkYXRpb24pIHtcbiAgICAgICAgICAgICAgICBleHBlY3QobGFiZWwudGV4dCgpKS50b0VxdWFsKGAgKiAke2ZpZWxkLm5hbWV9YCk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGxhYmVsLnRleHQoKSkudG9FcXVhbChmaWVsZC5uYW1lKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBleHBlY3QoXG4gICAgICAgICAgICAgICAgd3JhcHBlclxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdChjb3VudClcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAucHJvcHMoKS5uYW1lID09PSBmaWVsZC5uYW1lLFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICBpZiAoZmllbGQudHlwZSA9PT0gJ2NoZWNrYm94Jykge1xuICAgICAgICAgICAgICAgIGV4cGVjdChcbiAgICAgICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAgIC50eXBlKCksXG4gICAgICAgICAgICAgICAgKS50b0VxdWFsKENoZWNrYm94KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAoZmllbGQudHlwZSA9PT0gJ3JhZGlvJykge1xuICAgICAgICAgICAgICAgIGV4cGVjdChcbiAgICAgICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAgIC50eXBlKCksXG4gICAgICAgICAgICAgICAgKS50b0VxdWFsKFJhZGlvKTtcbiAgICAgICAgICAgICAgICBmYWlsVGVzdCh3cmFwcGVyLCBmaWVsZCwgY291bnQpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAndGV4dEFyZWEnKSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KFxuICAgICAgICAgICAgICAgICAgd3JhcHBlclxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdChjb3VudClcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLnR5cGUoKSxcbiAgICAgICAgICAgICAgICApLnRvRXF1YWwoVGV4dEFyZWEpO1xuICAgICAgICAgICAgICAgIGZhaWxUZXN0KHdyYXBwZXIsIGZpZWxkLCBjb3VudCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICdkcm9wRG93bicpIHtcbiAgICAgICAgICAgICAgICBleHBlY3QoXG4gICAgICAgICAgICAgICAgICB3cmFwcGVyXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgICAudHlwZSgpLFxuICAgICAgICAgICAgICAgICkudG9FcXVhbChEcm9wZG93bik7XG4gICAgICAgICAgICAgICAgZmFpbFRlc3Qod3JhcHBlciwgZmllbGQsIGNvdW50KTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAncm93Q29tYmluYXRpb24nKSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KFxuICAgICAgICAgICAgICAgICAgd3JhcHBlclxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdChjb3VudClcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLnR5cGUoKSxcbiAgICAgICAgICAgICAgICApLnRvRXF1YWwoRm9ybS5Hcm91cCk7XG5cbiAgICAgICAgICAgICAgICBsZXQgc3ViRmllbGRDb3VudGVyID0gMDtcbiAgICAgICAgICAgICAgICBmaWVsZC5maWVsZHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHJvd0lucHV0ID0gd3JhcHBlclxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdChjb3VudClcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoc3ViRmllbGRDb3VudGVyKTtcblxuICAgICAgICAgICAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2lucHV0JzpcbiAgICAgICAgICAgICAgICAgICAgICBleHBlY3Qocm93SW5wdXQudHlwZSgpKS50b0VxdWFsKElucHV0KTtcbiAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZHJvcERvd24nOlxuICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdChyb3dJbnB1dC50eXBlKCkpLnRvRXF1YWwoRHJvcGRvd24pO1xuICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICd0ZXh0QXJlYSc6XG4gICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KHJvd0lucHV0LnR5cGUoKSkudG9FcXVhbChUZXh0QXJlYSk7XG4gICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NoZWNrYm94JzpcbiAgICAgICAgICAgICAgICAgICAgICBleHBlY3Qocm93SW5wdXQudHlwZSgpKS50b0VxdWFsKENoZWNrYm94KTtcbiAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAncmFkaW8nOlxuICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdChyb3dJbnB1dC50eXBlKCkpLnRvRXF1YWwoQ2hlY2tib3gpO1xuICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZmFpbFRlc3Qod3JhcHBlciwgZmllbGQsIGNvdW50KTtcbiAgICAgICAgICAgICAgICAgIHN1YkZpZWxkQ291bnRlciArPSAxO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICdpbnB1dCcpIHtcbiAgICAgICAgICAgICAgICBleHBlY3QoXG4gICAgICAgICAgICAgICAgICB3cmFwcGVyXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgICAudHlwZSgpLFxuICAgICAgICAgICAgICAgICkudG9FcXVhbChJbnB1dCk7XG5cbiAgICAgICAgICAgICAgICBmYWlsVGVzdCh3cmFwcGVyLCBmaWVsZCwgY291bnQpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY291bnQgKz0gMTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgZGVzY3JpYmUoJ0Zvcm0gQnV0dG9uJywgKCkgPT4ge1xuICAgICAgICBsZXQgZm9ybUJ1dHRvbjtcblxuICAgICAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgICBmb3JtQnV0dG9uID0gZm9ybUNvbXBvbmVudC5jaGlsZEF0KG51bWJlck9mRmllbGRzKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ0l0IGlzIGEgYnV0dG9uJywgKCkgPT4ge1xuICAgICAgICAgIGV4cGVjdChmb3JtQnV0dG9uLnR5cGUoKSkudG9FcXVhbChGb3JtLkJ1dHRvbik7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXX0=