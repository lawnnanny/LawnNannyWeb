b8173ca2c6b8e29b11b613f72245e6dd
'use strict';

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _semanticUiReact = require('semantic-ui-react');

var _enzyme = require('enzyme');

var _chance = require('chance');

var _DynamicForm = require('../../../src/components/helpers/DynamicForm');

var _DynamicForm2 = _interopRequireDefault(_DynamicForm);

var _InlineError = require('../../../src/components/helpers/InlineError');

var _InlineError2 = _interopRequireDefault(_InlineError);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var chance = new _chance.Chance();

var randomType = function randomType(useRowCombination) {
  switch (chance.integer() % 5) {
    case 0:
      return 'textArea';
    case 1:
      return 'radio';
    case 2:
      return 'checkbox';
    case 3:
      return 'input';
    case 4:
      if (useRowCombination) {
        return 'rowCombination';
      }
      return 'input';
    default:
      return 'textArea';
  }
};

var createRandomOptions = function createRandomOptions() {
  var options = [];
  var numberOfOptions = chance.integer() % 11 + 1;
  for (var counter = 0; counter < numberOfOptions; counter += 1) {
    options[counter] = chance.word();
  }
  return options;
};

var generateTestFormJson = function generateTestFormJson() {
  var name = chance.word();
  var jsonForm = {};
  var numberOfFields = chance.integer() % 11 + 1;
  var fields = [];
  for (var counter = 0; counter < numberOfFields; counter += 1) {
    var type = randomType(true);

    var field = {};
    if (type === 'rowCombination') {
      var numberOfSubFields = chance.integer() % 11 + 1;
      var subFields = [];
      for (var count = 0; count < numberOfSubFields; count += 1) {
        var subFieldType = randomType(false);
        var subField = {
          name: chance.word(),
          type: subFieldType,
          id: chance.word()
        };

        if (chance.integer() % 2 === 0) {
          subField.validation = 'required';
        }

        if (type === 'radio') {
          subField.options = createRandomOptions();
        }

        if (subFieldType === 'textArea' || type === 'input') {
          subField.placeholder = chance.word();
        }

        subFields[count] = subField;
      }

      field = {
        name: chance.word(),
        type: 'rowCombination',
        fields: subFields
      };
    } else {
      field = {
        name: chance.word(),
        type: type,
        id: chance.word()
      };

      if (chance.integer() % 2 === 0) {
        field.validation = 'required';
      }
      if (type === 'radio') {
        field.options = createRandomOptions();
      }
      if (type === 'textArea' || type === 'input') {
        field.placeholder = chance.word();
      }
    }

    fields[counter] = field;
  }
  jsonForm[name] = {};
  jsonForm[name].fields = fields;
  return jsonForm;
};

describe('DynamicForm', function () {
  var wrapper = void 0;
  var setRequest = jest.fn();
  var testJson = generateTestFormJson();
  var _route = jest.fn();
  var renderComponent = function renderComponent() {
    return (0, _enzyme.shallow)(_react2.default.createElement(_DynamicForm2.default, {
      jsonForm: function jsonForm() {
        return testJson;
      },
      setRequest: setRequest,
      form: Object.keys(testJson)[0],
      route: function route() {
        _route();
      }
    }));
  };

  beforeEach(function () {
    wrapper = renderComponent();
  });

  it('is wrapped in a Segment', function () {
    expect(wrapper.type()).toEqual(_semanticUiReact.Segment);
  });

  it('is styled as a padded Segment', function () {
    expect(wrapper.props().padded).toBeTruthy();
  });

  describe('header', function () {
    var header = void 0;

    beforeEach(function () {
      header = wrapper.childAt(0);
    });

    it('is a header', function () {
      expect(header.type()).toEqual(_semanticUiReact.Header);
    });

    it('is has a large size', function () {
      expect(header.props().size).toEqual('large');
    });

    it('is the correct text in the header', function () {
      expect(header.childAt(0).debug()).toEqual(Object.keys(testJson)[0]);
    });
  });

  describe('form', function () {
    it('is a form', function () {
      expect(wrapper.childAt(1).type()).toEqual(_semanticUiReact.Form);
    });

    describe('form data', function () {
      wrapper = renderComponent();
      testJson[Object.keys(testJson)[0]].fields.forEach(function (field) {
        if (field.validation) {
          var fail = chance.integer() % 2;
          var count = 0;
          var form = wrapper.childAt(1);
          var segmentOfFields = form.childAt(0);
          it('field ' + count + ' is correct', function () {
            var label = segmentOfFields.childAt(count).childAt(0);
            if (field.validation) {
              expect(label.text()).toEqual(' * ' + field.name);
            } else {
              expect(label.text()).toEqual(field.name);
            }
            expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).props().name === field.name);
            if (field.type === 'checkbox') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Checkbox);
            }
            if (field.type === 'radio') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Radio);

              if (fail) {
                var state = { errors: {} };
                state.errors[field.id] = 'Radio Button Not Selected';
                wrapper.setState(state);
                wrapper.update();
                expect(wrapper.childAt(1).childAt(0).childAt(count).find(_InlineError2.default).props().text).toEqual('Radio Button Not Selected');
              }
            }
            if (field.type === 'textArea') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.TextArea);

              if (fail) {
                var _state = { errors: {} };
                _state.errors[field.id] = 'Empty Text Box';
                wrapper.setState(_state);
                wrapper.update();
                expect(wrapper.childAt(1).childAt(0).childAt(count).find(_InlineError2.default).props().text).toEqual('Empty Text Box');
              }
            }
            if (field.type === 'dropDown') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Dropdown);

              if (fail) {
                var _state2 = { errors: {} };
                _state2.errors[field.id] = 'Nothing is Selected';
                wrapper.setState(_state2);
                wrapper.update();
                expect(wrapper.childAt(1).childAt(0).childAt(count).find(_InlineError2.default).props().text).toEqual('Nothing is Selected');
              }
            }

            if (field.type === 'rowCombination') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Form.Group);

              var subFieldCounter = 0;
              field.fields.forEach(function (input) {
                var rowInput = wrapper.childAt(1).childAt(0).childAt(count).childAt(1).childAt(subFieldCounter);

                switch (input.type) {
                  case 'input':
                    expect(rowInput.type()).toEqual(_semanticUiReact.Input);
                    break;
                  case 'dropDown':
                    expect(rowInput.type()).toEqual(_semanticUiReact.Dropdown);
                    break;
                  case 'textArea':
                    expect(rowInput.type()).toEqual(_semanticUiReact.TextArea);
                    break;
                  case 'checkbox':
                    expect(rowInput.type()).toEqual(_semanticUiReact.Checkbox);
                    break;
                  case 'radio':
                    expect(rowInput.type()).toEqual(_semanticUiReact.Checkbox);
                    break;
                  default:
                }
                if (fail) {
                  var _state3 = { errors: {} };
                  _state3.errors[field.id] = 'Nothing is Selected';
                  wrapper.setState(_state3);
                  wrapper.update();
                  expect(wrapper.childAt(1).childAt(0).childAt(count).find(_InlineError2.default).props().text).toEqual('Nothing is Selected');
                }
                subFieldCounter += 1;
              });
            }

            if (field.type === 'input') {
              expect(wrapper.childAt(1).childAt(0).childAt(count).childAt(1).type()).toEqual(_semanticUiReact.Input);

              if (fail) {
                var _state4 = { errors: {} };
                _state4.errors[field.id] = 'Empty Input';
                wrapper.setState(_state4);
                wrapper.update();
                expect(wrapper.childAt(1).childAt(0).childAt(count).find(_InlineError2.default).props().text).toEqual('Empty Input');
              }
            }
            count += 1;
          });
        }
      });
    });
  });

  describe('Submit Button', function () {
    var submitSegment = void 0;

    beforeEach(function () {
      submitSegment = wrapper.childAt(1).childAt(1);
    });

    it('It is a segment', function () {
      expect(submitSegment.type()).toEqual(_semanticUiReact.Segment);
    });

    it('There is a button in the segment', function () {
      var button = submitSegment.childAt(0);
      expect(button.type()).toEqual(_semanticUiReact.Button);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkR5bmFtaWNGb3JtLnNwZWMuanMiXSwibmFtZXMiOlsiY2hhbmNlIiwiQ2hhbmNlIiwicmFuZG9tVHlwZSIsInVzZVJvd0NvbWJpbmF0aW9uIiwiaW50ZWdlciIsImNyZWF0ZVJhbmRvbU9wdGlvbnMiLCJvcHRpb25zIiwibnVtYmVyT2ZPcHRpb25zIiwiY291bnRlciIsIndvcmQiLCJnZW5lcmF0ZVRlc3RGb3JtSnNvbiIsIm5hbWUiLCJqc29uRm9ybSIsIm51bWJlck9mRmllbGRzIiwiZmllbGRzIiwidHlwZSIsImZpZWxkIiwibnVtYmVyT2ZTdWJGaWVsZHMiLCJzdWJGaWVsZHMiLCJjb3VudCIsInN1YkZpZWxkVHlwZSIsInN1YkZpZWxkIiwiaWQiLCJ2YWxpZGF0aW9uIiwicGxhY2Vob2xkZXIiLCJkZXNjcmliZSIsIndyYXBwZXIiLCJzZXRSZXF1ZXN0IiwiamVzdCIsImZuIiwidGVzdEpzb24iLCJyb3V0ZSIsInJlbmRlckNvbXBvbmVudCIsIk9iamVjdCIsImtleXMiLCJiZWZvcmVFYWNoIiwiaXQiLCJleHBlY3QiLCJ0b0VxdWFsIiwiU2VnbWVudCIsInByb3BzIiwicGFkZGVkIiwidG9CZVRydXRoeSIsImhlYWRlciIsImNoaWxkQXQiLCJIZWFkZXIiLCJzaXplIiwiZGVidWciLCJGb3JtIiwiZm9yRWFjaCIsImZhaWwiLCJmb3JtIiwic2VnbWVudE9mRmllbGRzIiwibGFiZWwiLCJ0ZXh0IiwiQ2hlY2tib3giLCJSYWRpbyIsInN0YXRlIiwiZXJyb3JzIiwic2V0U3RhdGUiLCJ1cGRhdGUiLCJmaW5kIiwiSW5saW5lRXJyb3JDb21wb25lbnQiLCJUZXh0QXJlYSIsIkRyb3Bkb3duIiwiR3JvdXAiLCJzdWJGaWVsZENvdW50ZXIiLCJpbnB1dCIsInJvd0lucHV0IiwiSW5wdXQiLCJzdWJtaXRTZWdtZW50IiwiYnV0dG9uIiwiQnV0dG9uIl0sIm1hcHBpbmdzIjoiOztBQUFBOzs7O0FBQ0E7O0FBV0E7O0FBQ0E7O0FBQ0E7Ozs7QUFDQTs7Ozs7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TU8sVUFBUSxFQUFFQyxRQUFRLEVBQVYsRUFBZDtBQUNBRCx3QkFBTUMsTUFBTixDQUFhMUMsTUFBTU0sRUFBbkIsSUFBeUIsYUFBekI7QUFDQUksd0JBQVFpQyxRQUFSLENBQWlCRixPQUFqQjtBQUNBL0Isd0JBQVFrQyxNQUFSO0FBQ0F2Qix1QkFDRVgsUUFDR2tCLE9BREgsQ0FDVyxDQURYLEVBRUdBLE9BRkgsQ0FFVyxDQUZYLEVBR0dBLE9BSEgsQ0FHV3pCLEtBSFgsRUFJRzBDLElBSkgsQ0FJUUMscUJBSlIsRUFLR3RCLEtBTEgsR0FLV2MsSUFOYixFQU9FaEIsT0FQRixDQU9VLGFBUFY7QUFRRDtBQUNGO0FBQ0RuQixxQkFBUyxDQUFUO0FBQ0QsV0F0TEQ7QUF1TEQ7QUFDRixPQTlMRDtBQStMRCxLQWpNRDtBQWtNRCxHQXZNRDs7QUF5TUFNLFdBQVMsZUFBVCxFQUEwQixZQUFNO0FBQzlCLFFBQUk2QyxzQkFBSjs7QUFFQW5DLGVBQVcsWUFBTTtBQUNmbUMsc0JBQWdCNUMsUUFBUWtCLE9BQVIsQ0FBZ0IsQ0FBaEIsRUFBbUJBLE9BQW5CLENBQTJCLENBQTNCLENBQWhCO0FBQ0QsS0FGRDs7QUFJQVIsT0FBRyxpQkFBSCxFQUFzQixZQUFNO0FBQzFCQyxhQUFPaUMsY0FBY3ZELElBQWQsRUFBUCxFQUE2QnVCLE9BQTdCLENBQXFDQyx3QkFBckM7QUFDRCxLQUZEOztBQUlBSCxPQUFHLGtDQUFILEVBQXVDLFlBQU07QUFDM0MsVUFBTW1DLFNBQVNELGNBQWMxQixPQUFkLENBQXNCLENBQXRCLENBQWY7QUFDQVAsYUFBT2tDLE9BQU94RCxJQUFQLEVBQVAsRUFBc0J1QixPQUF0QixDQUE4QmtDLHVCQUE5QjtBQUNELEtBSEQ7QUFJRCxHQWZEO0FBZ0JELENBMVFEIiwiZmlsZSI6IkR5bmFtaWNGb3JtLnNwZWMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtcbiAgQnV0dG9uLFxuICBGb3JtLFxuICBTZWdtZW50LFxuICBIZWFkZXIsXG4gIFJhZGlvLFxuICBDaGVja2JveCxcbiAgVGV4dEFyZWEsXG4gIERyb3Bkb3duLFxuICBJbnB1dCxcbn0gZnJvbSAnc2VtYW50aWMtdWktcmVhY3QnO1xuaW1wb3J0IHsgc2hhbGxvdyB9IGZyb20gJ2VuenltZSc7XG5pbXBvcnQgeyBDaGFuY2UgfSBmcm9tICdjaGFuY2UnO1xuaW1wb3J0IER5bmFtaWNGb3JtQ29tcG9uZW50IGZyb20gJy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL2hlbHBlcnMvRHluYW1pY0Zvcm0nO1xuaW1wb3J0IElubGluZUVycm9yQ29tcG9uZW50IGZyb20gJy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL2hlbHBlcnMvSW5saW5lRXJyb3InO1xuXG5jb25zdCBjaGFuY2UgPSBuZXcgQ2hhbmNlKCk7XG5cbmNvbnN0IHJhbmRvbVR5cGUgPSAodXNlUm93Q29tYmluYXRpb24pID0+IHtcbiAgc3dpdGNoIChjaGFuY2UuaW50ZWdlcigpICUgNSkge1xuICAgIGNhc2UgMDpcbiAgICAgIHJldHVybiAndGV4dEFyZWEnO1xuICAgIGNhc2UgMTpcbiAgICAgIHJldHVybiAncmFkaW8nO1xuICAgIGNhc2UgMjpcbiAgICAgIHJldHVybiAnY2hlY2tib3gnO1xuICAgIGNhc2UgMzpcbiAgICAgIHJldHVybiAnaW5wdXQnO1xuICAgIGNhc2UgNDpcbiAgICAgIGlmICh1c2VSb3dDb21iaW5hdGlvbikge1xuICAgICAgICByZXR1cm4gJ3Jvd0NvbWJpbmF0aW9uJztcbiAgICAgIH1cbiAgICAgIHJldHVybiAnaW5wdXQnO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gJ3RleHRBcmVhJztcbiAgfVxufTtcblxuY29uc3QgY3JlYXRlUmFuZG9tT3B0aW9ucyA9ICgpID0+IHtcbiAgY29uc3Qgb3B0aW9ucyA9IFtdO1xuICBjb25zdCBudW1iZXJPZk9wdGlvbnMgPSAoY2hhbmNlLmludGVnZXIoKSAlIDExKSArIDE7XG4gIGZvciAobGV0IGNvdW50ZXIgPSAwOyBjb3VudGVyIDwgbnVtYmVyT2ZPcHRpb25zOyBjb3VudGVyICs9IDEpIHtcbiAgICBvcHRpb25zW2NvdW50ZXJdID0gY2hhbmNlLndvcmQoKTtcbiAgfVxuICByZXR1cm4gb3B0aW9ucztcbn07XG5cbmNvbnN0IGdlbmVyYXRlVGVzdEZvcm1Kc29uID0gKCkgPT4ge1xuICBjb25zdCBuYW1lID0gY2hhbmNlLndvcmQoKTtcbiAgY29uc3QganNvbkZvcm0gPSB7fTtcbiAgY29uc3QgbnVtYmVyT2ZGaWVsZHMgPSAoY2hhbmNlLmludGVnZXIoKSAlIDExKSArIDE7XG4gIGNvbnN0IGZpZWxkcyA9IFtdO1xuICBmb3IgKGxldCBjb3VudGVyID0gMDsgY291bnRlciA8IG51bWJlck9mRmllbGRzOyBjb3VudGVyICs9IDEpIHtcbiAgICBjb25zdCB0eXBlID0gcmFuZG9tVHlwZSh0cnVlKTtcblxuICAgIGxldCBmaWVsZCA9IHt9O1xuICAgIGlmICh0eXBlID09PSAncm93Q29tYmluYXRpb24nKSB7XG4gICAgICBjb25zdCBudW1iZXJPZlN1YkZpZWxkcyA9IChjaGFuY2UuaW50ZWdlcigpICUgMTEpICsgMTtcbiAgICAgIGNvbnN0IHN1YkZpZWxkcyA9IFtdO1xuICAgICAgZm9yIChsZXQgY291bnQgPSAwOyBjb3VudCA8IG51bWJlck9mU3ViRmllbGRzOyBjb3VudCArPSAxKSB7XG4gICAgICAgIGNvbnN0IHN1YkZpZWxkVHlwZSA9IHJhbmRvbVR5cGUoZmFsc2UpO1xuICAgICAgICBjb25zdCBzdWJGaWVsZCA9IHtcbiAgICAgICAgICBuYW1lOiBjaGFuY2Uud29yZCgpLFxuICAgICAgICAgIHR5cGU6IHN1YkZpZWxkVHlwZSxcbiAgICAgICAgICBpZDogY2hhbmNlLndvcmQoKSxcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAoY2hhbmNlLmludGVnZXIoKSAlIDIgPT09IDApIHtcbiAgICAgICAgICBzdWJGaWVsZC52YWxpZGF0aW9uID0gJ3JlcXVpcmVkJztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0eXBlID09PSAncmFkaW8nKSB7XG4gICAgICAgICAgc3ViRmllbGQub3B0aW9ucyA9IGNyZWF0ZVJhbmRvbU9wdGlvbnMoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzdWJGaWVsZFR5cGUgPT09ICd0ZXh0QXJlYScgfHwgdHlwZSA9PT0gJ2lucHV0Jykge1xuICAgICAgICAgIHN1YkZpZWxkLnBsYWNlaG9sZGVyID0gY2hhbmNlLndvcmQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHN1YkZpZWxkc1tjb3VudF0gPSBzdWJGaWVsZDtcbiAgICAgIH1cblxuICAgICAgZmllbGQgPSB7XG4gICAgICAgIG5hbWU6IGNoYW5jZS53b3JkKCksXG4gICAgICAgIHR5cGU6ICdyb3dDb21iaW5hdGlvbicsXG4gICAgICAgIGZpZWxkczogc3ViRmllbGRzLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmllbGQgPSB7XG4gICAgICAgIG5hbWU6IGNoYW5jZS53b3JkKCksXG4gICAgICAgIHR5cGUsXG4gICAgICAgIGlkOiBjaGFuY2Uud29yZCgpLFxuICAgICAgfTtcblxuICAgICAgaWYgKGNoYW5jZS5pbnRlZ2VyKCkgJSAyID09PSAwKSB7XG4gICAgICAgIGZpZWxkLnZhbGlkYXRpb24gPSAncmVxdWlyZWQnO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGUgPT09ICdyYWRpbycpIHtcbiAgICAgICAgZmllbGQub3B0aW9ucyA9IGNyZWF0ZVJhbmRvbU9wdGlvbnMoKTtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlID09PSAndGV4dEFyZWEnIHx8IHR5cGUgPT09ICdpbnB1dCcpIHtcbiAgICAgICAgZmllbGQucGxhY2Vob2xkZXIgPSBjaGFuY2Uud29yZCgpO1xuICAgICAgfVxuICAgIH1cblxuXG4gICAgZmllbGRzW2NvdW50ZXJdID0gZmllbGQ7XG4gIH1cbiAganNvbkZvcm1bbmFtZV0gPSB7fTtcbiAganNvbkZvcm1bbmFtZV0uZmllbGRzID0gZmllbGRzO1xuICByZXR1cm4ganNvbkZvcm07XG59O1xuXG5kZXNjcmliZSgnRHluYW1pY0Zvcm0nLCAoKSA9PiB7XG4gIGxldCB3cmFwcGVyO1xuICBjb25zdCBzZXRSZXF1ZXN0ID0gamVzdC5mbigpO1xuICBjb25zdCB0ZXN0SnNvbiA9IGdlbmVyYXRlVGVzdEZvcm1Kc29uKCk7XG4gIGNvbnN0IHJvdXRlID0gamVzdC5mbigpO1xuICBjb25zdCByZW5kZXJDb21wb25lbnQgPSAoKSA9PlxuICAgIHNoYWxsb3coXG4gICAgICA8RHluYW1pY0Zvcm1Db21wb25lbnRcbiAgICAgICAganNvbkZvcm09eygpID0+IHRlc3RKc29ufVxuICAgICAgICBzZXRSZXF1ZXN0PXtzZXRSZXF1ZXN0fVxuICAgICAgICBmb3JtPXtPYmplY3Qua2V5cyh0ZXN0SnNvbilbMF19XG4gICAgICAgIHJvdXRlPXsoKSA9PiB7XG4gICAgICAgICAgcm91dGUoKTtcbiAgICAgICAgfX1cbiAgICAgIC8+LFxuICAgICk7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgd3JhcHBlciA9IHJlbmRlckNvbXBvbmVudCgpO1xuICB9KTtcblxuICBpdCgnaXMgd3JhcHBlZCBpbiBhIFNlZ21lbnQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KHdyYXBwZXIudHlwZSgpKS50b0VxdWFsKFNlZ21lbnQpO1xuICB9KTtcblxuICBpdCgnaXMgc3R5bGVkIGFzIGEgcGFkZGVkIFNlZ21lbnQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KHdyYXBwZXIucHJvcHMoKS5wYWRkZWQpLnRvQmVUcnV0aHkoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2hlYWRlcicsICgpID0+IHtcbiAgICBsZXQgaGVhZGVyO1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBoZWFkZXIgPSB3cmFwcGVyLmNoaWxkQXQoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnaXMgYSBoZWFkZXInLCAoKSA9PiB7XG4gICAgICBleHBlY3QoaGVhZGVyLnR5cGUoKSkudG9FcXVhbChIZWFkZXIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2lzIGhhcyBhIGxhcmdlIHNpemUnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoaGVhZGVyLnByb3BzKCkuc2l6ZSkudG9FcXVhbCgnbGFyZ2UnKTtcbiAgICB9KTtcblxuICAgIGl0KCdpcyB0aGUgY29ycmVjdCB0ZXh0IGluIHRoZSBoZWFkZXInLCAoKSA9PiB7XG4gICAgICBleHBlY3QoaGVhZGVyLmNoaWxkQXQoMCkuZGVidWcoKSkudG9FcXVhbChPYmplY3Qua2V5cyh0ZXN0SnNvbilbMF0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZm9ybScsICgpID0+IHtcbiAgICBpdCgnaXMgYSBmb3JtJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHdyYXBwZXIuY2hpbGRBdCgxKS50eXBlKCkpLnRvRXF1YWwoRm9ybSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnZm9ybSBkYXRhJywgKCkgPT4ge1xuICAgICAgd3JhcHBlciA9IHJlbmRlckNvbXBvbmVudCgpO1xuICAgICAgdGVzdEpzb25bT2JqZWN0LmtleXModGVzdEpzb24pWzBdXS5maWVsZHMuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgICAgaWYgKGZpZWxkLnZhbGlkYXRpb24pIHtcbiAgICAgICAgICBjb25zdCBmYWlsID0gY2hhbmNlLmludGVnZXIoKSAlIDI7XG4gICAgICAgICAgbGV0IGNvdW50ID0gMDtcbiAgICAgICAgICBjb25zdCBmb3JtID0gd3JhcHBlci5jaGlsZEF0KDEpO1xuICAgICAgICAgIGNvbnN0IHNlZ21lbnRPZkZpZWxkcyA9IGZvcm0uY2hpbGRBdCgwKTtcbiAgICAgICAgICBpdChgZmllbGQgJHtjb3VudH0gaXMgY29ycmVjdGAsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gc2VnbWVudE9mRmllbGRzLmNoaWxkQXQoY291bnQpLmNoaWxkQXQoMCk7XG4gICAgICAgICAgICBpZiAoZmllbGQudmFsaWRhdGlvbikge1xuICAgICAgICAgICAgICBleHBlY3QobGFiZWwudGV4dCgpKS50b0VxdWFsKGAgKiAke2ZpZWxkLm5hbWV9YCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBleHBlY3QobGFiZWwudGV4dCgpKS50b0VxdWFsKGZpZWxkLm5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZXhwZWN0KFxuICAgICAgICAgICAgICB3cmFwcGVyXG4gICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgLnByb3BzKCkubmFtZSA9PT0gZmllbGQubmFtZSxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBpZiAoZmllbGQudHlwZSA9PT0gJ2NoZWNrYm94Jykge1xuICAgICAgICAgICAgICBleHBlY3QoXG4gICAgICAgICAgICAgICAgd3JhcHBlclxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdChjb3VudClcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAudHlwZSgpLFxuICAgICAgICAgICAgICApLnRvRXF1YWwoQ2hlY2tib3gpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICdyYWRpbycpIHtcbiAgICAgICAgICAgICAgZXhwZWN0KFxuICAgICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLnR5cGUoKSxcbiAgICAgICAgICAgICAgKS50b0VxdWFsKFJhZGlvKTtcblxuICAgICAgICAgICAgICBpZiAoZmFpbCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRlID0geyBlcnJvcnM6IHt9IH07XG4gICAgICAgICAgICAgICAgc3RhdGUuZXJyb3JzW2ZpZWxkLmlkXSA9ICdSYWRpbyBCdXR0b24gTm90IFNlbGVjdGVkJztcbiAgICAgICAgICAgICAgICB3cmFwcGVyLnNldFN0YXRlKHN0YXRlKTtcbiAgICAgICAgICAgICAgICB3cmFwcGVyLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgIGV4cGVjdChcbiAgICAgICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAgIC5maW5kKElubGluZUVycm9yQ29tcG9uZW50KVxuICAgICAgICAgICAgICAgICAgICAucHJvcHMoKS50ZXh0LFxuICAgICAgICAgICAgICAgICkudG9FcXVhbCgnUmFkaW8gQnV0dG9uIE5vdCBTZWxlY3RlZCcpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZmllbGQudHlwZSA9PT0gJ3RleHRBcmVhJykge1xuICAgICAgICAgICAgICBleHBlY3QoXG4gICAgICAgICAgICAgICAgd3JhcHBlclxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdChjb3VudClcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAudHlwZSgpLFxuICAgICAgICAgICAgICApLnRvRXF1YWwoVGV4dEFyZWEpO1xuXG4gICAgICAgICAgICAgIGlmIChmYWlsKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3RhdGUgPSB7IGVycm9yczoge30gfTtcbiAgICAgICAgICAgICAgICBzdGF0ZS5lcnJvcnNbZmllbGQuaWRdID0gJ0VtcHR5IFRleHQgQm94JztcbiAgICAgICAgICAgICAgICB3cmFwcGVyLnNldFN0YXRlKHN0YXRlKTtcbiAgICAgICAgICAgICAgICB3cmFwcGVyLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgIGV4cGVjdChcbiAgICAgICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAgIC5maW5kKElubGluZUVycm9yQ29tcG9uZW50KVxuICAgICAgICAgICAgICAgICAgICAucHJvcHMoKS50ZXh0LFxuICAgICAgICAgICAgICAgICkudG9FcXVhbCgnRW1wdHkgVGV4dCBCb3gnKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICdkcm9wRG93bicpIHtcbiAgICAgICAgICAgICAgZXhwZWN0KFxuICAgICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDEpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLnR5cGUoKSxcbiAgICAgICAgICAgICAgKS50b0VxdWFsKERyb3Bkb3duKTtcblxuICAgICAgICAgICAgICBpZiAoZmFpbCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRlID0geyBlcnJvcnM6IHt9IH07XG4gICAgICAgICAgICAgICAgc3RhdGUuZXJyb3JzW2ZpZWxkLmlkXSA9ICdOb3RoaW5nIGlzIFNlbGVjdGVkJztcbiAgICAgICAgICAgICAgICB3cmFwcGVyLnNldFN0YXRlKHN0YXRlKTtcbiAgICAgICAgICAgICAgICB3cmFwcGVyLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgIGV4cGVjdChcbiAgICAgICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAgIC5maW5kKElubGluZUVycm9yQ29tcG9uZW50KVxuICAgICAgICAgICAgICAgICAgICAucHJvcHMoKS50ZXh0LFxuICAgICAgICAgICAgICAgICkudG9FcXVhbCgnTm90aGluZyBpcyBTZWxlY3RlZCcpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAncm93Q29tYmluYXRpb24nKSB7XG4gICAgICAgICAgICAgIGV4cGVjdChcbiAgICAgICAgICAgICAgICB3cmFwcGVyXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgIC50eXBlKCksXG4gICAgICAgICAgICAgICkudG9FcXVhbChGb3JtLkdyb3VwKTtcblxuICAgICAgICAgICAgICBsZXQgc3ViRmllbGRDb3VudGVyID0gMDtcbiAgICAgICAgICAgICAgZmllbGQuZmllbGRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgcm93SW5wdXQgPSB3cmFwcGVyXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KHN1YkZpZWxkQ291bnRlcik7XG5cbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgIGNhc2UgJ2lucHV0JzpcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KHJvd0lucHV0LnR5cGUoKSkudG9FcXVhbChJbnB1dCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgY2FzZSAnZHJvcERvd24nOlxuICAgICAgICAgICAgICAgICAgICBleHBlY3Qocm93SW5wdXQudHlwZSgpKS50b0VxdWFsKERyb3Bkb3duKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICBjYXNlICd0ZXh0QXJlYSc6XG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChyb3dJbnB1dC50eXBlKCkpLnRvRXF1YWwoVGV4dEFyZWEpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIGNhc2UgJ2NoZWNrYm94JzpcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KHJvd0lucHV0LnR5cGUoKSkudG9FcXVhbChDaGVja2JveCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgY2FzZSAncmFkaW8nOlxuICAgICAgICAgICAgICAgICAgICBleHBlY3Qocm93SW5wdXQudHlwZSgpKS50b0VxdWFsKENoZWNrYm94KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZmFpbCkge1xuICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhdGUgPSB7IGVycm9yczoge30gfTtcbiAgICAgICAgICAgICAgICAgIHN0YXRlLmVycm9yc1tmaWVsZC5pZF0gPSAnTm90aGluZyBpcyBTZWxlY3RlZCc7XG4gICAgICAgICAgICAgICAgICB3cmFwcGVyLnNldFN0YXRlKHN0YXRlKTtcbiAgICAgICAgICAgICAgICAgIHdyYXBwZXIudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgICBleHBlY3QoXG4gICAgICAgICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KDApXG4gICAgICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoY291bnQpXG4gICAgICAgICAgICAgICAgICAgICAgLmZpbmQoSW5saW5lRXJyb3JDb21wb25lbnQpXG4gICAgICAgICAgICAgICAgICAgICAgLnByb3BzKCkudGV4dCxcbiAgICAgICAgICAgICAgICAgICkudG9FcXVhbCgnTm90aGluZyBpcyBTZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzdWJGaWVsZENvdW50ZXIgKz0gMTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAnaW5wdXQnKSB7XG4gICAgICAgICAgICAgIGV4cGVjdChcbiAgICAgICAgICAgICAgICB3cmFwcGVyXG4gICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMClcbiAgICAgICAgICAgICAgICAgIC5jaGlsZEF0KGNvdW50KVxuICAgICAgICAgICAgICAgICAgLmNoaWxkQXQoMSlcbiAgICAgICAgICAgICAgICAgIC50eXBlKCksXG4gICAgICAgICAgICAgICkudG9FcXVhbChJbnB1dCk7XG5cbiAgICAgICAgICAgICAgaWYgKGZhaWwpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdGF0ZSA9IHsgZXJyb3JzOiB7fSB9O1xuICAgICAgICAgICAgICAgIHN0YXRlLmVycm9yc1tmaWVsZC5pZF0gPSAnRW1wdHkgSW5wdXQnO1xuICAgICAgICAgICAgICAgIHdyYXBwZXIuc2V0U3RhdGUoc3RhdGUpO1xuICAgICAgICAgICAgICAgIHdyYXBwZXIudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KFxuICAgICAgICAgICAgICAgICAgd3JhcHBlclxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgxKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdCgwKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGRBdChjb3VudClcbiAgICAgICAgICAgICAgICAgICAgLmZpbmQoSW5saW5lRXJyb3JDb21wb25lbnQpXG4gICAgICAgICAgICAgICAgICAgIC5wcm9wcygpLnRleHQsXG4gICAgICAgICAgICAgICAgKS50b0VxdWFsKCdFbXB0eSBJbnB1dCcpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb3VudCArPSAxO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1N1Ym1pdCBCdXR0b24nLCAoKSA9PiB7XG4gICAgbGV0IHN1Ym1pdFNlZ21lbnQ7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIHN1Ym1pdFNlZ21lbnQgPSB3cmFwcGVyLmNoaWxkQXQoMSkuY2hpbGRBdCgxKTtcbiAgICB9KTtcblxuICAgIGl0KCdJdCBpcyBhIHNlZ21lbnQnLCAoKSA9PiB7XG4gICAgICBleHBlY3Qoc3VibWl0U2VnbWVudC50eXBlKCkpLnRvRXF1YWwoU2VnbWVudCk7XG4gICAgfSk7XG5cbiAgICBpdCgnVGhlcmUgaXMgYSBidXR0b24gaW4gdGhlIHNlZ21lbnQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBidXR0b24gPSBzdWJtaXRTZWdtZW50LmNoaWxkQXQoMCk7XG4gICAgICBleHBlY3QoYnV0dG9uLnR5cGUoKSkudG9FcXVhbChCdXR0b24pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19